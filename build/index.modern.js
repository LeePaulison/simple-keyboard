/*!
 * 
 *   @aac/simple-keyboard v1.1.0 (index.modern.js - Modern Browsers bundle)
 *   https://github.com/hodgef/simple-keyboard
 *
 *   NOTE: This modern browsers bundle (index.modern.js) removes all polyfills
 *   included in the standard version. Use this if you are supporting
 *   modern browsers only. Otherwise, use the standard version (index.js).
 *
 *   Copyright (c) Francisco Hodge (https://github.com/hodgef) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SimpleKeyboard=e():t.SimpleKeyboard=e()}(this,function(){return function(){"use strict";var t={d:function(e,n){for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{SimpleKeyboard:function(){return L},default:function(){return N}});function n(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,u(i.key),i)}}function r(t,e,n){return(e=u(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){var e=function(t,e){if("object"!=a(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==a(e)?e:e+""}var l=function(){return t=function t(e){var n=e.getOptions,i=e.getCaretPosition,o=e.getCaretPositionEnd,a=e.dispatch;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"getOptions",void 0),r(this,"getCaretPosition",void 0),r(this,"getCaretPositionEnd",void 0),r(this,"dispatch",void 0),r(this,"maxLengthReached",void 0),r(this,"isStandardButton",function(t){return t&&!("{"===t[0]&&"}"===t[t.length-1])}),this.getOptions=n,this.getCaretPosition=i,this.getCaretPositionEnd=o,this.dispatch=a,t.bindMethods(t,this)},e=[{key:"getButtonType",value:function(t){return t.includes("{")&&t.includes("}")&&"{//}"!==t?"functionBtn":"standardBtn"}},{key:"getButtonClass",value:function(t){var e=this.getButtonType(t),n=t.replace("{","").replace("}",""),i="";return"standardBtn"!==e&&(i=" hg-button-".concat(n)),"hg-".concat(e).concat(i)}},{key:"getDefaultDisplay",value:function(){return{"{bksp}":"backspace","{backspace}":"backspace","{enter}":"< enter","{shift}":"shift","{shiftleft}":"shift","{shiftright}":"shift","{alt}":"alt","{s}":"shift","{tab}":"tab","{lock}":"caps","{capslock}":"caps","{accept}":"Submit","{space}":" ","{//}":" ","{esc}":"esc","{escape}":"esc","{f1}":"f1","{f2}":"f2","{f3}":"f3","{f4}":"f4","{f5}":"f5","{f6}":"f6","{f7}":"f7","{f8}":"f8","{f9}":"f9","{f10}":"f10","{f11}":"f11","{f12}":"f12","{numpaddivide}":"/","{numlock}":"lock","{arrowup}":"↑","{arrowleft}":"←","{arrowdown}":"↓","{arrowright}":"→","{prtscr}":"print","{scrolllock}":"scroll","{pause}":"pause","{insert}":"ins","{home}":"home","{pageup}":"up","{delete}":"del","{forwarddelete}":"del","{end}":"end","{pagedown}":"down","{numpadmultiply}":"*","{numpadsubtract}":"-","{numpadadd}":"+","{numpadenter}":"enter","{period}":".","{numpaddecimal}":".","{numpad0}":"0","{numpad1}":"1","{numpad2}":"2","{numpad3}":"3","{numpad4}":"4","{numpad5}":"5","{numpad6}":"6","{numpad7}":"7","{numpad8}":"8","{numpad9}":"9"}}},{key:"getButtonDisplayName",value:function(t,e){return(e=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Object.assign({},this.getDefaultDisplay(),e):e||this.getDefaultDisplay())[t]||t}},{key:"getUpdatedInput",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.getOptions(),s=[n,i,o],r=e;return("{bksp}"===t||"{backspace}"===t)&&r.length>0?r=this.removeAt.apply(this,[r].concat(s)):("{delete}"===t||"{forwarddelete}"===t)&&r.length>0?r=this.removeForwardsAt.apply(this,[r].concat(s)):"{space}"===t?r=this.addStringAt.apply(this,[r," "].concat(s)):"{tab}"!==t||"boolean"==typeof a.tabCharOnTab&&!1===a.tabCharOnTab?"{enter}"!==t&&"{numpadenter}"!==t||!a.newLineOnEnter?t.includes("numpad")&&Number.isInteger(Number(t[t.length-2]))?r=this.addStringAt.apply(this,[r,t[t.length-2]].concat(s)):"{numpaddivide}"===t?r=this.addStringAt.apply(this,[r,"/"].concat(s)):"{numpadmultiply}"===t?r=this.addStringAt.apply(this,[r,"*"].concat(s)):"{numpadsubtract}"===t?r=this.addStringAt.apply(this,[r,"-"].concat(s)):"{numpadadd}"===t?r=this.addStringAt.apply(this,[r,"+"].concat(s)):"{numpaddecimal}"===t?r=this.addStringAt.apply(this,[r,"."].concat(s)):"{"===t||"}"===t?r=this.addStringAt.apply(this,[r,t].concat(s)):t.includes("{")||t.includes("}")||(r=this.addStringAt.apply(this,[r,t].concat(s))):r=this.addStringAt.apply(this,[r,"\n"].concat(s)):r=this.addStringAt.apply(this,[r,"\t"].concat(s)),a.debug&&console.log("Input will be: "+r),r}},{key:"updateCaretPos",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.updateCaretPosAction(t,e);this.dispatch(function(t){t.setCaretPosition(n)})}},{key:"updateCaretPosAction",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getOptions(),i=this.getCaretPosition();return null!=i&&(e?i>0&&(i-=t):i+=t),n.debug&&console.log("Caret at:",i),i}},{key:"addStringAt",value:function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return i||0===i?(n=[t.slice(0,i),e,t.slice(o)].join(""),this.isMaxLengthReached()||a&&this.updateCaretPos(e.length)):n=t+e,n}},{key:"removeAt",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0===n&&0===i)return t;if(n===i){var a=/([\uD800-\uDBFF][\uDC00-\uDFFF])/g;n&&n>=0?t.substring(n-2,n).match(a)?(e=t.substr(0,n-2)+t.substr(n),o&&this.updateCaretPos(2,!0)):(e=t.substr(0,n-1)+t.substr(n),o&&this.updateCaretPos(1,!0)):t.slice(-2).match(a)?(e=t.slice(0,-2),o&&this.updateCaretPos(2,!0)):(e=t.slice(0,-1),o&&this.updateCaretPos(1,!0))}else e=t.slice(0,n)+t.slice(i),o&&this.dispatch(function(t){t.setCaretPosition(n)});return e}},{key:"removeForwardsAt",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return null!=t&&t.length&&null!==n?(n===i?e=t.substring(n,n+2).match(/([\uD800-\uDBFF][\uDC00-\uDFFF])/g)?t.substr(0,n)+t.substr(n+2):t.substr(0,n)+t.substr(n+1):(e=t.slice(0,n)+t.slice(i),o&&this.dispatch(function(t){t.setCaretPosition(n)})),e):t}},{key:"handleMaxLength",value:function(t,e){var n=this.getOptions(),i=n.maxLength,o=t[n.inputName||"default"],s=e.length-1>=i;if(e.length<=o.length)return!1;if(Number.isInteger(i))return n.debug&&console.log("maxLength (num) reached:",s),s?(this.maxLengthReached=!0,!0):(this.maxLengthReached=!1,!1);if("object"===a(i)){var r=e.length-1>=i[n.inputName||"default"];return n.debug&&console.log("maxLength (obj) reached:",r),r?(this.maxLengthReached=!0,!0):(this.maxLengthReached=!1,!1)}}},{key:"isMaxLengthReached",value:function(){return Boolean(this.maxLengthReached)}},{key:"isTouchDevice",value:function(){return"ontouchstart"in window||navigator.maxTouchPoints}},{key:"pointerEventsSupported",value:function(){return!!window.PointerEvent}},{key:"camelCase",value:function(t){return t?t.toLowerCase().trim().split(/[.\-_\s]/g).reduce(function(t,e){return e.length?t+e[0].toUpperCase()+e.slice(1):t}):""}},{key:"chunkArray",value:function(t,e){return n(Array(Math.ceil(t.length/e))).map(function(n,i){return t.slice(e*i,e+e*i)})}},{key:"escapeRegex",value:function(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}},{key:"getRtlOffset",value:function(t,e){var n=t,i=e.indexOf("‫");return i<t&&-1!=i&&n--,e.indexOf("‬")<t&&-1!=i&&n--,n<0?0:n}},{key:"isConstructor",value:function(t){try{Reflect.construct(String,[],t)}catch(t){return!1}return!0}}],o=[{key:"bindMethods",value:function(t,e){var n,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,a=function(){};return{s:a,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){u=!0,s=t},f:function(){try{r||null==n.return||n.return()}finally{if(u)throw s}}}}(Object.getOwnPropertyNames(t.prototype));try{for(o.s();!(n=o.n()).done;){var a=n.value;"constructor"===a||"bindMethods"===a||(e[a]=e[a].bind(e))}}catch(t){o.e(t)}finally{o.f()}}}],e&&s(t.prototype,e),o&&s(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,o}();r(l,"noop",function(){});var c=l;function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function h(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,g(i.key),i)}}function v(t,e,n){return(e=g(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(t){var e=function(t,e){if("object"!=d(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==d(e)?e:e+""}var b=function(){return t=function t(e){var n=this,i=e.dispatch,o=e.getOptions,a=e.getNavEngaged;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,"getOptions",void 0),v(this,"dispatch",void 0),v(this,"layoutJSON",null),v(this,"lastLayout",""),v(this,"shiftActive",!1),v(this,"capslockActive",!1),v(this,"activeKeys",new Set),v(this,"getNavEngaged",void 0),v(this,"STANDARD_CODES",new Set(["Backquote","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Enter","Escape","Backspace","Tab","Space","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Delete","Insert","Home","End","PageUp","PageDown","ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight","CapsLock","Minus","Equal","BracketLeft","BracketRight","Backslash","Semicolon","Quote","Comma","Period","Slash","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","NumLock","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadSubtract","NumpadMultiply","NumpadDivide","NumpadDecimal","NumpadEnter","ScrollLock","Pause","PrintScreen","ContextMenu"])),v(this,"isModifierKey",function(t){return t.altKey||t.ctrlKey||t.shiftKey||["Tab","CapsLock","Esc","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.code||t.key||n.keyCodeToKey(null==t?void 0:t.keyCode))}),this.dispatch=i,this.getOptions=o,this.getNavEngaged=a,this.getOptions()&&this.getOptions().layout){var s;this.lastLayout=(null===(s=this.getOptions())||void 0===s||null===(s=s.layout)||void 0===s||null===(s=s.default)||void 0===s?void 0:s[1])||"";var r=this.getOptions().layout;r&&(this.layoutJSON=this.mapLayoutToEventCodes(this.extractAndPadLayout(r)))}else this.lastLayout="{tab} q w e r t y u i o p [ ] \\",this.layoutJSON=this.mapLayoutToEventCodes(this.extractAndPadLayout({default:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","{lock} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}",".com @ {space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'{lock} A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}",".com @ {space}"]}));c.bindMethods(t,this)},e=[{key:"handleHighlightKeyDown",value:function(t){var e=this,n=this.getOptions();if("ShiftLeft"!==t.code&&"ShiftRight"!==t.code||this.shiftActive||(this.shiftActive=!this.shiftActive),"CapsLock"===t.code&&(this.capslockActive=!this.capslockActive),this.getNavEngaged()&&"keyboard"===n.activeSurface)return t.preventDefault(),void t.stopImmediatePropagation();var i=this.getSimpleKeyboardLayoutKey(t);this.dispatch(function(o){var a,s,r=o.getButtonElement(i),u=o.getButtonElement("{".concat(i,"}"));if(r)a=r,s=i;else{if(!u)return;a=u,s="{".concat(i,"}")}var l,c,d,h,p=function(t){t.style.background=n.physicalKeyboardHighlightBgColor||"#dadce4",t.style.color=n.physicalKeyboardHighlightTextColor||"black",e.activeKeys.add(t)};if(a)if(Array.isArray(a)){if(a.forEach(function(t){return p(t)}),n.physicalKeyboardHighlightPress)if(n.physicalKeyboardHighlightPressUsePointerEvents)null===(l=a[0])||void 0===l||null===(c=l.onpointerdown)||void 0===c||c.call(l,t);else if(n.physicalKeyboardHighlightPressUseClick){var f;null===(f=a[0])||void 0===f||f.click()}else o.handleButtonClicked(s,t)}else p(a),n.physicalKeyboardHighlightPress&&(n.physicalKeyboardHighlightPressUsePointerEvents?null===(d=a)||void 0===d||null===(h=d.onpointerdown)||void 0===h||h.call(d,t):n.physicalKeyboardHighlightPressUseClick?a.click():o.handleButtonClicked(s,t))})}},{key:"handleHighlightKeyUp",value:function(t){var e=this,n=this.getOptions();"ShiftLeft"!==t.code&&"ShiftRight"!==t.code||(this.shiftActive=!1);var i=this.getSimpleKeyboardLayoutKey(t);this.dispatch(function(o){var a,s,r,u=o.getButtonElement(i)||o.getButtonElement("{".concat(i,"}")),l=function(t){t.removeAttribute&&t.removeAttribute("style"),e.activeKeys.delete(t)};u&&(Array.isArray(u)?(u.forEach(function(t){return l(t)}),n.physicalKeyboardHighlightPressUsePointerEvents&&(null===(a=u[0])||void 0===a||null===(s=a.onpointerup)||void 0===s||s.call(a,t))):(l(u),n.physicalKeyboardHighlightPressUsePointerEvents&&(null==u||null===(r=u.onpointerup)||void 0===r||r.call(u,t))))}),requestAnimationFrame(function(){0!==e.activeKeys.size&&(e.activeKeys.forEach(function(t){t.removeAttribute&&t.removeAttribute("style")}),e.activeKeys.clear())})}},{key:"normalizeToStandardCode",value:function(t){if(!t||"string"!=typeof t)return null;if(this.STANDARD_CODES.has(t))return t;var e,n=t.trim(),i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=p(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw a}}}}(this.STANDARD_CODES);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o.toLowerCase()===n.toLowerCase())return o}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"normalizeOutput",value:function(t){var e=t.toLowerCase();return{shiftleft:"shift",shiftright:"shift",controlleft:"ctrl",controlright:"ctrl",altleft:"alt",altright:"alt",metaleft:"meta",metaright:"meta",backspace:"bksp",capslock:"lock",enter:"enter",tab:"tab"}[e]||(e.length>1?e:t)}},{key:"getSimpleKeyboardLayoutKey",value:function(t){var e,n,i="",o=this.getOptions(),a=null!==(e=null==o||null===(n=o.layout)||void 0===n||null===(n=n.default)||void 0===n?void 0:n[1])&&void 0!==e?e:"{tab} q w e r t y u i o p [ ] \\";if(this.lastLayout!==a){var s;this.lastLayout=a||"";var r=null!==(s=null==o?void 0:o.layout)&&void 0!==s?s:{default:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","{lock} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}",".com @ {space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'{lock} A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}",".com @ {space}"]};this.layoutJSON=this.mapLayoutToEventCodes(this.extractAndPadLayout(r))}var u=this.normalizeToStandardCode(t.code);if(this.layoutJSON&&u&&this.layoutJSON[u]){var l=this.layoutJSON[u];return i=this.shiftActive||this.capslockActive?l.shift.toString():l.normal.toString(),this.normalizeOutput(i)}var c=new Set(["backspace","enter","tab","escape"]),d=(t.key||"").toLowerCase();return c.has(d)?(i=d,this.normalizeOutput(i)):""}},{key:"keyCodeToKey",value:function(t){return{8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Meta",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}[t]||""}},{key:"extractAndPadLayout",value:function(t){for(var e=[14,14,13,12,3],n={default:[],shift:[]},i=0,o=["default","shift"];i<o.length;i++){var a=o[i];if(t[a])for(var s=t[a].map(function(t){return t.split(" ")}),r=0;r<e.length;r++)for(n[a][r]=s[r]?h(s[r]):[];n[a][r].length<e[r];)n[a][r].push(-1)}return n}},{key:"mapLayoutToEventCodes",value:function(t){for(var e={},n=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace"],["Tab","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["CapsLock","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter"],["ShiftLeft","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight"],["ControlLeft","AltLeft","Space"]],i=0;i<n.length;i++)for(var o=0;o<n[i].length;o++){var a,s,r=n[i][o],u=null!==(a=t.default[i][o])&&void 0!==a?a:"",l=null!==(s=t.shift[i][o])&&void 0!==s?s:"";e[r]={normal:-1!==u?u:"",shift:-1!==l?l:""}}return e}}],e&&y(t.prototype,e),n&&y(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,A(i.key),i)}}function E(t,e,n){return(e=A(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function A(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=m(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==m(e)?e:e+""}var w=function(){function t(e){var n=e.utilities,i=e.options;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,"utilities",void 0),E(this,"options",void 0),E(this,"candidateBoxElement",null),E(this,"pageIndex",0),E(this,"pageSize",void 0),E(this,"activeIndex",0),E(this,"candidateOptions",[]),E(this,"globalLiveRegionElement",document.querySelector(".hg-live-region")),E(this,"handleActiveIndexBound",void 0),E(this,"firstLastNavBound",void 0),E(this,"listenersAttached",!1),this.utilities=n,this.options=i,c.bindMethods(t,this),this.pageSize=this.utilities.getOptions().layoutCandidatesPageSize||5,this.handleActiveIndexBound=this.handleActiveIndex.bind(this),this.firstLastNavBound=this.firstLastNav.bind(this)}return e=t,n=[{key:"attachDocListeners",value:function(){this.listenersAttached||(document.addEventListener("keydown",this.handleActiveIndexBound,{capture:!1}),document.addEventListener("keydown",this.firstLastNavBound,{capture:!1}),this.listenersAttached=!0)}},{key:"detachDocListeners",value:function(){this.listenersAttached&&(document.removeEventListener("keydown",this.handleActiveIndexBound,{capture:!1}),document.removeEventListener("keydown",this.firstLastNavBound,{capture:!1}),this.listenersAttached=!1)}},{key:"destroy",value:function(){var e=this;this.detachDocListeners(),this.candidateBoxElement&&setTimeout(function(){e.candidateBoxElement&&(e.candidateBoxElement.remove(),e.candidateBoxElement=null),t.isOpen=!1},30),this.activeIndex=0,this.candidateOptions=[];var n=document.querySelector(".hg-candidate-box-list");n&&n.replaceWith(n.cloneNode(!0)),this.pageIndex=0}},{key:"show",value:function(e){var n=this,i=e.candidateValue,o=e.targetElement,a=e.onSelect;if(i&&i.length){var s=this.utilities.chunkArray(i.split(" "),this.pageSize);this.renderPage({candidateListPages:s,targetElement:o,pageIndex:this.pageIndex,nbPages:s.length,onItemSelected:function(t,e){a(t,e),n.destroy()}}),t.isOpen=!0}}},{key:"firstLastNav",value:function(e){var n;if("Tab"===e.key&&t.isOpen){var i=null===(n=this.candidateBoxElement)||void 0===n?void 0:n.querySelectorAll(".hg-candidate-box-list-item");if(null!=i&&i.length){var o=i[0],a=i[i.length-1];e.shiftKey&&document.querySelector(".hg-candidate-box-list-item.active")===o?(e.preventDefault(),a.setAttribute("aria-selected","true")):e.shiftKey||document.querySelector(".hg-candidate-box-list-item.active")!==a||(e.preventDefault(),o.setAttribute("aria-selected","true"))}}}},{key:"renderPage",value:function(t){var e,n=this,i=t.candidateListPages,o=t.targetElement,a=t.pageIndex,s=t.nbPages,r=t.onItemSelected;this.attachDocListeners(),null===(e=this.candidateBoxElement)||void 0===e||e.remove(),this.candidateBoxElement=document.createElement("div"),this.candidateBoxElement.className="hg-candidate-box",this.candidateBoxElement.setAttribute("role","dialog"),this.candidateBoxElement.setAttribute("aria-label","Character Suggestions"),this.candidateBoxElement.setAttribute("aria-describedby","candidate-box-instructions");var u=document.createElement("div");u.id="candidate-box-instructions",u.classList.add("hg-candidate-box-instructions","sr-only"),u.innerHTML="Use up and down arrow keys to navigate, Enter to select.",this.candidateBoxElement.appendChild(u);var l=document.createElement("ul");l.className="hg-candidate-box-list",l.setAttribute("role","listbox"),l.setAttribute("tabindex","-1"),i[a].forEach(function(t,e){var i,o=document.createElement("li");o.setAttribute("role","option"),o.setAttribute("aria-selected",0===e?"true":"false"),o.id="key-candidate-".concat(e),o.className="hg-candidate-box-list-item",o.innerHTML=(null===(i=n.options.display)||void 0===i?void 0:i[t])||t;var a=function(){var t=new(n.options.useTouchEvents?TouchEvent:MouseEvent)("click");return Object.defineProperty(t,"target",{value:o}),t};o.onclick=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a();if(n.globalLiveRegionElement){var i,s=null===(i=o.textContent)||void 0===i?void 0:i.trim();n.globalLiveRegionElement.textContent="Inserted: ".concat(s)}r(t,e)},n.options.useTouchEvents&&(o.ontouchstart=function(e){if(n.globalLiveRegionElement){var i,s=null===(i=o.textContent)||void 0===i?void 0:i.trim();n.globalLiveRegionElement.textContent="Inserted: ".concat(s)}r(t,e||a())}),l.appendChild(o)});var c=a>0,d=document.createElement("div");d.classList.add("hg-candidate-box-prev"),c&&d.classList.add("hg-candidate-box-btn-active"),d.onclick=function(){c&&n.renderPage({candidateListPages:i,targetElement:o,pageIndex:a-1,nbPages:s,onItemSelected:r})};var h=a<s-1,p=document.createElement("div");p.classList.add("hg-candidate-box-next"),h&&p.classList.add("hg-candidate-box-btn-active"),p.onclick=function(){h&&n.renderPage({candidateListPages:i,targetElement:o,pageIndex:a+1,nbPages:s,onItemSelected:r})},this.candidateBoxElement.appendChild(d),this.candidateBoxElement.appendChild(l),this.candidateBoxElement.appendChild(p),this.candidateBoxElement.addEventListener("keydown",function(t){"Escape"===t.key&&(t.preventDefault(),n.destroy())}),o.prepend(this.candidateBoxElement),this.setupKeyboardNav(l)}},{key:"handleActiveIndex",value:function(e){t.isOpen&&("ArrowDown"===e.key?(e.preventDefault(),this.updateActiveIndex((this.activeIndex+1)%this.candidateOptions.length)):"ArrowUp"===e.key?(e.preventDefault(),this.updateActiveIndex((this.activeIndex-1+this.candidateOptions.length)%this.candidateOptions.length)):"Enter"===e.key||" "===e.key?(e.preventDefault(),this.activateSelectedOption()):"Escape"===e.key?(e.preventDefault(),this.destroy()):"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.preventDefault())}},{key:"setupKeyboardNav",value:function(t){this.candidateOptions=Array.from(t.querySelectorAll('[role="option"]')),this.candidateOptions.forEach(function(t,e){t.id||(t.id="candidate-".concat(e))}),this.setActiveOption(0)}},{key:"setActiveOption",value:function(t){this.activeIndex=t,this.updateActiveIndex(t)}},{key:"updateActiveIndex",value:function(t){var e=this.candidateOptions[this.activeIndex],n=this.candidateOptions[t];if(e&&(e.setAttribute("aria-selected","false"),e.classList.remove("active")),this.activeIndex=t,n){if(n.setAttribute("aria-selected","true"),n.classList.add("active"),n.scrollIntoView({block:"nearest"}),this.globalLiveRegionElement){var i,o=this.candidateOptions.length,a=null===(i=n.textContent)||void 0===i?void 0:i.trim();this.globalLiveRegionElement.textContent="".concat(t+1," of ").concat(o,": ").concat(a)}if(!this.candidateBoxElement)return;var s=this.candidateBoxElement.querySelector(".hg-candidate-box-list");s&&s.setAttribute("aria-activedescendant",n.id)}}},{key:"activateSelectedOption",value:function(){var t=this.candidateOptions[this.activeIndex];if(t){if(this.globalLiveRegionElement){var e,n=null===(e=t.textContent)||void 0===e?void 0:e.trim();this.globalLiveRegionElement.textContent="Inserted: ".concat(n)}t.click(),t.setAttribute("aria-selected","false")}}}],n&&k(e.prototype,n),i&&k(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,i}();E(w,"isOpen",!1);var S=w;function O(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return D(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function M(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,K(i.key),i)}}function B(t,e,n){return(e=K(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K(t){var e=function(t,e){if("object"!=C(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=C(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==C(e)?e:e+""}var P=function(){return t=function t(e,n){var i=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),B(this,"input",void 0),B(this,"options",void 0),B(this,"utilities",void 0),B(this,"caretPosition",void 0),B(this,"caretPositionEnd",void 0),B(this,"keyboardDOM",void 0),B(this,"keyboardPluginClasses",void 0),B(this,"keyboardDOMClass",void 0),B(this,"buttonElements",void 0),B(this,"currentInstanceName",void 0),B(this,"allKeyboardInstances",void 0),B(this,"keyboardInstanceNames",void 0),B(this,"isFirstKeyboardInstance",void 0),B(this,"physicalKeyboard",void 0),B(this,"modules",void 0),B(this,"activeButtonClass",void 0),B(this,"holdInteractionTimeout",void 0),B(this,"holdTimeout",void 0),B(this,"isMouseHold",void 0),B(this,"initialized",void 0),B(this,"candidateBox",void 0),B(this,"keyboardRowsDOM",void 0),B(this,"defaultName","default"),B(this,"activeInputElement",null),B(this,"keyboardInstructions",null),B(this,"keyboardHeader",null),B(this,"instructions",null),B(this,"listenersAdded",!1),B(this,"ariaLiveTimer",null),B(this,"useLiveRegion",!0),B(this,"liveRegionMode","polite"),B(this,"liveRegionDelay",0),B(this,"ariaLabel",""),B(this,"handleUnifiedKeyDownBound",void 0),B(this,"handleKeyUpBound",void 0),B(this,"handleMouseDownBound",void 0),B(this,"handleMouseUpBound",void 0),B(this,"handleTouchEndBound",void 0),B(this,"handleSelectBound",void 0),B(this,"handleSelectionChangeBound",void 0),B(this,"NAV_KEYS",new Set(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab","Home","End","PageUp","PageDown"])),B(this,"MODIFIER_KEYS",new Set(["Shift","Control","Alt","Meta","CapsLock","NumLock","ScrollLock","Fn","FnLock"])),B(this,"NAMED_KEYS_TO_ANNOUNCE",new Set(["Enter","Backspace","Delete","Escape"," ","Spacebar"])),B(this,"NAMED_READABLE",{" ":"Space",Spacebar:"Space"}),B(this,"announcerEl",null),B(this,"navEngaged",!1),B(this,"lastUsedKey",null),B(this,"handleParams",function(t,e){var n,i,o;if("string"==typeof t)n=t.split(".").join(""),i=document.querySelector(".".concat(n)),o=e;else if(t instanceof HTMLDivElement){if(!t.className)throw console.warn("Any DOM element passed as parameter must have a class."),new Error("KEYBOARD_DOM_CLASS_ERROR");n=t.className.split(" ")[0],i=t,o=e}else n="simple-keyboard",i=document.querySelector(".".concat(n)),o=t;return{keyboardDOMClass:n,keyboardDOM:i,options:o}}),B(this,"getOptions",function(){return i.options}),B(this,"getCaretPosition",function(){return i.caretPosition}),B(this,"getCaretPositionEnd",function(){return i.caretPositionEnd}),B(this,"registerModule",function(t,e){i.modules[t]||(i.modules[t]={}),e(i.modules[t])}),B(this,"getKeyboardClassString",function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return[i.keyboardDOMClass].concat(e).filter(function(t){return!!t}).join(" ")}),"undefined"!=typeof window){var o=this.handleParams(e,n),a=o.keyboardDOMClass,s=o.keyboardDOM,r=o.options,u=void 0===r?{}:r;if(!s)throw new Error("Keyboard root not found");this.announcerEl=this.ensureAnnouncer(s),this.utilities=new c({getOptions:this.getOptions,getCaretPosition:this.getCaretPosition,getCaretPositionEnd:this.getCaretPositionEnd,dispatch:this.dispatch}),this.caretPosition=null,this.caretPositionEnd=null,this.keyboardDOM=s,this.options=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach(function(e){B(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({layoutName:"default",theme:"hg-theme-default",inputName:"default",preventMouseDownDefault:!1,enableLayoutCandidates:!0,excludeFromLayout:{}},u),this.keyboardPluginClasses="",c.bindMethods(t,this);var l=this.options.inputName,d=void 0===l?this.defaultName:l;if(this.input={},this.input[d]="",this.keyboardDOMClass=a,this.buttonElements={},window.SimpleKeyboardInstances||(window.SimpleKeyboardInstances={}),this.currentInstanceName=this.utilities.camelCase(this.keyboardDOMClass),window.SimpleKeyboardInstances[this.currentInstanceName]=this,this.allKeyboardInstances=window.SimpleKeyboardInstances,this.keyboardInstanceNames=Object.keys(window.SimpleKeyboardInstances),this.isFirstKeyboardInstance=this.keyboardInstanceNames[0]===this.currentInstanceName,this.physicalKeyboard=new b({dispatch:this.dispatch,getOptions:this.getOptions,getNavEngaged:function(){return i.navEngaged}}),this.candidateBox=this.options.enableLayoutCandidates?new S({utilities:this.utilities,options:this.options}):null,!this.keyboardDOM)throw console.warn('".'.concat(a,'" was not found in the DOM.')),new Error("KEYBOARD_DOM_ERROR");this.render(),this.modules={},this.loadModules()}},e=[{key:"ensureAnnouncer",value:function(t){var e=t.parentElement;if(e){var n=e.querySelector(":scope > .hg-live-region");return n?n.textContent="":((n=document.createElement("div")).className="hg-live-region sr-only",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","false"),t.insertAdjacentElement("afterend",n)),n}var i=t.querySelector(":scope > .hg-live-region");if(i)i.textContent="";else{(i=document.createElement("div")).className="hg-live-region sr-only",i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),i.setAttribute("aria-atomic","false");var o=t.querySelector(":scope > .hg-rows");o&&o.nextSibling?t.insertBefore(i,o.nextSibling):t.appendChild(i)}return i}},{key:"setCaretPosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this.caretPosition=t,this.caretPositionEnd=e}},{key:"getInputCandidates",value:function(t){var e=this,n=this.options,i=n.layoutCandidates,o=n.layoutCandidatesCaseSensitiveMatch;if(!i||"object"!==C(i))return{};var a=Object.keys(i).filter(function(n){var i=t.substring(0,e.getCaretPositionEnd()||0)||t,a=new RegExp("".concat(e.utilities.escapeRegex(n),"$"),o?"g":"gi");return!!O(i.matchAll(a)).length});if(a.length>1){var s=a.sort(function(t,e){return e.length-t.length})[0];return{candidateKey:s,candidateValue:i[s]}}if(a.length){var r=a[0];return{candidateKey:r,candidateValue:i[r]}}return{}}},{key:"showCandidatesBox",value:function(t,e,n){var i=this;this.candidateBox&&this.candidateBox.show({candidateValue:e,targetElement:n,onSelect:function(e,n){var o=i.options,a=o.layoutCandidatesCaseSensitiveMatch,s=o.disableCandidateNormalization,r=o.enableLayoutCandidatesKeyPress,u=e;s||(u=e.normalize("NFD")),"function"==typeof i.options.beforeInputUpdate&&i.options.beforeInputUpdate(i);var l=i.getInput(i.options.inputName,!0),c=i.getCaretPositionEnd()||0,d=l.substring(0,c||0)||l,h=new RegExp("".concat(i.utilities.escapeRegex(t),"$"),a?"g":"gi"),p=d.replace(h,u),f=l.replace(d,p),y=p.length-d.length,v=(c||l.length)+y;v<0&&(v=0),i.setInput(f,i.options.inputName,!0),i.setCaretPosition(v),r&&"function"==typeof i.options.onKeyPress&&i.options.onKeyPress(e,n),"function"==typeof i.options.onChange&&i.options.onChange(i.getInput(i.options.inputName,!0),n),"function"==typeof i.options.onChangeAll&&i.options.onChangeAll(i.getAllInputs(),n)}})}},{key:"handleButtonClicked",value:function(t,e){var n=this.options,i=n.inputName,o=void 0===i?this.defaultName:i;if(n.debug,"{//}"!==t){this.input[o]||(this.input[o]=""),"function"==typeof this.options.beforeInputUpdate&&this.options.beforeInputUpdate(this);var a=this.utilities.getUpdatedInput(t,this.input[o],this.caretPosition,this.caretPositionEnd);if(this.utilities.isStandardButton(t)&&this.activeInputElement&&this.input[o]&&this.input[o]===a&&0===this.caretPosition&&this.caretPositionEnd===a.length)return this.setInput("",this.options.inputName,!0),this.setCaretPosition(0),this.activeInputElement.value="",this.activeInputElement.setSelectionRange(0,0),void this.handleButtonClicked(t,e);if("function"==typeof this.options.onKeyPress&&this.options.onKeyPress(t,e),this.input[o]!==a&&(!this.options.inputPattern||this.options.inputPattern&&this.inputPatternIsValid(a))){if(this.options.maxLength&&this.utilities.handleMaxLength(this.input,a))return;var s=this.utilities.getUpdatedInput(t,this.input[o],this.caretPosition,this.caretPositionEnd,!0);if(this.setInput(s,this.options.inputName,!0),this.options.debug&&console.log("Input changed:",this.getAllInputs()),this.options.debug&&console.log("Caret at: ",this.getCaretPosition(),this.getCaretPositionEnd(),"(".concat(this.keyboardDOMClass,")"),null==e?void 0:e.type),this.options.syncInstanceInputs&&this.syncInstanceInputs(),"function"==typeof this.options.onChange&&this.options.onChange(this.getInput(this.options.inputName,!0),e),"function"==typeof this.options.onChangeAll&&this.options.onChangeAll(this.getAllInputs(),e),null!=e&&e.target&&this.options.enableLayoutCandidates){var r,u=this.getInputCandidates(a),l=u.candidateKey,c=u.candidateValue;l&&c?this.showCandidatesBox(l,c,this.keyboardDOM):null===(r=this.candidateBox)||void 0===r||r.destroy()}}this.caretPositionEnd&&this.caretPosition!==this.caretPositionEnd&&(this.setCaretPosition(this.caretPositionEnd,this.caretPositionEnd),this.activeInputElement&&this.activeInputElement.setSelectionRange(this.caretPositionEnd,this.caretPositionEnd),this.options.debug&&console.log("Caret position aligned",this.caretPosition)),this.options.debug&&console.log("Key pressed:",t)}}},{key:"getMouseHold",value:function(){return this.isMouseHold}},{key:"setMouseHold",value:function(t){this.options.syncInstanceInputs?this.dispatch(function(e){e.isMouseHold=t}):this.isMouseHold=t}},{key:"handleButtonMouseDown",value:function(t,e){var n=this;e&&(this.options.preventMouseDownDefault&&e.preventDefault(),this.options.stopMouseDownPropagation&&e.stopPropagation(),e.target.classList.add(this.activeButtonClass)),this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdTimeout&&clearTimeout(this.holdTimeout),this.setMouseHold(!0),this.options.disableButtonHold||(this.holdTimeout=window.setTimeout(function(){(n.getMouseHold()&&(!t.includes("{")&&!t.includes("}")||"{delete}"===t||"{backspace}"===t||"{bksp}"===t||"{space}"===t||"{tab}"===t)||"{arrowright}"===t||"{arrowleft}"===t||"{arrowup}"===t||"{arrowdown}"===t)&&(n.options.debug&&console.log("Button held:",t),n.handleButtonHold(t)),clearTimeout(n.holdTimeout)},500))}},{key:"handleButtonMouseUp",value:function(t,e){var n=this;e&&(this.options.preventMouseUpDefault&&e.preventDefault&&e.preventDefault(),this.options.stopMouseUpPropagation&&e.stopPropagation&&e.stopPropagation(),!(e.target===this.keyboardDOM||e.target&&this.keyboardDOM.contains(e.target)||this.candidateBox&&this.candidateBox.candidateBoxElement&&(e.target===this.candidateBox.candidateBoxElement||e.target&&this.candidateBox.candidateBoxElement.contains(e.target)))&&this.candidateBox&&this.candidateBox.destroy()),this.recurseButtons(function(t){t.classList.remove(n.activeButtonClass)}),this.setMouseHold(!1),this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),t&&"function"==typeof this.options.onKeyReleased&&this.options.onKeyReleased(t,e)}},{key:"handleKeyboardContainerMouseDown",value:function(t){this.options.preventMouseDownDefault&&t.preventDefault()}},{key:"handleButtonHold",value:function(t){var e=this;this.holdInteractionTimeout&&clearTimeout(this.holdInteractionTimeout),this.holdInteractionTimeout=window.setTimeout(function(){e.getMouseHold()?(e.handleButtonClicked(t),e.handleButtonHold(t)):clearTimeout(e.holdInteractionTimeout)},100)}},{key:"syncInstanceInputs",value:function(){var t=this;this.dispatch(function(e){e.replaceInput(t.input),e.setCaretPosition(t.caretPosition,t.caretPositionEnd)})}},{key:"clearInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.inputName||this.defaultName;this.input[t]="",this.setCaretPosition(0),this.options.syncInstanceInputs&&this.syncInstanceInputs()}},{key:"getInput",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.inputName||this.defaultName,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.options.syncInstanceInputs&&!e&&this.syncInstanceInputs(),this.options.rtl?"‫"+this.input[t].replace("‫","").replace("‬","")+"‬":this.input[t]}},{key:"getAllInputs",value:function(){var t=this,e={};return Object.keys(this.input).forEach(function(n){e[n]=t.getInput(n,!0)}),e}},{key:"setInput",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.inputName||this.defaultName,n=arguments.length>2?arguments[2]:void 0;if("_focusRestore"!==e)this.input[e]=t,!n&&this.options.syncInstanceInputs&&this.syncInstanceInputs();else{var i,o=this.input._focusRestore;this.input._focusRestore=t;var a=this.getOptions().restoreFocusOnChange||"content";if("never"===a)return;if("content"===a&&o===t)return;null===(i=this.keyboardDOM)||void 0===i||i.focus()}}},{key:"replaceInput",value:function(t){this.input=t}},{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.changedOptions(t);if(this.options=Object.assign(this.options,t),e.length&&(this.options.debug&&console.log("changedOptions",e),this.onSetOptions(e),this.render(),t.activeSurface&&"keyboard"!==t.activeSurface&&(this.navEngaged=!1),"keyboard"===t.activeSurface)){var n,i,o,a=null;if(this.lastUsedKey&&(a=null===(n=this.keyboardDOM)||void 0===n?void 0:n.querySelector('[data-skbtnuid="'.concat(this.lastUsedKey,'"]'))),!a){var s,r=(null===(s=this.keyboardDOM)||void 0===s?void 0:s.querySelectorAll(".hg-button"))||[];a=r.length?r[0]:null}a&&(null===(i=this.keyboardDOM)||void 0===i||i.querySelectorAll("[aria-selected='true']").forEach(function(t){return t.setAttribute("aria-selected","false")}),a.setAttribute("aria-selected","true"),null===(o=this.keyboardDOM)||void 0===o||o.setAttribute("aria-activedescendant",a.id),this.handleGetButtonAndAnnounce({key:this.lastUsedKey||a.dataset.skbtnuid}))}}},{key:"changedOptions",value:function(t){var e=this;return Object.keys(t).filter(function(n){return JSON.stringify(t[n])!==JSON.stringify(e.options[n])})}},{key:"onSetOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.includes("layoutName")&&this.candidateBox&&this.candidateBox.destroy(),(t.includes("layoutCandidatesPageSize")||t.includes("layoutCandidates"))&&this.candidateBox&&(this.candidateBox.destroy(),this.candidateBox=new S({utilities:this.utilities,options:this.options}))}},{key:"resetRows",value:function(){this.keyboardRowsDOM&&this.keyboardRowsDOM.remove(),this.keyboardDOM.className=this.keyboardDOMClass,this.keyboardDOM.setAttribute("data-skInstance",this.currentInstanceName),this.buttonElements={}}},{key:"dispatch",value:function(t){if(!window.SimpleKeyboardInstances)throw console.warn("SimpleKeyboardInstances is not defined. Dispatch cannot be called."),new Error("INSTANCES_VAR_ERROR");return Object.keys(window.SimpleKeyboardInstances).forEach(function(e){t(window.SimpleKeyboardInstances[e],e)})}},{key:"addButtonTheme",value:function(t,e){var n=this;e&&t&&(t.split(" ").forEach(function(i){e.split(" ").forEach(function(e){n.options.buttonTheme||(n.options.buttonTheme=[]);var o=!1;n.options.buttonTheme.map(function(t){if(null!=t&&t.class.split(" ").includes(e)){o=!0;var n=t.buttons.split(" ");n.includes(i)||(o=!0,n.push(i),t.buttons=n.join(" "))}return t}),o||n.options.buttonTheme.push({class:e,buttons:t})})}),this.render())}},{key:"removeButtonTheme",value:function(t,e){var n=this;if(!t&&!e)return this.options.buttonTheme=[],void this.render();t&&Array.isArray(this.options.buttonTheme)&&this.options.buttonTheme.length&&(t.split(" ").forEach(function(t){var i;null===(i=n.options)||void 0===i||null===(i=i.buttonTheme)||void 0===i||i.map(function(i,o){if(i&&e&&e.includes(i.class)||!e){var a,s,r=null===(a=i)||void 0===a?void 0:a.buttons.split(" ").filter(function(e){return e!==t});i&&null!=r&&r.length?i.buttons=r.join(" "):(null===(s=n.options.buttonTheme)||void 0===s||s.splice(o,1),i=null)}return i})}),this.render())}},{key:"getButtonElement",value:function(t){var e,n=this.buttonElements[t];return n&&(e=n.length>1?n:n[0]),e}},{key:"inputPatternIsValid",value:function(t){var e,n=this.options.inputPattern;if((e=n instanceof RegExp?n:n[this.options.inputName||this.defaultName])&&t){var i=e.test(t);return this.options.debug&&console.log('inputPattern ("'.concat(e,'"): ').concat(i?"passed":"did not pass!")),i}return!0}},{key:"removeEventListeners",value:function(){document.removeEventListener("keydown",this.handleUnifiedKeyDownBound),document.removeEventListener("keyup",this.handleKeyUpBound),document.removeEventListener("mouseup",this.handleMouseUpBound),document.removeEventListener("touchend",this.handleTouchEndBound),document.removeEventListener("select",this.handleSelectBound),this.options.updateCaretOnSelectionChange&&document.removeEventListener("selectionchange",this.handleSelectionChangeBound),this.listenersAdded=!1}},{key:"setEventListeners",value:function(){var t=this;if(this.isFirstKeyboardInstance||!this.allKeyboardInstances){if(this.options.debug&&console.log("Caret handling started (".concat(this.keyboardDOMClass,")")),this.listenersAdded)return;this.removeEventListeners(),this.handleUnifiedKeyDownBound=this.handleUnifiedKeyDown.bind(this),this.handleKeyUpBound=this.handleKeyUp.bind(this),this.handleMouseUpBound=this.handleMouseUp.bind(this),this.handleTouchEndBound=function(){return t.handleTouchEnd(t)},this.handleSelectBound=function(){return t.handleSelect(t)},this.handleSelectionChangeBound=this.handleSelectionChange.bind(this),document.addEventListener("keydown",this.handleUnifiedKeyDownBound),document.addEventListener("keyup",this.handleKeyUpBound),document.addEventListener("mouseup",this.handleMouseUpBound),document.addEventListener("touchend",this.handleTouchEndBound),this.options.updateCaretOnSelectionChange&&document.addEventListener("selectionchange",this.handleSelectionChangeBound),document.addEventListener("select",this.handleSelectBound),this.listenersAdded=!0}}},{key:"handleUnifiedKeyDown",value:function(t){this.handleInternalKeyNav(t),this.handleKeyDown(t)}},{key:"logEventType",value:function(t,e){this.getOptions().debug&&console.log("[".concat(t,"] Event type:"),e.type,"→",e.constructor.name)}},{key:"isSupportedEvent",value:function(t){return t instanceof KeyboardEvent||t instanceof MouseEvent||"undefined"!=typeof TouchEvent&&t instanceof TouchEvent||t instanceof PointerEvent}},{key:"handleGetButtonAndAnnounce",value:function(t){this.isSupportedEvent(t)&&this.getButtonAndAnnounce(t)}},{key:"handleKeyUp",value:function(t){if(!S.isOpen){var e=t.key,n=new Set(["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape"," ","Spacebar"]);if(this.options.physicalKeyboardHighlightPreventDefault&&t instanceof KeyboardEvent){var i=1===e.length;!n.has(e)&&i&&t.preventDefault()}this.caretEventHandler(t),this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyUp(t)}}},{key:"resolveKey",value:function(t,e){var n=this.keyboardDOM.querySelector('.hg-button[aria-selected="true"]'),i=null==n?void 0:n.getAttribute("data-skbtn");return i?e||"Enter"!==t&&" "!==t&&"Spacebar"!==t?"Enter"===t||" "===t||"Spacebar"===t?i:t:"Enter"===t?"{enter}":"{space}":t}},{key:"handleKeyDown",value:function(t){if(!S.isOpen){var e=this.getOptions(),n="Spacebar"===t.key?" ":t.key,i=new Set(["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape"," ","Spacebar"]);if(this.options.physicalKeyboardHighlightPreventDefault&&t instanceof KeyboardEvent){var o=1===n.length;!i.has(n)&&o&&t.preventDefault()}if(t instanceof KeyboardEvent&&("Enter"===n||" "===n||"Spacebar"===n)){var a=this.navEngaged&&"keyboard"===e.activeSurface;if(a){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var s=this.resolveKey(n,a);return void(s&&this.handleButtonClicked(s,t))}}this.logEventType("Keyboard",t),this.options.physicalKeyboardHighlight&&this.physicalKeyboard.handleHighlightKeyDown(t),this.handleGetButtonAndAnnounce(t)}}},{key:"isPhysicalKeyMatchingButton",value:function(t,e){return" "===t.key||"Spacebar"===t.key?"{space}"===e||e.toLowerCase().includes("space"):1===t.key.length?e===t.key.toLowerCase()||e===t.key.toUpperCase():"Enter"===t.key&&("{enter}"===e||e.toLowerCase().includes("enter"))}},{key:"getAnnounceLabel",value:function(t){var e,n=this.NAMED_KEYS_TO_ANNOUNCE.has(t),i=1===t.length,o=document.activeElement,a=(null==o?void 0:o.getAttribute("aria-label"))||(null==o||null===(e=o.textContent)||void 0===e?void 0:e.trim())||(null==o?void 0:o.getAttribute("data-skbtn"));return n&&a&&a!==t?a:i||n?this.NAMED_READABLE[t]||t:null}},{key:"shouldSuppressAnnouncements",value:function(){if(!this.options.useLiveRegion)return!0;if("none"===(this.options.liveRegionAnnounceMode||"actions"))return!0;if(this.options.suppressAnnouncementsOnInputFocus){var t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName))return!0}return!1}},{key:"getContentForButton",value:function(t){if("{space}"===t)return"space";if("{enter}"===t)return"new line";if("{bksp}"===t||"{backspace}"===t)return"deleted";if("{tab}"===t)return"tab";if("{delete}"===t)return"deleted";if(1===t.length)return t;var e=this.utilities.getButtonDisplayName(t,this.options.display,this.options.mergeDisplay);return e!==t?e:null}},{key:"getButtonAndAnnounce",value:function(t){var e=this;if(this.isSupportedEvent(t)&&!this.shouldSuppressAnnouncements()){var n=null,i=null;if(t instanceof KeyboardEvent){if(t.isComposing||t.repeat)return;n=t.key}if(t instanceof MouseEvent||t instanceof PointerEvent||"undefined"!=typeof TouchEvent&&t instanceof TouchEvent){var o,a,s,r=null===(o=t.target)||void 0===o||null===(a=o.closest)||void 0===a?void 0:a.call(o,"[data-skbtn]");if(!r||!this.keyboardDOM.contains(r))return;i=r.getAttribute("data-skbtn"),n=r.getAttribute("aria-label")||(null===(s=r.textContent)||void 0===s?void 0:s.trim())||i}if(n){var u=this.options.liveRegionAnnounceMode||"actions";if("none"!==u){if("actions"===u||"both"===u){var l=this.getAnnounceLabel(n);l&&this.announceLiveRegion(l,"pressed")}if(("content"===u||"both"===u)&&i){var c=this.getContentForButton(i);c&&setTimeout(function(){e.announceLiveRegion(c,"")},"both"===u?200:0)}}}}}},{key:"announceLiveRegion",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pressed";this.options.useLiveRegion&&this.announcerEl&&(this.ariaLiveTimer&&clearTimeout(this.ariaLiveTimer),this.ariaLiveTimer=setTimeout(function(){e.announcerEl&&(e.announcerEl.textContent="",requestAnimationFrame(function(){e.announcerEl&&(e.announcerEl.textContent="Key ".concat(t," ").concat(n))}))},100))}},{key:"handleInternalKeyNav",value:function(t){var e;if(t instanceof KeyboardEvent&&null!==(e=this.keyboardDOM)&&void 0!==e&&e.offsetParent&&!S.isOpen){var n=this.getOptions();if(n.debug&&console.log("Current Options:",n),n.debug&&console.log("[handleInternalKeyNav] Internal Key Nav:",t.key,"Active Surface:",n.activeSurface),"keyboard"===n.activeSurface){n.debug&&console.log("[handleInternalKeyNav] Handling Internal Key Nav:",t.key);var i=t.key;if(["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"].includes(i)){n.debug&&console.log("[handleInternalKeyNav] Arrow key pressed:",i),t.preventDefault();var o=this.keyboardDOM.querySelector('[aria-selected="true"]');if(o&&o.hasAttribute("data-skbtnuid")){var a=null;switch(i){case"ArrowRight":a=this.findNextButton(o);break;case"ArrowLeft":a=this.findPreviousButton(o);break;case"ArrowDown":a=this.findVerticalButton(o,"down");break;case"ArrowUp":a=this.findVerticalButton(o,"up")}a&&(o.setAttribute("aria-selected","false"),this.lastUsedKey=a.getAttribute("data-skbtnuid")||null,a.setAttribute("aria-selected","true"),this.keyboardDOM.setAttribute("aria-activedescendant",a.id)),this.navEngaged=!0}}}}}},{key:"findNextButton",value:function(t){var e=Array.from(this.keyboardDOM.querySelectorAll("[data-skBtn]")),n=e.indexOf(t);return e[n+1]||null}},{key:"findPreviousButton",value:function(t){var e=Array.from(this.keyboardDOM.querySelectorAll("[data-skBtn]")),n=e.indexOf(t);return e[n-1]||null}},{key:"findVerticalButton",value:function(t,e){var n=Array.from(this.keyboardDOM.querySelectorAll(".hg-row")),i=t.closest(".hg-row");if(!i)return null;var o=n.indexOf(i),a=n["up"===e?o-1:o+1];if(!a)return null;var s=t.getBoundingClientRect(),r=s.left+s.width/2,u=Array.from(a.querySelectorAll("[data-skBtn]"));if(!u.length)return null;for(var l=u[0],c=Number.POSITIVE_INFINITY,d=0,h=u;d<h.length;d++){var p=h[d],f=p.getBoundingClientRect(),y=f.left+f.width/2,v=Math.abs(y-r);v<c&&(c=v,l=p)}return l}},{key:"handleMouseUp",value:function(t){this.caretEventHandler(t),this.logEventType("Mouse",t),this.handleGetButtonAndAnnounce(t)}},{key:"handleTouchEnd",value:function(t){this.caretEventHandler(t),this.logEventType("Touch",t),this.handleGetButtonAndAnnounce(t)}},{key:"handleSelect",value:function(t){this.caretEventHandler(t)}},{key:"handleSelectionChange",value:function(t){navigator.userAgent.includes("Firefox")||this.caretEventHandler(t)}},{key:"caretEventHandler",value:function(t){var e=this,n=null==t?void 0:t.target,i="";null!=n&&n.tagName&&(i=n.tagName.toLowerCase()),this.dispatch(function(n){var o=t.target===n.keyboardDOM||t.target&&n.keyboardDOM.contains(t.target);if(e.options.syncInstanceInputs&&Array.isArray(t.path)&&(o=t.path.some(function(t){var e;return null==t||null===(e=t.hasAttribute)||void 0===e?void 0:e.call(t,"data-skInstance")})),("textarea"===i||"input"===i&&["text","search","url","tel","password"].includes(t.target.type))&&!n.options.disableCaretPositioning){var a=t.target.selectionStart,s=t.target.selectionEnd;n.options.rtl&&(a=n.utilities.getRtlOffset(a,n.getInput()),s=n.utilities.getRtlOffset(s,n.getInput())),n.setCaretPosition(a,s),n.activeInputElement=t.target,n.options.debug&&console.log("Caret at: ",n.getCaretPosition(),n.getCaretPositionEnd(),t&&t.target.tagName.toLowerCase(),"(".concat(n.keyboardDOMClass,")"),null==t?void 0:t.type)}else!n.options.disableCaretPositioning&&o||"selectionchange"===(null==t?void 0:t.type)||(n.setCaretPosition(null),n.activeInputElement=null,n.options.debug&&console.log('Caret position reset due to "'.concat(null==t?void 0:t.type,'" event'),t))})}},{key:"recurseButtons",value:function(t){var e=this;t&&Object.keys(this.buttonElements).forEach(function(n){return e.buttonElements[n].forEach(t)})}},{key:"destroy",value:function(){this.options.debug&&console.log("Destroying simple-keyboard instance: ".concat(this.currentInstanceName)),this.removeEventListeners(),document.onpointerup=null,document.ontouchend=null,document.ontouchcancel=null,document.onmouseup=null,this.recurseButtons(function(t){t&&(t.onpointerdown=null,t.onpointerup=null,t.onpointercancel=null,t.ontouchstart=null,t.ontouchend=null,t.ontouchcancel=null,t.onclick=null,t.onmousedown=null,t.onmouseup=null,t.remove(),t=null)}),this.keyboardDOM.onpointerdown=null,this.keyboardDOM.ontouchstart=null,this.keyboardDOM.onmousedown=null,this.resetRows(),this.candidateBox&&(this.candidateBox.destroy(),this.candidateBox=null),this.activeInputElement=null,this.keyboardDOM.removeAttribute("data-skInstance"),this.keyboardDOM.innerHTML="",window.SimpleKeyboardInstances[this.currentInstanceName]=null,delete window.SimpleKeyboardInstances[this.currentInstanceName],this.initialized=!1,this.navEngaged=!1}},{key:"getButtonThemeClasses",value:function(t){var e=this.options.buttonTheme,n=[];return Array.isArray(e)&&e.forEach(function(e){if(e&&e.class&&"string"==typeof e.class&&e.buttons&&"string"==typeof e.buttons){var i=e.class.split(" ");e.buttons.split(" ").includes(t)&&(n=[].concat(O(n),O(i)))}else console.warn('Incorrect "buttonTheme". Please check the documentation.',e)}),n}},{key:"setDOMButtonAttributes",value:function(t,e){var n=this.options.buttonAttributes;Array.isArray(n)&&n.forEach(function(n){n.attribute&&"string"==typeof n.attribute&&n.value&&"string"==typeof n.value&&n.buttons&&"string"==typeof n.buttons?n.buttons.split(" ").includes(t)&&e(n.attribute,n.value):console.warn('Incorrect "buttonAttributes". Please check the documentation.',n)})}},{key:"onTouchDeviceDetected",value:function(){this.processAutoTouchEvents(),this.disableContextualWindow()}},{key:"disableContextualWindow",value:function(){window.oncontextmenu=function(t){if(t.target.classList.contains("hg-button"))return t.preventDefault(),t.stopPropagation(),!1}}},{key:"processAutoTouchEvents",value:function(){this.options.autoUseTouchEvents&&(this.options.useTouchEvents=!0,this.options.debug&&console.log("autoUseTouchEvents: Touch device detected, useTouchEvents enabled."))}},{key:"onInit",value:function(){this.options.debug&&console.log("".concat(this.keyboardDOMClass," Initialized")),this.announcerEl=this.ensureAnnouncer(this.keyboardDOM),this.setEventListeners(),this.options.autoFocus&&this.handleAutoFocus(),"function"==typeof this.options.onInit&&this.options.onInit(this)}},{key:"beforeFirstRender",value:function(){this.utilities.isTouchDevice()&&this.onTouchDeviceDetected(),"function"==typeof this.options.beforeFirstRender&&this.options.beforeFirstRender(this),this.isFirstKeyboardInstance&&this.utilities.pointerEventsSupported()&&!this.options.useTouchEvents&&!this.options.useMouseEvents&&this.options.debug&&console.log("Using PointerEvents as it is supported by this browser"),this.options.useTouchEvents&&this.options.debug&&console.log("useTouchEvents has been enabled. Only touch events will be used.")}},{key:"beforeRender",value:function(){"function"==typeof this.options.beforeRender&&this.options.beforeRender(this)}},{key:"onRender",value:function(){"function"==typeof this.options.onRender&&this.options.onRender(this),this.announcerEl=this.ensureAnnouncer(this.keyboardDOM)}},{key:"handleAutoFocus",value:function(){var t=this;setTimeout(function(){requestAnimationFrame(function(){if(t.keyboardDOM.querySelector('[data-skBtn][aria-selected="true"]'))t.options.debug&&console.log("AutoFocus: First keyboard button already active");else{var e=t.keyboardDOM.querySelector("[data-skBtn]");e?(e.setAttribute("aria-selected","true"),t.options.debug&&console.log("AutoFocus: Activated fallback keyboard button")):t.options.debug&&console.warn("AutoFocus: No keyboard buttons found to activate!")}})},0)}},{key:"onModulesLoaded",value:function(){"function"==typeof this.options.onModulesLoaded&&this.options.onModulesLoaded(this)}},{key:"loadModules",value:function(){var t=this;Array.isArray(this.options.modules)&&(this.options.modules.forEach(function(e){var n=t.utilities.isConstructor(e)?new e(t):e(t);n.init&&n.init(t)}),this.keyboardPluginClasses="modules-loaded",this.render(),this.onModulesLoaded())}},{key:"getModuleProp",value:function(t,e){return!!this.modules[t]&&this.modules[t][e]}},{key:"getModulesList",value:function(){return Object.keys(this.modules)}},{key:"parseRowDOMContainers",value:function(t,e,n,i){var o=this,a=Array.from(t.children),s=0;return a.length&&n.forEach(function(n,r){var u=i[r];if(!(u&&u>n))return!1;var l=n-s,c=u-s,d=document.createElement("div");d.className+="hg-button-container";var h="".concat(o.options.layoutName,"-r").concat(e,"c").concat(r);d.setAttribute("data-skUID",h);var p=a.splice(l,c-l+1);s+=c-l,p.forEach(function(t){return d.appendChild(t)}),a.splice(l,0,d),t.innerHTML="",a.forEach(function(e){return t.appendChild(e)}),o.options.debug&&console.log("rowDOMContainer",p,l,c,s+1)}),t}},{key:"restoreRovingSelection",value:function(){if(this.keyboardDOM){var t=null;this.lastUsedKey&&(t=this.lastUsedKey.split("-")[1]);var e=this.keyboardDOM.querySelector('[data-skbtnuid$="'.concat(t,'"]'));console.log("Restoring roving selection to:",this.lastUsedKey,e),e||(e=this.keyboardDOM.querySelector(".hg-button")),e&&(this.keyboardDOM.querySelectorAll(".hg-button").forEach(function(t){return t.setAttribute("aria-selected","false")}),e.setAttribute("aria-selected","true"),this.keyboardDOM.setAttribute("aria-activedescendant",e.id))}}},{key:"render",value:function(){var t,e,n,i,o,a,s,r,u=this;this.resetRows(),this.initialized||this.beforeFirstRender(),this.beforeRender();var l="hg-layout-".concat(this.options.layoutName),c=this.options.layout||{default:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","{lock} a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}",".com @ {space}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'{lock} A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}",".com @ {space}"]},d=this.options.useTouchEvents||!1,h=d?"hg-touch-events":"",p=this.options.useMouseEvents||!1,f=this.options.disableRowButtonContainers;this.keyboardDOM.className=this.getKeyboardClassString(this.options.theme,l,this.keyboardPluginClasses,h),this.keyboardDOM.setAttribute("data-skInstance",this.currentInstanceName),null!==(e=(t=this.options).useLiveRegion)&&void 0!==e||(t.useLiveRegion=!0),null!==(i=(n=this.options).liveRegionMode)&&void 0!==i||(n.liveRegionMode="polite"),null!==(a=(o=this.options).liveRegionDelay)&&void 0!==a||(o.liveRegionDelay=100),null!==(r=(s=this.options).ariaLabel)&&void 0!==r||(s.ariaLabel="Virtual Keyboard"),this.keyboardDOM.setAttribute("role","application"),this.keyboardDOM.setAttribute("aria-label",this.options.ariaLabel||"Virtual Keyboard"),this.keyboardDOM.setAttribute("tabindex","-1"),this.instructions=this.options.instructions||"Arrow keys navigate. Enter to select. Tab to exit keyboard, Shift+Tab to return.",this.keyboardDOM.querySelector("#hg-virtual-keyboard-header")||(this.keyboardHeader=document.createElement("h2"),this.keyboardHeader.classList.add("hg-header","sr-only"),this.keyboardHeader.id="hg-virtual-keyboard-header",this.keyboardHeader.textContent="QWERTY Virtual Keyboard",this.keyboardDOM.appendChild(this.keyboardHeader),this.keyboardDOM.setAttribute("aria-labelledby",this.keyboardHeader.id)),this.keyboardDOM.querySelector("#hg-virtual-keyboard-instructions")||(this.keyboardInstructions=document.createElement("p"),this.keyboardInstructions.classList.add("hg-instructions","sr-only"),this.keyboardInstructions.id="hg-virtual-keyboard-instructions",this.keyboardInstructions.setAttribute("role","note"),this.keyboardInstructions.textContent=this.instructions,this.keyboardDOM.appendChild(this.keyboardInstructions),this.keyboardDOM.setAttribute("aria-describedby",this.keyboardInstructions.id)),this.keyboardRowsDOM=document.createElement("div"),this.keyboardRowsDOM.className="hg-rows",c[this.options.layoutName||this.defaultName].forEach(function(t,e){var n=t.split(" ");u.options.excludeFromLayout&&u.options.excludeFromLayout[u.options.layoutName||u.defaultName]&&(n=n.filter(function(t){return u.options.excludeFromLayout&&!u.options.excludeFromLayout[u.options.layoutName||u.defaultName].includes(t)}));var i=document.createElement("div");i.className+="hg-row";var o=[],a=[];n.forEach(function(t,n){var s,r=!f&&"string"==typeof t&&t.length>1&&0===t.indexOf("["),l=!f&&"string"==typeof t&&t.length>1&&t.indexOf("]")===t.length-1;r&&(o.push(n),t=t.replace(/\[/g,"")),l&&(a.push(n),t=t.replace(/\]/g,""));var c=u.utilities.getButtonClass(t),h=u.utilities.getButtonDisplayName(t,u.options.display,u.options.mergeDisplay),y=u.options.useButtonTag?"button":"div",v=document.createElement(y);v.className+="hg-button ".concat(c),(s=v.classList).add.apply(s,O(u.getButtonThemeClasses(t))),u.setDOMButtonAttributes(t,function(t,e){v.setAttribute(t,e)}),u.activeButtonClass="hg-activeButton",!u.utilities.pointerEventsSupported()||d||p?d?(v.ontouchstart=function(e){u.handleButtonClicked(t,e),u.handleButtonMouseDown(t,e)},v.ontouchend=function(e){u.handleButtonMouseUp(t,e)},v.ontouchcancel=function(e){u.handleButtonMouseUp(t,e)}):(v.onclick=function(e){u.setMouseHold(!1),"function"==typeof u.options.onKeyReleased||u.options.useMouseEvents&&u.options.clickOnMouseDown||u.handleButtonClicked(t,e)},v.onmousedown=function(e){("function"==typeof u.options.onKeyReleased||u.options.useMouseEvents&&u.options.clickOnMouseDown)&&!u.isMouseHold&&u.handleButtonClicked(t,e),u.handleButtonMouseDown(t,e)},v.onmouseup=function(e){u.handleButtonMouseUp(t,e)}):(v.onpointerdown=function(e){u.handleButtonClicked(t,e),u.handleButtonMouseDown(t,e)},v.onpointerup=function(e){u.handleButtonMouseUp(t,e)},v.onpointercancel=function(e){u.handleButtonMouseUp(t,e)}),v.setAttribute("data-skBtn",t);var g="".concat(u.options.layoutName,"-r").concat(e,"b").concat(n);v.setAttribute("data-skBtnUID",g),"div"===y&&v.setAttribute("role","button"),v.setAttribute("aria-selected","false"),v.setAttribute("tabindex","-1"),v.setAttribute("aria-label",h),v.setAttribute("title",h),v.id="key-".concat(e,"-").concat(n,"-").concat(t.replace(/\s+/g,"-"));var b=document.createElement("span");b.innerHTML=h,v.appendChild(b),u.buttonElements[t]||(u.buttonElements[t]=[]),u.buttonElements[t].push(v),i.appendChild(v)}),i=u.parseRowDOMContainers(i,e,o,a),u.keyboardRowsDOM.appendChild(i)}),this.keyboardDOM.appendChild(this.keyboardRowsDOM),this.restoreRovingSelection(),this.onRender(),this.initialized||(this.initialized=!0,!this.utilities.pointerEventsSupported()||d||p?d?(document.ontouchend=function(t){return u.handleButtonMouseUp(void 0,t)},document.ontouchcancel=function(t){return u.handleButtonMouseUp(void 0,t)},this.keyboardDOM.ontouchstart=function(t){return u.handleKeyboardContainerMouseDown(t)}):d||(document.onmouseup=function(t){return u.handleButtonMouseUp(void 0,t)},this.keyboardDOM.onmousedown=function(t){return u.handleKeyboardContainerMouseDown(t)}):(document.onpointerup=function(t){return u.handleButtonMouseUp(void 0,t)},this.keyboardDOM.onpointerdown=function(t){return u.handleKeyboardContainerMouseDown(t)}),this.onInit())}}],e&&M(t.prototype,e),n&&M(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}(),L=P,N=L;return e}()});
//# sourceMappingURL=index.modern.js.map