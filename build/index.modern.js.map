{"version":3,"file":"index.modern.js","mappings":"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","sources":["webpack://SimpleKeyboard/webpack/universalModuleDefinition","webpack://SimpleKeyboard/webpack/bootstrap","webpack://SimpleKeyboard/webpack/runtime/define property getters","webpack://SimpleKeyboard/webpack/runtime/hasOwnProperty shorthand","webpack://SimpleKeyboard/webpack/runtime/make namespace object","webpack://SimpleKeyboard/./src/lib/services/Utilities.ts","webpack://SimpleKeyboard/./src/lib/services/PhysicalKeyboard.ts","webpack://SimpleKeyboard/./src/lib/services/KeyboardLayout.ts","webpack://SimpleKeyboard/./src/lib/components/CandidateBox.ts","webpack://SimpleKeyboard/./src/lib/components/Keyboard.ts","webpack://SimpleKeyboard/./src/lib/index.modern.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SimpleKeyboard\"] = factory();\n\telse\n\t\troot[\"SimpleKeyboard\"] = factory();\n})(this, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { KeyboardInput } from './../interfaces';\r\nimport { KeyboardOptions, UtilitiesParams } from '../interfaces';\r\n\r\n/**\r\n * Utility Service\r\n */\r\nclass Utilities {\r\n  getOptions: () => KeyboardOptions;\r\n  getCaretPosition: () => number | null;\r\n  getCaretPositionEnd: () => number | null;\r\n  dispatch: any;\r\n  maxLengthReached!: boolean;\r\n\r\n  /**\r\n   * Creates an instance of the Utility service\r\n   */\r\n  constructor({ getOptions, getCaretPosition, getCaretPositionEnd, dispatch }: UtilitiesParams) {\r\n    this.getOptions = getOptions;\r\n    this.getCaretPosition = getCaretPosition;\r\n    this.getCaretPositionEnd = getCaretPositionEnd;\r\n    this.dispatch = dispatch;\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(Utilities, this);\r\n  }\r\n\r\n  /**\r\n   * Retrieve button type\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @return {string} The button type\r\n   */\r\n  getButtonType(button: string): string {\r\n    return button.includes('{') && button.includes('}') && button !== '{//}' ? 'functionBtn' : 'standardBtn';\r\n  }\r\n\r\n  /**\r\n   * Adds default classes to a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @return {string} The classes to be added to the button\r\n   */\r\n  getButtonClass(button: string): string {\r\n    const buttonTypeClass = this.getButtonType(button);\r\n    const buttonWithoutBraces = button.replace('{', '').replace('}', '');\r\n    let buttonNormalized = '';\r\n\r\n    if (buttonTypeClass !== 'standardBtn') buttonNormalized = ` hg-button-${buttonWithoutBraces}`;\r\n\r\n    return `hg-${buttonTypeClass}${buttonNormalized}`;\r\n  }\r\n\r\n  /**\r\n   * Default button display labels\r\n   */\r\n  getDefaultDisplay() {\r\n    return {\r\n      '{bksp}': 'backspace',\r\n      '{backspace}': 'backspace',\r\n      '{enter}': '< enter',\r\n      '{shift}': 'shift',\r\n      '{shiftleft}': 'shift',\r\n      '{shiftright}': 'shift',\r\n      '{alt}': 'alt',\r\n      '{s}': 'shift',\r\n      '{tab}': 'tab',\r\n      '{lock}': 'caps',\r\n      '{capslock}': 'caps',\r\n      '{accept}': 'Submit',\r\n      '{space}': ' ',\r\n      '{//}': ' ',\r\n      '{esc}': 'esc',\r\n      '{escape}': 'esc',\r\n      '{f1}': 'f1',\r\n      '{f2}': 'f2',\r\n      '{f3}': 'f3',\r\n      '{f4}': 'f4',\r\n      '{f5}': 'f5',\r\n      '{f6}': 'f6',\r\n      '{f7}': 'f7',\r\n      '{f8}': 'f8',\r\n      '{f9}': 'f9',\r\n      '{f10}': 'f10',\r\n      '{f11}': 'f11',\r\n      '{f12}': 'f12',\r\n      '{numpaddivide}': '/',\r\n      '{numlock}': 'lock',\r\n      '{arrowup}': '',\r\n      '{arrowleft}': '',\r\n      '{arrowdown}': '',\r\n      '{arrowright}': '',\r\n      '{prtscr}': 'print',\r\n      '{scrolllock}': 'scroll',\r\n      '{pause}': 'pause',\r\n      '{insert}': 'ins',\r\n      '{home}': 'home',\r\n      '{pageup}': 'up',\r\n      '{delete}': 'del',\r\n      '{forwarddelete}': 'del',\r\n      '{end}': 'end',\r\n      '{pagedown}': 'down',\r\n      '{numpadmultiply}': '*',\r\n      '{numpadsubtract}': '-',\r\n      '{numpadadd}': '+',\r\n      '{numpadenter}': 'enter',\r\n      '{period}': '.',\r\n      '{numpaddecimal}': '.',\r\n      '{numpad0}': '0',\r\n      '{numpad1}': '1',\r\n      '{numpad2}': '2',\r\n      '{numpad3}': '3',\r\n      '{numpad4}': '4',\r\n      '{numpad5}': '5',\r\n      '{numpad6}': '6',\r\n      '{numpad7}': '7',\r\n      '{numpad8}': '8',\r\n      '{numpad9}': '9',\r\n    };\r\n  }\r\n  /**\r\n   * Returns the display (label) name for a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @param  {object} display The provided display option\r\n   * @param  {boolean} mergeDisplay Whether the provided param value should be merged with the default one.\r\n   */\r\n  getButtonDisplayName(button: string, display: KeyboardOptions['display'], mergeDisplay = false) {\r\n    if (mergeDisplay) {\r\n      display = Object.assign({}, this.getDefaultDisplay(), display);\r\n    } else {\r\n      display = display || this.getDefaultDisplay();\r\n    }\r\n\r\n    return display[button] || button;\r\n  }\r\n\r\n  /**\r\n   * Returns the updated input resulting from clicking a given button\r\n   *\r\n   * @param  {string} button The button's layout name\r\n   * @param  {string} input The input string\r\n   * @param  {number} caretPos The cursor's current position\r\n   * @param  {number} caretPosEnd The cursor's current end position\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  getUpdatedInput(button: string, input: string, caretPos: any, caretPosEnd = caretPos, moveCaret = false) {\r\n    const options = this.getOptions();\r\n    const commonParams: [number | undefined, number | undefined, boolean] = [caretPos, caretPosEnd, moveCaret];\r\n\r\n    let output = input;\r\n\r\n    if ((button === '{bksp}' || button === '{backspace}') && output.length > 0) {\r\n      output = this.removeAt(output, ...commonParams);\r\n    } else if ((button === '{delete}' || button === '{forwarddelete}') && output.length > 0) {\r\n      output = this.removeForwardsAt(output, ...commonParams);\r\n    } else if (button === '{space}') output = this.addStringAt(output, ' ', ...commonParams);\r\n    else if (button === '{tab}' && !(typeof options.tabCharOnTab === 'boolean' && options.tabCharOnTab === false)) {\r\n      output = this.addStringAt(output, '\\t', ...commonParams);\r\n    } else if ((button === '{enter}' || button === '{numpadenter}') && options.newLineOnEnter)\r\n      output = this.addStringAt(output, '\\n', ...commonParams);\r\n    else if (button.includes('numpad') && Number.isInteger(Number(button[button.length - 2]))) {\r\n      output = this.addStringAt(output, button[button.length - 2], ...commonParams);\r\n    } else if (button === '{numpaddivide}') output = this.addStringAt(output, '/', ...commonParams);\r\n    else if (button === '{numpadmultiply}') output = this.addStringAt(output, '*', ...commonParams);\r\n    else if (button === '{numpadsubtract}') output = this.addStringAt(output, '-', ...commonParams);\r\n    else if (button === '{numpadadd}') output = this.addStringAt(output, '+', ...commonParams);\r\n    else if (button === '{numpaddecimal}') output = this.addStringAt(output, '.', ...commonParams);\r\n    else if (button === '{' || button === '}') output = this.addStringAt(output, button, ...commonParams);\r\n    else if (!button.includes('{') && !button.includes('}')) output = this.addStringAt(output, button, ...commonParams);\r\n\r\n    if (options.debug) {\r\n      console.log('Input will be: ' + output);\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Moves the cursor position by a given amount\r\n   *\r\n   * @param  {number} length Represents by how many characters the input should be moved\r\n   * @param  {boolean} minus Whether the cursor should be moved to the left or not.\r\n   */\r\n  updateCaretPos(length: number, minus = false) {\r\n    const newCaretPos = this.updateCaretPosAction(length, minus);\r\n\r\n    this.dispatch((instance: any) => {\r\n      instance.setCaretPosition(newCaretPos);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Action method of updateCaretPos\r\n   *\r\n   * @param  {number} length Represents by how many characters the input should be moved\r\n   * @param  {boolean} minus Whether the cursor should be moved to the left or not.\r\n   */\r\n  updateCaretPosAction(length: number, minus = false) {\r\n    const options = this.getOptions();\r\n    let caretPosition = this.getCaretPosition();\r\n\r\n    if (caretPosition != null) {\r\n      if (minus) {\r\n        if (caretPosition > 0) caretPosition = caretPosition - length;\r\n      } else {\r\n        caretPosition = caretPosition + length;\r\n      }\r\n    }\r\n\r\n    if (options.debug) {\r\n      console.log('Caret at:', caretPosition);\r\n    }\r\n\r\n    return caretPosition;\r\n  }\r\n\r\n  /**\r\n   * Adds a string to the input at a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {string} str The string to add\r\n   * @param  {number} position The (cursor) position where the string should be added\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  addStringAt(source: string, str: string, position = source.length, positionEnd = source.length, moveCaret = false) {\r\n    let output;\r\n\r\n    if (!position && position !== 0) {\r\n      output = source + str;\r\n    } else {\r\n      output = [source.slice(0, position), str, source.slice(positionEnd)].join('');\r\n\r\n      /**\r\n       * Avoid caret position change when maxLength is set\r\n       */\r\n      if (!this.isMaxLengthReached()) {\r\n        if (moveCaret) this.updateCaretPos(str.length);\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Check whether the button is a standard button\r\n   */\r\n  isStandardButton = (button: string) => button && !(button[0] === '{' && button[button.length - 1] === '}');\r\n\r\n  /**\r\n   * Removes an amount of characters before a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {number} position The (cursor) position from where the characters should be removed\r\n   * @param  {boolean} moveCaret Whether to update simple-keyboard's cursor\r\n   */\r\n  removeAt(source: string, position = source.length, positionEnd = source.length, moveCaret = false) {\r\n    if (position === 0 && positionEnd === 0) {\r\n      return source;\r\n    }\r\n\r\n    let output;\r\n\r\n    if (position === positionEnd) {\r\n      let prevTwoChars;\r\n      let emojiMatched;\r\n      const emojiMatchedReg = /([\\uD800-\\uDBFF][\\uDC00-\\uDFFF])/g;\r\n\r\n      /**\r\n       * Emojis are made out of two characters, so we must take a custom approach to trim them.\r\n       * For more info: https://mathiasbynens.be/notes/javascript-unicode\r\n       */\r\n      if (position && position >= 0) {\r\n        prevTwoChars = source.substring(position - 2, position);\r\n        emojiMatched = prevTwoChars.match(emojiMatchedReg);\r\n\r\n        if (emojiMatched) {\r\n          output = source.substr(0, position - 2) + source.substr(position);\r\n          if (moveCaret) this.updateCaretPos(2, true);\r\n        } else {\r\n          output = source.substr(0, position - 1) + source.substr(position);\r\n          if (moveCaret) this.updateCaretPos(1, true);\r\n        }\r\n      } else {\r\n        prevTwoChars = source.slice(-2);\r\n        emojiMatched = prevTwoChars.match(emojiMatchedReg);\r\n\r\n        if (emojiMatched) {\r\n          output = source.slice(0, -2);\r\n          if (moveCaret) this.updateCaretPos(2, true);\r\n        } else {\r\n          output = source.slice(0, -1);\r\n          if (moveCaret) this.updateCaretPos(1, true);\r\n        }\r\n      }\r\n    } else {\r\n      output = source.slice(0, position) + source.slice(positionEnd);\r\n      if (moveCaret) {\r\n        this.dispatch((instance: any) => {\r\n          instance.setCaretPosition(position);\r\n        });\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Removes an amount of characters after a given position\r\n   *\r\n   * @param  {string} source The source input\r\n   * @param  {number} position The (cursor) position from where the characters should be removed\r\n   */\r\n  removeForwardsAt(\r\n    source: string,\r\n    position: number = source.length,\r\n    positionEnd: number = source.length,\r\n    moveCaret = false\r\n  ) {\r\n    if (!source?.length || position === null) {\r\n      return source;\r\n    }\r\n\r\n    let output;\r\n\r\n    if (position === positionEnd) {\r\n      const emojiMatchedReg = /([\\uD800-\\uDBFF][\\uDC00-\\uDFFF])/g;\r\n\r\n      /**\r\n       * Emojis are made out of two characters, so we must take a custom approach to trim them.\r\n       * For more info: https://mathiasbynens.be/notes/javascript-unicode\r\n       */\r\n      const nextTwoChars = source.substring(position, position + 2);\r\n      const emojiMatched = nextTwoChars.match(emojiMatchedReg);\r\n\r\n      if (emojiMatched) {\r\n        output = source.substr(0, position) + source.substr(position + 2);\r\n      } else {\r\n        output = source.substr(0, position) + source.substr(position + 1);\r\n      }\r\n    } else {\r\n      output = source.slice(0, position) + source.slice(positionEnd);\r\n      if (moveCaret) {\r\n        this.dispatch((instance: any) => {\r\n          instance.setCaretPosition(position);\r\n        });\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Determines whether the maxLength has been reached. This function is called when the maxLength option it set.\r\n   *\r\n   * @param  {object} inputObj\r\n   * @param  {string} updatedInput\r\n   */\r\n  handleMaxLength(inputObj: KeyboardInput, updatedInput: string) {\r\n    const options = this.getOptions();\r\n    const maxLength = options.maxLength;\r\n    const currentInput = inputObj[options.inputName || 'default'];\r\n    const condition = updatedInput.length - 1 >= maxLength;\r\n\r\n    if (\r\n      /**\r\n       * If pressing this button won't add more characters\r\n       * We exit out of this limiter function\r\n       */\r\n      updatedInput.length <= currentInput.length\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    if (Number.isInteger(maxLength)) {\r\n      if (options.debug) {\r\n        console.log('maxLength (num) reached:', condition);\r\n      }\r\n\r\n      if (condition) {\r\n        /**\r\n         * @type {boolean} Boolean value that shows whether maxLength has been reached\r\n         */\r\n        this.maxLengthReached = true;\r\n        return true;\r\n      } else {\r\n        this.maxLengthReached = false;\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (typeof maxLength === 'object') {\r\n      const condition = updatedInput.length - 1 >= maxLength[options.inputName || 'default'];\r\n\r\n      if (options.debug) {\r\n        console.log('maxLength (obj) reached:', condition);\r\n      }\r\n\r\n      if (condition) {\r\n        this.maxLengthReached = true;\r\n        return true;\r\n      } else {\r\n        this.maxLengthReached = false;\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets the current value of maxLengthReached\r\n   */\r\n  isMaxLengthReached() {\r\n    return Boolean(this.maxLengthReached);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a touch device is being used\r\n   */\r\n  isTouchDevice() {\r\n    return 'ontouchstart' in window || navigator.maxTouchPoints;\r\n  }\r\n\r\n  /**\r\n   * Determines whether pointer events are supported\r\n   */\r\n  pointerEventsSupported() {\r\n    return !!window.PointerEvent;\r\n  }\r\n\r\n  /**\r\n   * Bind all methods in a given class\r\n   */\r\n\r\n  static bindMethods(myClass: any, instance: any) {\r\n    // eslint-disable-next-line no-unused-vars\r\n    for (const myMethod of Object.getOwnPropertyNames(myClass.prototype)) {\r\n      const excludeMethod = myMethod === 'constructor' || myMethod === 'bindMethods';\r\n      if (!excludeMethod) {\r\n        if (typeof instance[myMethod] === 'function') {\r\n          instance[myMethod] = instance[myMethod].bind(instance);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Transforms an arbitrary string to camelCase\r\n   *\r\n   * @param  {string} str The string to transform.\r\n   */\r\n  camelCase(str: string): string {\r\n    if (!str) return '';\r\n\r\n    return str\r\n      .toLowerCase()\r\n      .trim()\r\n      .split(/[.\\-_\\s]/g)\r\n      .reduce((str, word) => (word.length ? str + word[0].toUpperCase() + word.slice(1) : str));\r\n  }\r\n\r\n  /**\r\n   * Split array into chunks\r\n   */\r\n  chunkArray<T>(arr: T[], size: number): T[][] {\r\n    return [...Array(Math.ceil(arr.length / size))].map((_, i) => arr.slice(size * i, size + size * i));\r\n  }\r\n\r\n  /**\r\n   * Escape regex input\r\n   */\r\n  escapeRegex(str: string) {\r\n    return str.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\r\n  }\r\n\r\n  /**\r\n   * Calculate caret position offset when using rtl option\r\n   */\r\n  getRtlOffset(index: number, input: string) {\r\n    let newIndex = index;\r\n    const startMarkerIndex = input.indexOf('\\u202B');\r\n    const endMarkerIndex = input.indexOf('\\u202C');\r\n\r\n    if (startMarkerIndex < index && startMarkerIndex != -1) {\r\n      newIndex--;\r\n    }\r\n    if (endMarkerIndex < index && startMarkerIndex != -1) {\r\n      newIndex--;\r\n    }\r\n\r\n    return newIndex < 0 ? 0 : newIndex;\r\n  }\r\n\r\n  /**\r\n   * Reusable empty function\r\n   */\r\n  static noop = () => {};\r\n\r\n  /**\r\n   * Check if a function is a constructor\r\n   */\r\n  isConstructor(f: any) {\r\n    try {\r\n      Reflect.construct(String, [], f);\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\nexport default Utilities;\r\n","import { KeyboardOptions, PhysicalKeyboardParams } from '../interfaces';\r\nimport Utilities from '../services/Utilities';\r\nimport { getDefaultLayout } from '../services/KeyboardLayout';\r\n\r\n/**\r\n * Layout Key Mapping Interface\r\n */\r\ninterface LayoutKeyMapping {\r\n  normal: string | number;\r\n  shift: string | number;\r\n}\r\n\r\n/**\r\n * Physical Keyboard Service\r\n */\r\nclass PhysicalKeyboard {\r\n  getOptions: () => KeyboardOptions;\r\n  dispatch: any;\r\n  layoutJSON: Record<string, LayoutKeyMapping> | null = null;\r\n  lastLayout = '';\r\n  shiftActive = false;\r\n  capslockActive = false;\r\n  activeKeys: Set<HTMLElement> = new Set();\r\n  getNavEngaged: () => boolean;\r\n\r\n  /**\r\n   * Creates an instance of the PhysicalKeyboard service\r\n   */\r\n  constructor({ dispatch, getOptions, getNavEngaged }: PhysicalKeyboardParams) {\r\n    /**\r\n     * @type {object} A simple-keyboard instance\r\n     */\r\n    this.dispatch = dispatch;\r\n    this.getOptions = getOptions;\r\n    this.getNavEngaged = getNavEngaged;\r\n\r\n    if (this.getOptions() && this.getOptions().layout) {\r\n      this.lastLayout = this.getOptions()?.layout?.default?.[1] || '';\r\n      const layout = this.getOptions().layout;\r\n      if (layout) {\r\n        this.layoutJSON = this.mapLayoutToEventCodes(this.extractAndPadLayout(layout));\r\n      }\r\n    } else {\r\n      this.lastLayout = getDefaultLayout().default[1];\r\n      this.layoutJSON = this.mapLayoutToEventCodes(this.extractAndPadLayout(getDefaultLayout()));\r\n    }\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(PhysicalKeyboard, this);\r\n  }\r\n\r\n  handleHighlightKeyDown(e: KeyboardEvent) {\r\n    const options = this.getOptions();\r\n\r\n    if ((e.code === 'ShiftLeft' || e.code === 'ShiftRight') && !this.shiftActive) {\r\n      this.shiftActive = !this.shiftActive;\r\n    }\r\n\r\n    if (e.code === 'CapsLock') {\r\n      this.capslockActive = !this.capslockActive;\r\n    }\r\n\r\n    if (this.getNavEngaged() && options.activeSurface === 'keyboard') {\r\n      // If navEngaged is true and activeSurface is keyboard, do not highlight keys or operate VK\r\n      e.preventDefault();\r\n      e.stopImmediatePropagation();\r\n      return;\r\n    }\r\n\r\n    const buttonPressed = this.getSimpleKeyboardLayoutKey(e);\r\n\r\n    this.dispatch((instance: any) => {\r\n      const standardButtonPressed = instance.getButtonElement(buttonPressed);\r\n      const functionButtonPressed = instance.getButtonElement(`{${buttonPressed}}`);\r\n\r\n      let buttonDOM;\r\n      let buttonName: string;\r\n\r\n      if (standardButtonPressed) {\r\n        buttonDOM = standardButtonPressed;\r\n        buttonName = buttonPressed;\r\n      } else if (functionButtonPressed) {\r\n        buttonDOM = functionButtonPressed;\r\n        buttonName = `{${buttonPressed}}`;\r\n      } else {\r\n        return;\r\n      }\r\n\r\n      const applyButtonStyle = (buttonElement: HTMLElement) => {\r\n        buttonElement.style.background = options.physicalKeyboardHighlightBgColor || '#dadce4';\r\n        buttonElement.style.color = options.physicalKeyboardHighlightTextColor || 'black';\r\n        this.activeKeys.add(buttonElement);\r\n      };\r\n\r\n      if (buttonDOM) {\r\n        if (Array.isArray(buttonDOM)) {\r\n          buttonDOM.forEach((buttonElement) => applyButtonStyle(buttonElement));\r\n\r\n          // Even though we have an array of buttons, we just want to press one of them\r\n          if (options.physicalKeyboardHighlightPress) {\r\n            if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n              buttonDOM[0]?.onpointerdown?.(e);\r\n            } else if (options.physicalKeyboardHighlightPressUseClick) {\r\n              buttonDOM[0]?.click();\r\n            } else {\r\n              instance.handleButtonClicked(buttonName, e);\r\n            }\r\n          }\r\n        } else {\r\n          applyButtonStyle(buttonDOM);\r\n\r\n          if (options.physicalKeyboardHighlightPress) {\r\n            if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n              buttonDOM?.onpointerdown?.(e);\r\n            } else if (options.physicalKeyboardHighlightPressUseClick) {\r\n              buttonDOM.click();\r\n            } else {\r\n              instance.handleButtonClicked(buttonName, e);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  handleHighlightKeyUp(e: KeyboardEvent) {\r\n    const options = this.getOptions();\r\n\r\n    // if (options.physicalKeyboardHighlightPreventDefault && this.isModifierKey(e)) {\r\n    //   e.preventDefault();\r\n    //   e.stopImmediatePropagation();\r\n    // }\r\n\r\n    if (e.code === 'ShiftLeft' || e.code === 'ShiftRight') {\r\n      this.shiftActive = false;\r\n    }\r\n\r\n    const buttonPressed = this.getSimpleKeyboardLayoutKey(e);\r\n\r\n    this.dispatch((instance: any) => {\r\n      const buttonDOM = instance.getButtonElement(buttonPressed) || instance.getButtonElement(`{${buttonPressed}}`);\r\n\r\n      const applyButtonStyle = (buttonElement: HTMLElement) => {\r\n        if (buttonElement.removeAttribute) {\r\n          buttonElement.removeAttribute('style');\r\n        }\r\n        this.activeKeys.delete(buttonElement);\r\n      };\r\n\r\n      if (buttonDOM) {\r\n        if (Array.isArray(buttonDOM)) {\r\n          buttonDOM.forEach((buttonElement) => applyButtonStyle(buttonElement));\r\n\r\n          // Even though we have an array of buttons, we just want to press one of them\r\n          if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n            buttonDOM[0]?.onpointerup?.(e);\r\n          }\r\n        } else {\r\n          applyButtonStyle(buttonDOM);\r\n\r\n          if (options.physicalKeyboardHighlightPressUsePointerEvents) {\r\n            buttonDOM?.onpointerup?.(e);\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    requestAnimationFrame(() => {\r\n      if (this.activeKeys.size === 0) return;\r\n\r\n      this.activeKeys.forEach((buttonElement) => {\r\n        if (buttonElement.removeAttribute) {\r\n          buttonElement.removeAttribute('style');\r\n        }\r\n      });\r\n      this.activeKeys.clear();\r\n    });\r\n  }\r\n\r\n  STANDARD_CODES = new Set([\r\n    // Alphanumeric\r\n    'Backquote',\r\n    'Digit0',\r\n    'Digit1',\r\n    'Digit2',\r\n    'Digit3',\r\n    'Digit4',\r\n    'Digit5',\r\n    'Digit6',\r\n    'Digit7',\r\n    'Digit8',\r\n    'Digit9',\r\n    'KeyA',\r\n    'KeyB',\r\n    'KeyC',\r\n    'KeyD',\r\n    'KeyE',\r\n    'KeyF',\r\n    'KeyG',\r\n    'KeyH',\r\n    'KeyI',\r\n    'KeyJ',\r\n    'KeyK',\r\n    'KeyL',\r\n    'KeyM',\r\n    'KeyN',\r\n    'KeyO',\r\n    'KeyP',\r\n    'KeyQ',\r\n    'KeyR',\r\n    'KeyS',\r\n    'KeyT',\r\n    'KeyU',\r\n    'KeyV',\r\n    'KeyW',\r\n    'KeyX',\r\n    'KeyY',\r\n    'KeyZ',\r\n\r\n    // Control & nav\r\n    'Enter',\r\n    'Escape',\r\n    'Backspace',\r\n    'Tab',\r\n    'Space',\r\n    'ArrowLeft',\r\n    'ArrowRight',\r\n    'ArrowUp',\r\n    'ArrowDown',\r\n    'Delete',\r\n    'Insert',\r\n    'Home',\r\n    'End',\r\n    'PageUp',\r\n    'PageDown',\r\n\r\n    // Modifier keys\r\n    'ShiftLeft',\r\n    'ShiftRight',\r\n    'ControlLeft',\r\n    'ControlRight',\r\n    'AltLeft',\r\n    'AltRight',\r\n    'MetaLeft',\r\n    'MetaRight',\r\n    'CapsLock',\r\n\r\n    // Symbols & punctuation\r\n    'Minus',\r\n    'Equal',\r\n    'BracketLeft',\r\n    'BracketRight',\r\n    'Backslash',\r\n    'Semicolon',\r\n    'Quote',\r\n    'Comma',\r\n    'Period',\r\n    'Slash',\r\n\r\n    // Function keys\r\n    'F1',\r\n    'F2',\r\n    'F3',\r\n    'F4',\r\n    'F5',\r\n    'F6',\r\n    'F7',\r\n    'F8',\r\n    'F9',\r\n    'F10',\r\n    'F11',\r\n    'F12',\r\n\r\n    // Numpad\r\n    'NumLock',\r\n    'Numpad0',\r\n    'Numpad1',\r\n    'Numpad2',\r\n    'Numpad3',\r\n    'Numpad4',\r\n    'Numpad5',\r\n    'Numpad6',\r\n    'Numpad7',\r\n    'Numpad8',\r\n    'Numpad9',\r\n    'NumpadAdd',\r\n    'NumpadSubtract',\r\n    'NumpadMultiply',\r\n    'NumpadDivide',\r\n    'NumpadDecimal',\r\n    'NumpadEnter',\r\n\r\n    // Misc\r\n    'ScrollLock',\r\n    'Pause',\r\n    'PrintScreen',\r\n    'ContextMenu',\r\n  ]);\r\n\r\n  /**\r\n   * Normalize a code string to match the official `e.code` spec format.\r\n   * Returns null if no match is found.\r\n   */\r\n  normalizeToStandardCode(input: string): string | null {\r\n    if (!input || typeof input !== 'string') return null;\r\n\r\n    if (this.STANDARD_CODES.has(input)) return input;\r\n\r\n    const upper = input.trim();\r\n    for (const code of this.STANDARD_CODES) {\r\n      if (code.toLowerCase() === upper.toLowerCase()) {\r\n        return code;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  normalizeOutput(rawKey: string): string {\r\n    const normalizeKeyMap: Record<string, string> = {\r\n      shiftleft: 'shift',\r\n      shiftright: 'shift',\r\n      controlleft: 'ctrl',\r\n      controlright: 'ctrl',\r\n      altleft: 'alt',\r\n      altright: 'alt',\r\n      metaleft: 'meta',\r\n      metaright: 'meta',\r\n      backspace: 'bksp',\r\n      capslock: 'lock',\r\n      enter: 'enter',\r\n      tab: 'tab',\r\n    };\r\n\r\n    const key = rawKey.toLowerCase();\r\n    return normalizeKeyMap[key] || (key.length > 1 ? key : rawKey);\r\n  }\r\n\r\n  /**\r\n   * Transforms a KeyboardEvent's \"key.code\" string into a simple-keyboard layout format\r\n   * @param  {object} e The KeyboardEvent\r\n   * @returns {string} The simple-keyboard layout key\r\n   */\r\n  getSimpleKeyboardLayoutKey(e: KeyboardEvent): string {\r\n    let output = '';\r\n\r\n    const options = this.getOptions();\r\n    const currentLayout = options?.layout?.default?.[1] ?? getDefaultLayout().default[1];\r\n    if (this.lastLayout !== currentLayout) {\r\n      this.lastLayout = currentLayout || '';\r\n      const layout = options?.layout ?? getDefaultLayout();\r\n      this.layoutJSON = this.mapLayoutToEventCodes(this.extractAndPadLayout(layout));\r\n    }\r\n\r\n    const eCode = this.normalizeToStandardCode(e.code);\r\n\r\n    // if we have a valid code and it's in the layout, return early\r\n    if (this.layoutJSON && eCode && this.layoutJSON[eCode]) {\r\n      const layoutEntry = this.layoutJSON[eCode];\r\n      output = this.shiftActive || this.capslockActive ? layoutEntry.shift.toString() : layoutEntry.normal.toString();\r\n\r\n      const normalized = this.normalizeOutput(output);\r\n      return normalized;\r\n    }\r\n\r\n    // fallback path for known safe keys\r\n    const fallbackKeys = new Set(['backspace', 'enter', 'tab', 'escape']);\r\n    const key = (e.key || '').toLowerCase();\r\n    if (fallbackKeys.has(key)) {\r\n      output = key;\r\n      const normalized = this.normalizeOutput(output);\r\n      return normalized;\r\n    }\r\n\r\n    // unmapped key  log it and return blank\r\n    // console.warn('[simple-keyboard][Edge Case Triggered] Unmapped key event:', {\r\n    //   code: e.code,\r\n    //   key: e.key,\r\n    //   keyCode: e.keyCode,\r\n    //   layoutJSON: this.layoutJSON,\r\n    //   userAgent: navigator.userAgent, // Browser + OS info\r\n    //   platform: navigator.platform, // OS-level platform\r\n    //   language: navigator.language, // Active input language (e.g., \"ko-KR\")\r\n    //   imeMode:\r\n    //     document.activeElement && 'inputMode' in document.activeElement\r\n    //       ? (document.activeElement as HTMLInputElement | HTMLTextAreaElement).inputMode\r\n    //       : 'unknown', // Input method\r\n    //   isEditable: (document.activeElement as HTMLElement)?.isContentEditable || false, // Useful for composition\r\n    //   time: new Date().toISOString(),\r\n    // });\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Retrieve key from keyCode\r\n   */\r\n  keyCodeToKey(keyCode: number): string {\r\n    return (\r\n      {\r\n        8: 'Backspace',\r\n        9: 'Tab',\r\n        13: 'Enter',\r\n        16: 'Shift',\r\n        17: 'Ctrl',\r\n        18: 'Alt',\r\n        19: 'Pause',\r\n        20: 'CapsLock',\r\n        27: 'Esc',\r\n        32: 'Space',\r\n        33: 'PageUp',\r\n        34: 'PageDown',\r\n        35: 'End',\r\n        36: 'Home',\r\n        37: 'ArrowLeft',\r\n        38: 'ArrowUp',\r\n        39: 'ArrowRight',\r\n        40: 'ArrowDown',\r\n        45: 'Insert',\r\n        46: 'Delete',\r\n        48: '0',\r\n        49: '1',\r\n        50: '2',\r\n        51: '3',\r\n        52: '4',\r\n        53: '5',\r\n        54: '6',\r\n        55: '7',\r\n        56: '8',\r\n        57: '9',\r\n        65: 'A',\r\n        66: 'B',\r\n        67: 'C',\r\n        68: 'D',\r\n        69: 'E',\r\n        70: 'F',\r\n        71: 'G',\r\n        72: 'H',\r\n        73: 'I',\r\n        74: 'J',\r\n        75: 'K',\r\n        76: 'L',\r\n        77: 'M',\r\n        78: 'N',\r\n        79: 'O',\r\n        80: 'P',\r\n        81: 'Q',\r\n        82: 'R',\r\n        83: 'S',\r\n        84: 'T',\r\n        85: 'U',\r\n        86: 'V',\r\n        87: 'W',\r\n        88: 'X',\r\n        89: 'Y',\r\n        90: 'Z',\r\n        91: 'Meta',\r\n        96: 'Numpad0',\r\n        97: 'Numpad1',\r\n        98: 'Numpad2',\r\n        99: 'Numpad3',\r\n        100: 'Numpad4',\r\n        101: 'Numpad5',\r\n        102: 'Numpad6',\r\n        103: 'Numpad7',\r\n        104: 'Numpad8',\r\n        105: 'Numpad9',\r\n        106: 'NumpadMultiply',\r\n        107: 'NumpadAdd',\r\n        109: 'NumpadSubtract',\r\n        110: 'NumpadDecimal',\r\n        111: 'NumpadDivide',\r\n        112: 'F1',\r\n        113: 'F2',\r\n        114: 'F3',\r\n        115: 'F4',\r\n        116: 'F5',\r\n        117: 'F6',\r\n        118: 'F7',\r\n        119: 'F8',\r\n        120: 'F9',\r\n        121: 'F10',\r\n        122: 'F11',\r\n        123: 'F12',\r\n        144: 'NumLock',\r\n        145: 'ScrollLock',\r\n        186: ';',\r\n        187: '=',\r\n        188: ',',\r\n        189: '-',\r\n        190: '.',\r\n        191: '/',\r\n        192: '`',\r\n        219: '[',\r\n        220: '\\\\',\r\n        221: ']',\r\n        222: \"'\",\r\n      }[keyCode] || ''\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Extracts and pads a layout object\r\n   * @param  {object} layout The layout object\r\n   * @returns {object} The layout object with padding\r\n   */\r\n  extractAndPadLayout(layout: Record<string, string[]>): Record<string, (string | number)[][]> {\r\n    const qwertyRowLengths = [14, 14, 13, 12, 3]; // Number of keys per QWERTY row\r\n\r\n    const processedLayout: Record<string, (string | number)[][]> = { default: [], shift: [] };\r\n\r\n    for (const type of ['default', 'shift']) {\r\n      if (!layout[type]) continue; // Skip if layout type is missing\r\n\r\n      const rows = layout[type].map((row) => row.split(' '));\r\n\r\n      for (let i = 0; i < qwertyRowLengths.length; i++) {\r\n        processedLayout[type][i] = rows[i] ? [...rows[i]] : [];\r\n        while (processedLayout[type][i].length < qwertyRowLengths[i]) {\r\n          processedLayout[type][i].push(-1); // Fill missing spots\r\n        }\r\n      }\r\n    }\r\n\r\n    return processedLayout;\r\n  }\r\n\r\n  /**\r\n   * Maps a layout object to event codes\r\n   * @param  {object} layout The layout object\r\n   * @returns {object} The layout object with event codes\r\n   */\r\n\r\n  mapLayoutToEventCodes(layout: Record<string, (string | number)[][]>): Record<string, LayoutKeyMapping> {\r\n    const mappedLayout: Record<string, LayoutKeyMapping> = {};\r\n\r\n    const qwertyRows = [\r\n      [\r\n        'Backquote',\r\n        'Digit1',\r\n        'Digit2',\r\n        'Digit3',\r\n        'Digit4',\r\n        'Digit5',\r\n        'Digit6',\r\n        'Digit7',\r\n        'Digit8',\r\n        'Digit9',\r\n        'Digit0',\r\n        'Minus',\r\n        'Equal',\r\n        'Backspace',\r\n      ],\r\n      [\r\n        'Tab',\r\n        'KeyQ',\r\n        'KeyW',\r\n        'KeyE',\r\n        'KeyR',\r\n        'KeyT',\r\n        'KeyY',\r\n        'KeyU',\r\n        'KeyI',\r\n        'KeyO',\r\n        'KeyP',\r\n        'BracketLeft',\r\n        'BracketRight',\r\n        'Backslash',\r\n      ],\r\n      [\r\n        'CapsLock',\r\n        'KeyA',\r\n        'KeyS',\r\n        'KeyD',\r\n        'KeyF',\r\n        'KeyG',\r\n        'KeyH',\r\n        'KeyJ',\r\n        'KeyK',\r\n        'KeyL',\r\n        'Semicolon',\r\n        'Quote',\r\n        'Enter',\r\n      ],\r\n      ['ShiftLeft', 'KeyZ', 'KeyX', 'KeyC', 'KeyV', 'KeyB', 'KeyN', 'KeyM', 'Comma', 'Period', 'Slash', 'ShiftRight'],\r\n      ['ControlLeft', 'AltLeft', 'Space'],\r\n    ];\r\n\r\n    for (let rowIndex = 0; rowIndex < qwertyRows.length; rowIndex++) {\r\n      for (let colIndex = 0; colIndex < qwertyRows[rowIndex].length; colIndex++) {\r\n        const eventCode = qwertyRows[rowIndex][colIndex];\r\n        const normalKey = layout.default[rowIndex][colIndex] ?? '';\r\n        const shiftKey = layout.shift[rowIndex][colIndex] ?? '';\r\n\r\n        mappedLayout[eventCode] = {\r\n          normal: normalKey !== -1 ? normalKey : '',\r\n          shift: shiftKey !== -1 ? shiftKey : '',\r\n        };\r\n      }\r\n    }\r\n\r\n    return mappedLayout;\r\n  }\r\n\r\n  isModifierKey = (e: KeyboardEvent): boolean => {\r\n    return (\r\n      e.altKey ||\r\n      e.ctrlKey ||\r\n      e.shiftKey ||\r\n      ['Tab', 'CapsLock', 'Esc', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(\r\n        e.code || e.key || this.keyCodeToKey(e?.keyCode)\r\n      )\r\n    );\r\n  };\r\n}\r\n\r\nexport default PhysicalKeyboard;\r\n","import { KeyboardLayoutObject } from \"../interfaces\";\r\n\r\nexport const getDefaultLayout = (): KeyboardLayoutObject => {\r\n  return {\r\n    default: [\r\n      \"` 1 2 3 4 5 6 7 8 9 0 - = {bksp}\",\r\n      \"{tab} q w e r t y u i o p [ ] \\\\\",\r\n      \"{lock} a s d f g h j k l ; ' {enter}\",\r\n      \"{shift} z x c v b n m , . / {shift}\",\r\n      \".com @ {space}\",\r\n    ],\r\n    shift: [\r\n      \"~ ! @ # $ % ^ & * ( ) _ + {bksp}\",\r\n      \"{tab} Q W E R T Y U I O P { } |\",\r\n      '{lock} A S D F G H J K L : \" {enter}',\r\n      \"{shift} Z X C V B N M < > ? {shift}\",\r\n      \".com @ {space}\",\r\n    ],\r\n  };\r\n};\r\n","import './css/CandidateBox.css';\r\nimport Utilities from '../services/Utilities';\r\nimport { CandidateBoxParams, CandidateBoxRenderParams, CandidateBoxShowParams, KeyboardOptions } from './../interfaces';\r\n\r\nclass CandidateBox {\r\n  utilities: Utilities;\r\n  options: KeyboardOptions;\r\n  candidateBoxElement: HTMLDivElement | null = null;\r\n  pageIndex = 0;\r\n  pageSize: number;\r\n  private activeIndex = 0;\r\n  private candidateOptions: HTMLLIElement[] = [];\r\n  private globalLiveRegionElement: HTMLElement | null = document.querySelector('.hg-live-region');\r\n  static isOpen = false;\r\n  private handleActiveIndexBound: (e: KeyboardEvent) => void;\r\n  private firstLastNavBound: (e: KeyboardEvent) => void;\r\n  private listenersAttached = false;\r\n\r\n  constructor({ utilities, options }: CandidateBoxParams) {\r\n    this.utilities = utilities;\r\n    this.options = options;\r\n    Utilities.bindMethods(CandidateBox, this);\r\n    this.pageSize = this.utilities.getOptions().layoutCandidatesPageSize || 5;\r\n    this.handleActiveIndexBound = this.handleActiveIndex.bind(this);\r\n    this.firstLastNavBound = this.firstLastNav.bind(this);\r\n  }\r\n\r\n  private attachDocListeners() {\r\n    if (this.listenersAttached) return;\r\n    // IMPORTANT: add the bound functions directly, no wrapper\r\n    document.addEventListener('keydown', this.handleActiveIndexBound, { capture: false });\r\n    document.addEventListener('keydown', this.firstLastNavBound, { capture: false });\r\n    this.listenersAttached = true;\r\n  }\r\n\r\n  private detachDocListeners() {\r\n    if (!this.listenersAttached) return;\r\n    document.removeEventListener('keydown', this.handleActiveIndexBound, { capture: false });\r\n    document.removeEventListener('keydown', this.firstLastNavBound, { capture: false });\r\n    this.listenersAttached = false;\r\n  }\r\n\r\n  destroy(): void {\r\n    this.detachDocListeners();\r\n\r\n    if (this.candidateBoxElement) {\r\n      setTimeout(() => {\r\n        if (this.candidateBoxElement) {\r\n          this.candidateBoxElement.remove();\r\n          this.candidateBoxElement = null;\r\n        }\r\n        CandidateBox.isOpen = false;\r\n      }, 30);\r\n    }\r\n\r\n    this.activeIndex = 0;\r\n    this.candidateOptions = [];\r\n\r\n    // Ensure no keyboard nav leaks persist\r\n    const oldListbox = document.querySelector('.hg-candidate-box-list');\r\n    if (oldListbox) {\r\n      oldListbox.replaceWith(oldListbox.cloneNode(true)); // remove all listeners\r\n    }\r\n\r\n    this.pageIndex = 0;\r\n  }\r\n\r\n  show({ candidateValue, targetElement, onSelect }: CandidateBoxShowParams): void {\r\n    if (!candidateValue || !candidateValue.length) return;\r\n\r\n    const candidateListPages = this.utilities.chunkArray(candidateValue.split(' '), this.pageSize);\r\n\r\n    this.renderPage({\r\n      candidateListPages,\r\n      targetElement,\r\n      pageIndex: this.pageIndex,\r\n      nbPages: candidateListPages.length,\r\n      onItemSelected: (selectedCandidate: string, e: MouseEvent) => {\r\n        onSelect(selectedCandidate, e);\r\n        this.destroy();\r\n      },\r\n    });\r\n\r\n    CandidateBox.isOpen = true;\r\n  }\r\n\r\n  private firstLastNav(e: KeyboardEvent) {\r\n    if (e.key !== 'Tab' || !CandidateBox.isOpen) return;\r\n\r\n    const focusable = this.candidateBoxElement?.querySelectorAll<HTMLElement>('.hg-candidate-box-list-item');\r\n\r\n    if (!focusable?.length) return;\r\n\r\n    const first = focusable[0];\r\n    const last = focusable[focusable.length - 1];\r\n\r\n    if (e.shiftKey && document.querySelector<HTMLElement>('.hg-candidate-box-list-item.active') === first) {\r\n      e.preventDefault();\r\n      last.setAttribute('aria-selected', 'true');\r\n    } else if (!e.shiftKey && document.querySelector<HTMLElement>('.hg-candidate-box-list-item.active') === last) {\r\n      e.preventDefault();\r\n      first.setAttribute('aria-selected', 'true');\r\n    }\r\n  }\r\n\r\n  renderPage({ candidateListPages, targetElement, pageIndex, nbPages, onItemSelected }: CandidateBoxRenderParams) {\r\n    this.attachDocListeners();\r\n    this.candidateBoxElement?.remove();\r\n\r\n    this.candidateBoxElement = document.createElement('div');\r\n    this.candidateBoxElement.className = 'hg-candidate-box';\r\n    this.candidateBoxElement.setAttribute('role', 'dialog');\r\n    this.candidateBoxElement.setAttribute('aria-label', 'Character Suggestions');\r\n    this.candidateBoxElement.setAttribute('aria-describedby', 'candidate-box-instructions');\r\n\r\n    const instructionsElement = document.createElement('div');\r\n    instructionsElement.id = 'candidate-box-instructions';\r\n    instructionsElement.classList.add('hg-candidate-box-instructions', 'sr-only');\r\n    instructionsElement.innerHTML = 'Use up and down arrow keys to navigate, Enter to select.';\r\n    this.candidateBoxElement.appendChild(instructionsElement);\r\n\r\n    const candidateListULElement = document.createElement('ul');\r\n    candidateListULElement.className = 'hg-candidate-box-list';\r\n    candidateListULElement.setAttribute('role', 'listbox');\r\n    candidateListULElement.setAttribute('tabindex', '-1');\r\n\r\n    candidateListPages[pageIndex].forEach((candidateListItem, i) => {\r\n      const candidateListLIElement = document.createElement('li');\r\n      candidateListLIElement.setAttribute('role', 'option');\r\n      candidateListLIElement.setAttribute('aria-selected', i === 0 ? 'true' : 'false');\r\n      candidateListLIElement.id = `key-candidate-${i}`;\r\n      candidateListLIElement.className = 'hg-candidate-box-list-item';\r\n      candidateListLIElement.innerHTML = this.options.display?.[candidateListItem] || candidateListItem;\r\n\r\n      const getMouseEvent = () => {\r\n        const mouseEvent = new (this.options.useTouchEvents ? TouchEvent : MouseEvent)('click');\r\n        Object.defineProperty(mouseEvent, 'target', { value: candidateListLIElement });\r\n        return mouseEvent;\r\n      };\r\n\r\n      candidateListLIElement.onclick = (e = getMouseEvent() as MouseEvent) => {\r\n        if (this.globalLiveRegionElement) {\r\n          const label = candidateListLIElement.textContent?.trim();\r\n          this.globalLiveRegionElement.textContent = `Inserted: ${label}`;\r\n        }\r\n        onItemSelected(candidateListItem, e);\r\n      };\r\n\r\n      if (this.options.useTouchEvents) {\r\n        candidateListLIElement.ontouchstart = (e: any) => {\r\n          if (this.globalLiveRegionElement) {\r\n            const label = candidateListLIElement.textContent?.trim();\r\n            this.globalLiveRegionElement.textContent = `Inserted: ${label}`;\r\n          }\r\n          onItemSelected(candidateListItem, e || getMouseEvent());\r\n        };\r\n      }\r\n\r\n      candidateListULElement.appendChild(candidateListLIElement);\r\n    });\r\n\r\n    const isPrevBtnElementActive = pageIndex > 0;\r\n    const prevBtnElement = document.createElement('div');\r\n    prevBtnElement.classList.add('hg-candidate-box-prev');\r\n    if (isPrevBtnElementActive) prevBtnElement.classList.add('hg-candidate-box-btn-active');\r\n\r\n    prevBtnElement.onclick = () => {\r\n      if (!isPrevBtnElementActive) return;\r\n      this.renderPage({ candidateListPages, targetElement, pageIndex: pageIndex - 1, nbPages, onItemSelected });\r\n    };\r\n\r\n    const isNextBtnElementActive = pageIndex < nbPages - 1;\r\n    const nextBtnElement = document.createElement('div');\r\n    nextBtnElement.classList.add('hg-candidate-box-next');\r\n    if (isNextBtnElementActive) nextBtnElement.classList.add('hg-candidate-box-btn-active');\r\n\r\n    nextBtnElement.onclick = () => {\r\n      if (!isNextBtnElementActive) return;\r\n      this.renderPage({ candidateListPages, targetElement, pageIndex: pageIndex + 1, nbPages, onItemSelected });\r\n    };\r\n\r\n    this.candidateBoxElement.appendChild(prevBtnElement);\r\n    this.candidateBoxElement.appendChild(candidateListULElement);\r\n    this.candidateBoxElement.appendChild(nextBtnElement);\r\n\r\n    this.candidateBoxElement.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        this.destroy();\r\n      }\r\n    });\r\n\r\n    targetElement.prepend(this.candidateBoxElement);\r\n\r\n    this.setupKeyboardNav(candidateListULElement);\r\n  }\r\n\r\n  private handleActiveIndex(e: KeyboardEvent): void {\r\n    if (!CandidateBox.isOpen) return;\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      this.updateActiveIndex((this.activeIndex + 1) % this.candidateOptions.length);\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      this.updateActiveIndex((this.activeIndex - 1 + this.candidateOptions.length) % this.candidateOptions.length);\r\n    } else if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      this.activateSelectedOption();\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      this.destroy();\r\n    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  private setupKeyboardNav(listbox: HTMLUListElement) {\r\n    this.candidateOptions = Array.from(listbox.querySelectorAll('[role=\"option\"]'));\r\n    this.candidateOptions.forEach((option, i) => {\r\n      if (!option.id) option.id = `candidate-${i}`;\r\n    });\r\n\r\n    this.setActiveOption(0);\r\n  }\r\n\r\n  private setActiveOption(index: number): void {\r\n    this.activeIndex = index;\r\n    this.updateActiveIndex(index);\r\n  }\r\n\r\n  private updateActiveIndex(newIndex: number): void {\r\n    const prev = this.candidateOptions[this.activeIndex];\r\n    const next = this.candidateOptions[newIndex];\r\n\r\n    if (prev) {\r\n      prev.setAttribute('aria-selected', 'false');\r\n      prev.classList.remove('active');\r\n    }\r\n\r\n    this.activeIndex = newIndex;\r\n\r\n    if (next) {\r\n      next.setAttribute('aria-selected', 'true');\r\n      next.classList.add('active');\r\n      next.scrollIntoView({ block: 'nearest' });\r\n\r\n      if (this.globalLiveRegionElement) {\r\n        const total = this.candidateOptions.length;\r\n        const label = next.textContent?.trim();\r\n        this.globalLiveRegionElement.textContent = `${newIndex + 1} of ${total}: ${label}`;\r\n      }\r\n\r\n      if (!this.candidateBoxElement) return;\r\n\r\n      const listbox = this.candidateBoxElement.querySelector('.hg-candidate-box-list');\r\n      if (listbox) {\r\n        listbox.setAttribute('aria-activedescendant', next.id);\r\n      }\r\n    }\r\n  }\r\n\r\n  private activateSelectedOption(): void {\r\n    const activeOption = this.candidateOptions[this.activeIndex];\r\n    if (!activeOption) return;\r\n\r\n    // Update live region before triggering the click\r\n    if (this.globalLiveRegionElement) {\r\n      const label = activeOption.textContent?.trim();\r\n      this.globalLiveRegionElement.textContent = `Inserted: ${label}`;\r\n    }\r\n\r\n    // Then trigger selection\r\n    activeOption.click();\r\n    activeOption.setAttribute('aria-selected', 'false');\r\n  }\r\n}\r\n\r\nexport default CandidateBox;\r\n","import './css/Keyboard.css';\r\n\r\nimport { getDefaultLayout } from '../services/KeyboardLayout';\r\nimport PhysicalKeyboard from '../services/PhysicalKeyboard';\r\nimport Utilities from '../services/Utilities';\r\nimport {\r\n  KeyboardOptions,\r\n  KeyboardInput,\r\n  KeyboardButtonElements,\r\n  KeyboardHandlerEvent,\r\n  KeyboardElement,\r\n  SKWindow,\r\n} from '../interfaces';\r\nimport CandidateBox from './CandidateBox';\r\n\r\n/**\r\n * Root class for simple-keyboard.\r\n * This class:\r\n * - Parses the options\r\n * - Renders the rows and buttons\r\n * - Handles button functionality\r\n */\r\nclass SimpleKeyboard {\r\n  input!: KeyboardInput;\r\n  options!: KeyboardOptions;\r\n  utilities!: Utilities;\r\n  caretPosition!: number | null;\r\n  caretPositionEnd!: number | null;\r\n  keyboardDOM!: KeyboardElement;\r\n  keyboardPluginClasses!: string;\r\n  keyboardDOMClass!: string;\r\n  buttonElements!: KeyboardButtonElements;\r\n  currentInstanceName!: string;\r\n  allKeyboardInstances!: { [key: string]: SimpleKeyboard };\r\n  keyboardInstanceNames!: string[];\r\n  isFirstKeyboardInstance!: boolean;\r\n  physicalKeyboard!: PhysicalKeyboard;\r\n  modules!: { [key: string]: any };\r\n  activeButtonClass!: string;\r\n  holdInteractionTimeout!: number;\r\n  holdTimeout!: number;\r\n  isMouseHold!: boolean;\r\n  initialized!: boolean;\r\n  candidateBox!: CandidateBox | null;\r\n  keyboardRowsDOM!: KeyboardElement;\r\n  defaultName = 'default';\r\n  activeInputElement: HTMLInputElement | HTMLTextAreaElement | null = null;\r\n  keyboardInstructions: HTMLElement | null = null;\r\n  keyboardHeader: HTMLElement | null = null;\r\n  instructions: string | null = null;\r\n  listenersAdded = false;\r\n  ariaLiveTimer: ReturnType<typeof setTimeout> | null = null;\r\n  useLiveRegion = true;\r\n  liveRegionMode: 'assertive' | 'polite' = 'polite';\r\n  liveRegionDelay = 0;\r\n  ariaLabel = '';\r\n  handleUnifiedKeyDownBound!: (event: KeyboardEvent) => void;\r\n  handleKeyUpBound!: (event: KeyboardEvent) => void;\r\n  handleMouseDownBound!: (event: MouseEvent) => void;\r\n  handleMouseUpBound!: (event: MouseEvent) => void;\r\n  handleTouchEndBound!: (event: TouchEvent) => void;\r\n  handleSelectBound!: (event: Event) => void;\r\n  handleSelectionChangeBound!: (event: Event) => void;\r\n  NAV_KEYS = new Set(['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Home', 'End', 'PageUp', 'PageDown']);\r\n  MODIFIER_KEYS = new Set(['Shift', 'Control', 'Alt', 'Meta', 'CapsLock', 'NumLock', 'ScrollLock', 'Fn', 'FnLock']);\r\n  NAMED_KEYS_TO_ANNOUNCE = new Set(['Enter', 'Backspace', 'Delete', 'Escape', ' ', 'Spacebar']);\r\n  NAMED_READABLE: Record<string, string> = {\r\n    ' ': 'Space',\r\n    Spacebar: 'Space',\r\n  };\r\n  private _announcerEl: HTMLDivElement | null = null;\r\n  private _navEngaged = false;\r\n  private _rovingLocked: boolean | null = null;\r\n  private _lastUsedKey: string | null = null;\r\n\r\n  /**\r\n   * Creates an instance of SimpleKeyboard\r\n   * @param {Array} selectorOrOptions If first parameter is a string, it is considered the container class. The second parameter is then considered the options object. If first parameter is an object, it is considered the options object.\r\n   */\r\n  constructor(selectorOrOptions?: string | HTMLDivElement | KeyboardOptions, keyboardOptions?: KeyboardOptions) {\r\n    if (typeof window === 'undefined') return;\r\n\r\n    const { keyboardDOMClass, keyboardDOM, options = {} } = this.handleParams(selectorOrOptions, keyboardOptions);\r\n\r\n    /**\r\n     * Implementing Announcer\r\n     */\r\n    if (!keyboardDOM) throw new Error('Keyboard root not found');\r\n\r\n    // Reuse or create announcer; safe before/after attachment\r\n    this._announcerEl = this.ensureAnnouncer(keyboardDOM);\r\n\r\n    /**\r\n     * Initializing Utilities\r\n     */\r\n    this.utilities = new Utilities({\r\n      getOptions: this.getOptions,\r\n      getCaretPosition: this.getCaretPosition,\r\n      getCaretPositionEnd: this.getCaretPositionEnd,\r\n      dispatch: this.dispatch,\r\n    });\r\n\r\n    /**\r\n     * Caret position\r\n     */\r\n    this.caretPosition = null;\r\n\r\n    /**\r\n     * Caret position end\r\n     */\r\n    this.caretPositionEnd = null;\r\n\r\n    /**\r\n     * Processing options\r\n     */\r\n    this.keyboardDOM = keyboardDOM;\r\n\r\n    /**\r\n     * @type {object}\r\n     * @property {object} layout Modify the keyboard layout.\r\n     * @property {string} layoutName Specifies which layout should be used.\r\n     * @property {object} display Replaces variable buttons (such as {bksp}) with a human-friendly name (e.g.: backspace).\r\n     * @property {boolean} mergeDisplay By default, when you set the display property, you replace the default one. This setting merges them instead.\r\n     * @property {string} theme A prop to add your own css classes to the keyboard wrapper. You can add multiple classes separated by a space.\r\n     * @property {array} buttonTheme A prop to add your own css classes to one or several buttons.\r\n     * @property {array} buttonAttributes A prop to add your own attributes to one or several buttons.\r\n     * @property {boolean} debug Runs a console.log every time a key is pressed. Displays the buttons pressed and the current input.\r\n     * @property {boolean} newLineOnEnter Specifies whether clicking the ENTER button will input a newline (\\n) or not.\r\n     * @property {boolean} tabCharOnTab Specifies whether clicking the TAB button will input a tab character (\\t) or not.\r\n     * @property {string} inputName Allows you to use a single simple-keyboard instance for several inputs.\r\n     * @property {number} maxLength Restrains all of simple-keyboard inputs to a certain length. This should be used in addition to the input elements maxlengthattribute.\r\n     * @property {object} maxLength Restrains simple-keyboards individual inputs to a certain length. This should be used in addition to the input elements maxlengthattribute.\r\n     * @property {boolean} syncInstanceInputs When set to true, this option synchronizes the internal input of every simple-keyboard instance.\r\n     * @property {boolean} physicalKeyboardHighlight Enable highlighting of keys pressed on physical keyboard.\r\n     * @property {boolean} physicalKeyboardHighlightPress Presses keys highlighted by physicalKeyboardHighlight\r\n     * @property {string} physicalKeyboardHighlightTextColor Define the text color that the physical keyboard highlighted key should have.\r\n     * @property {string} physicalKeyboardHighlightBgColor Define the background color that the physical keyboard highlighted key should have.\r\n     * @property {boolean} physicalKeyboardHighlightPressUseClick Whether physicalKeyboardHighlightPress should use clicks to trigger buttons.\r\n     * @property {boolean} physicalKeyboardHighlightPressUsePointerEvents Whether physicalKeyboardHighlightPress should use pointer events to trigger buttons.\r\n     * @property {boolean} physicalKeyboardHighlightPreventDefault Whether physicalKeyboardHighlight should use preventDefault to disable default browser actions.\r\n     * @property {boolean} preventMouseDownDefault Calling preventDefault for the mousedown events keeps the focus on the input.\r\n     * @property {boolean} preventMouseUpDefault Calling preventDefault for the mouseup events.\r\n     * @property {boolean} stopMouseDownPropagation Stops pointer down events on simple-keyboard buttons from bubbling to parent elements.\r\n     * @property {boolean} stopMouseUpPropagation Stops pointer up events on simple-keyboard buttons from bubbling to parent elements.\r\n     * @property {function(button: string):string} onKeyPress Executes the callback function on key press. Returns button layout name (i.e.: {shift}).\r\n     * @property {function(input: string):string} onChange Executes the callback function on input change. Returns the current inputs string.\r\n     * @property {function} onRender Executes the callback function every time simple-keyboard is rendered (e.g: when you change layouts).\r\n     * @property {function} onInit Executes the callback function once simple-keyboard is rendered for the first time (on initialization).\r\n     * @property {function(keyboard: Keyboard):void} beforeInputUpdate Perform an action before any input change\r\n     * @property {function(inputs: object):object} onChangeAll Executes the callback function on input change. Returns the input object with all defined inputs.\r\n     * @property {boolean} useButtonTag Render buttons as a button element instead of a div element.\r\n     * @property {boolean} disableCaretPositioning A prop to ensure characters are always be added/removed at the end of the string.\r\n     * @property {object} inputPattern Restrains input(s) change to the defined regular expression pattern.\r\n     * @property {boolean} useTouchEvents Instructs simple-keyboard to use touch events instead of click events.\r\n     * @property {boolean} autoUseTouchEvents Enable useTouchEvents automatically when touch device is detected.\r\n     * @property {boolean} useMouseEvents Opt out of PointerEvents handling, falling back to the prior mouse event logic.\r\n     * @property {function} destroy Clears keyboard listeners and DOM elements.\r\n     * @property {boolean} disableButtonHold Disable button hold action.\r\n     * @property {boolean} rtl Adds unicode right-to-left control characters to input return values.\r\n     * @property {function} onKeyReleased Executes the callback function on key release.\r\n     * @property {array} modules Module classes to be loaded by simple-keyboard.\r\n     * @property {boolean} enableLayoutCandidates Enable input method editor candidate list support.\r\n     * @property {object} excludeFromLayout Buttons to exclude from layout\r\n     * @property {number} layoutCandidatesPageSize Determines size of layout candidate list\r\n     * @property {boolean} layoutCandidatesCaseSensitiveMatch Determines whether layout candidate match should be case sensitive.\r\n     * @property {boolean} disableCandidateNormalization Disables the automatic normalization for selected layout candidates\r\n     * @property {boolean} enableLayoutCandidatesKeyPress Enables onKeyPress triggering for layoutCandidate items\r\n     * @property {boolean} updateCaretOnSelectionChange Updates caret when selectionchange event is fired\r\n     * @property {boolean} clickOnMouseDown When useMouseEvents is enabled, this option allows you to trigger a button click event on mousedown\r\n     */\r\n    this.options = {\r\n      layoutName: 'default',\r\n      theme: 'hg-theme-default',\r\n      inputName: 'default',\r\n      preventMouseDownDefault: false,\r\n      enableLayoutCandidates: true,\r\n      excludeFromLayout: {},\r\n      ...options,\r\n    };\r\n\r\n    /**\r\n     * @type {object} Classes identifying loaded plugins\r\n     */\r\n    this.keyboardPluginClasses = '';\r\n\r\n    /**\r\n     * Bindings\r\n     */\r\n    Utilities.bindMethods(SimpleKeyboard, this);\r\n\r\n    /**\r\n     * simple-keyboard uses a non-persistent internal input to keep track of the entered string (the variable `keyboard.input`).\r\n     * This removes any dependency to input DOM elements. You can type and directly display the value in a div element, for example.\r\n     * @example\r\n     * // To get entered input\r\n     * const input = keyboard.getInput();\r\n     *\r\n     * // To clear entered input.\r\n     * keyboard.clearInput();\r\n     *\r\n     * @type {object}\r\n     * @property {object} default Default SimpleKeyboard internal input.\r\n     * @property {object} myInputName Example input that can be set through `options.inputName:\"myInputName\"`.\r\n     */\r\n    const { inputName = this.defaultName } = this.options;\r\n    this.input = {};\r\n    this.input[inputName] = '';\r\n\r\n    /**\r\n     * @type {string} DOM class of the keyboard wrapper, normally \"simple-keyboard\" by default.\r\n     */\r\n    this.keyboardDOMClass = keyboardDOMClass;\r\n\r\n    /**\r\n     * @type {object} Contains the DOM elements of every rendered button, the key being the button's layout name (e.g.: \"{enter}\").\r\n     */\r\n    this.buttonElements = {};\r\n\r\n    /**\r\n     * Simple-keyboard Instances\r\n     * This enables multiple simple-keyboard support with easier management\r\n     */\r\n    if (!(window as SKWindow)['SimpleKeyboardInstances']) (window as SKWindow)['SimpleKeyboardInstances'] = {};\r\n\r\n    this.currentInstanceName = this.utilities.camelCase(this.keyboardDOMClass);\r\n    (window as SKWindow)['SimpleKeyboardInstances'][this.currentInstanceName] = this;\r\n\r\n    /**\r\n     * Instance vars\r\n     */\r\n    this.allKeyboardInstances = (window as SKWindow)['SimpleKeyboardInstances'];\r\n    this.keyboardInstanceNames = Object.keys((window as SKWindow)['SimpleKeyboardInstances']);\r\n    this.isFirstKeyboardInstance = this.keyboardInstanceNames[0] === this.currentInstanceName;\r\n\r\n    /**\r\n     * Physical Keyboard support\r\n     */\r\n    this.physicalKeyboard = new PhysicalKeyboard({\r\n      dispatch: this.dispatch,\r\n      getOptions: this.getOptions,\r\n      getNavEngaged: () => this._navEngaged,\r\n    });\r\n\r\n    /**\r\n     * Initializing CandidateBox\r\n     */\r\n    this.candidateBox = this.options.enableLayoutCandidates\r\n      ? new CandidateBox({\r\n          utilities: this.utilities,\r\n          options: this.options,\r\n        })\r\n      : null;\r\n\r\n    /**\r\n     * Rendering keyboard\r\n     */\r\n    if (this.keyboardDOM) this.render();\r\n    else {\r\n      console.warn(`\".${keyboardDOMClass}\" was not found in the DOM.`);\r\n      throw new Error('KEYBOARD_DOM_ERROR');\r\n    }\r\n\r\n    /**\r\n     * Modules\r\n     */\r\n    this.modules = {};\r\n    this.loadModules();\r\n  }\r\n\r\n  get navEngaged() {\r\n    return this._navEngaged;\r\n  }\r\n\r\n  private setNavEngaged(value: boolean) {\r\n    if (this._navEngaged !== value) {\r\n      this._navEngaged = value;\r\n      if (typeof this.options.onRovingToggle === 'function') {\r\n        this.options.onRovingToggle(value);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Accessibility Announcer\r\n   * This module is responsible for announcing changes in the keyboard state to assistive technologies.\r\n   */\r\n  private ensureAnnouncer(keyboardEl: Element): HTMLDivElement {\r\n    const parentEl = keyboardEl.parentElement;\r\n\r\n    // Prefer sibling announcer\r\n    if (parentEl) {\r\n      let announcerEl = parentEl.querySelector<HTMLDivElement>(':scope > .hg-live-region');\r\n      if (!announcerEl) {\r\n        announcerEl = document.createElement('div');\r\n        announcerEl.className = 'hg-live-region sr-only';\r\n        announcerEl.setAttribute('role', 'status');\r\n        announcerEl.setAttribute('aria-live', 'polite');\r\n        announcerEl.setAttribute('aria-atomic', 'false');\r\n        keyboardEl.insertAdjacentElement('afterend', announcerEl);\r\n      } else {\r\n        announcerEl.textContent = '';\r\n      }\r\n      return announcerEl;\r\n    }\r\n\r\n    // Fallback: insert inside root but outside key rows\r\n    let announcerEl = keyboardEl.querySelector<HTMLDivElement>(':scope > .hg-live-region');\r\n    if (!announcerEl) {\r\n      announcerEl = document.createElement('div');\r\n      announcerEl.className = 'hg-live-region sr-only';\r\n      announcerEl.setAttribute('role', 'status');\r\n      announcerEl.setAttribute('aria-live', 'polite');\r\n      announcerEl.setAttribute('aria-atomic', 'false');\r\n\r\n      const rowsEl = keyboardEl.querySelector(':scope > .hg-rows');\r\n      if (rowsEl && rowsEl.nextSibling) {\r\n        keyboardEl.insertBefore(announcerEl, rowsEl.nextSibling);\r\n      } else {\r\n        keyboardEl.appendChild(announcerEl);\r\n      }\r\n    } else {\r\n      announcerEl.textContent = '';\r\n    }\r\n\r\n    return announcerEl;\r\n  }\r\n\r\n  /**\r\n   * Enable Roving\r\n   */\r\n  enableRoving(): void {\r\n    this._rovingLocked = false;\r\n  }\r\n\r\n  /**\r\n   * Disable Roving\r\n   */\r\n  disableRoving(): void {\r\n    this._rovingLocked = true;\r\n    const currentOptions = this.getOptions();\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('[disableRoving] Disabling Roving:', this._rovingLocked);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear Roving Lock\r\n   */\r\n  clearRovingOverride(): void {\r\n    this._rovingLocked = null;\r\n  }\r\n\r\n  /**\r\n   * Check if Roving is Active\r\n   */\r\n  isRovingActive(): boolean {\r\n    const currentOptions = this.getOptions();\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('Nav Engaged:', this.navEngaged);\r\n      console.log('Active Surface:', currentOptions.activeSurface);\r\n      console.log('Roving Locked:', this._rovingLocked);\r\n    }\r\n\r\n    let result: boolean;\r\n\r\n    if (this._rovingLocked === true) {\r\n      result = false; // forced off\r\n    } else if (this._rovingLocked === false) {\r\n      // explicit enable, but still must be on keyboard surface\r\n      result = this.navEngaged && this.options.activeSurface === 'keyboard';\r\n    } else {\r\n      // null: no external override, just internal behaviour\r\n      result = this.navEngaged && this.options.activeSurface === 'keyboard';\r\n    }\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('Is Roving Active Result:', result);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * parseParams\r\n   */\r\n  handleParams = (\r\n    selectorOrOptions?: string | HTMLDivElement | KeyboardOptions,\r\n    keyboardOptions?: KeyboardOptions\r\n  ): {\r\n    keyboardDOMClass: string;\r\n    keyboardDOM: KeyboardElement;\r\n    options: Partial<KeyboardOptions | undefined>;\r\n  } => {\r\n    let keyboardDOMClass;\r\n    let keyboardDOM;\r\n    let options;\r\n\r\n    /**\r\n     * If first parameter is a string:\r\n     * Consider it as an element's class\r\n     */\r\n    if (typeof selectorOrOptions === 'string') {\r\n      keyboardDOMClass = selectorOrOptions.split('.').join('');\r\n      keyboardDOM = document.querySelector(`.${keyboardDOMClass}`) as KeyboardElement;\r\n      options = keyboardOptions;\r\n\r\n      /**\r\n       * If first parameter is an KeyboardElement\r\n       * Consider it as the keyboard DOM element\r\n       */\r\n    } else if (selectorOrOptions instanceof HTMLDivElement) {\r\n      /**\r\n       * This element must have a class, otherwise throw\r\n       */\r\n      if (!selectorOrOptions.className) {\r\n        console.warn('Any DOM element passed as parameter must have a class.');\r\n        throw new Error('KEYBOARD_DOM_CLASS_ERROR');\r\n      }\r\n\r\n      keyboardDOMClass = selectorOrOptions.className.split(' ')[0];\r\n      keyboardDOM = selectorOrOptions;\r\n      options = keyboardOptions;\r\n\r\n      /**\r\n       * Otherwise, search for .simple-keyboard DOM element\r\n       */\r\n    } else {\r\n      keyboardDOMClass = 'simple-keyboard';\r\n      keyboardDOM = document.querySelector(`.${keyboardDOMClass}`) as KeyboardElement;\r\n      options = selectorOrOptions;\r\n    }\r\n\r\n    return {\r\n      keyboardDOMClass,\r\n      keyboardDOM,\r\n      options,\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Getters\r\n   */\r\n  getOptions = (): KeyboardOptions => this.options;\r\n  getCaretPosition = (): number | null => this.caretPosition;\r\n  getCaretPositionEnd = (): number | null => this.caretPositionEnd;\r\n\r\n  /**\r\n   * Changes the internal caret position\r\n   * @param {number} position The caret's start position\r\n   * @param {number} positionEnd The caret's end position\r\n   */\r\n  setCaretPosition(position: number | null, endPosition = position): void {\r\n    this.caretPosition = position;\r\n    this.caretPositionEnd = endPosition;\r\n  }\r\n\r\n  /**\r\n   * Retrieve the candidates for a given input\r\n   * @param input The input string to check\r\n   */\r\n  getInputCandidates(input: string): { candidateKey: string; candidateValue: string } | Record<string, never> {\r\n    const { layoutCandidates: layoutCandidatesObj, layoutCandidatesCaseSensitiveMatch } = this.options;\r\n\r\n    if (!layoutCandidatesObj || typeof layoutCandidatesObj !== 'object') {\r\n      return {};\r\n    }\r\n\r\n    const layoutCandidates = Object.keys(layoutCandidatesObj).filter((layoutCandidate: string) => {\r\n      const inputSubstr = input.substring(0, this.getCaretPositionEnd() || 0) || input;\r\n      const regexp = new RegExp(\r\n        `${this.utilities.escapeRegex(layoutCandidate)}$`,\r\n        layoutCandidatesCaseSensitiveMatch ? 'g' : 'gi'\r\n      );\r\n      const matches = [...inputSubstr.matchAll(regexp)];\r\n      return !!matches.length;\r\n    });\r\n\r\n    if (layoutCandidates.length > 1) {\r\n      const candidateKey = layoutCandidates.sort((a, b) => b.length - a.length)[0];\r\n      return {\r\n        candidateKey,\r\n        candidateValue: layoutCandidatesObj[candidateKey],\r\n      };\r\n    } else if (layoutCandidates.length) {\r\n      const candidateKey = layoutCandidates[0];\r\n      return {\r\n        candidateKey,\r\n        candidateValue: layoutCandidatesObj[candidateKey],\r\n      };\r\n    } else {\r\n      return {};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows a suggestion box with a list of candidate words\r\n   * @param candidates The chosen candidates string as defined in the layoutCandidates option\r\n   * @param targetElement The element next to which the candidates box will be shown\r\n   */\r\n  showCandidatesBox(candidateKey: string, candidateValue: string, targetElement: KeyboardElement): void {\r\n    if (this.candidateBox) {\r\n      this.candidateBox.show({\r\n        candidateValue,\r\n        targetElement,\r\n        onSelect: (selectedCandidate: string, e: MouseEvent) => {\r\n          const { layoutCandidatesCaseSensitiveMatch, disableCandidateNormalization, enableLayoutCandidatesKeyPress } =\r\n            this.options;\r\n\r\n          let candidateStr = selectedCandidate;\r\n\r\n          if (!disableCandidateNormalization) {\r\n            /**\r\n             * Making sure that our suggestions are not composed characters\r\n             */\r\n            candidateStr = selectedCandidate.normalize('NFD');\r\n          }\r\n\r\n          /**\r\n           * Perform an action before any input change\r\n           */\r\n          if (typeof this.options.beforeInputUpdate === 'function') {\r\n            this.options.beforeInputUpdate(this);\r\n          }\r\n\r\n          const currentInput = this.getInput(this.options.inputName, true);\r\n          const initialCaretPosition = this.getCaretPositionEnd() || 0;\r\n          const inputSubstr = currentInput.substring(0, initialCaretPosition || 0) || currentInput;\r\n\r\n          const regexp = new RegExp(\r\n            `${this.utilities.escapeRegex(candidateKey)}$`,\r\n            layoutCandidatesCaseSensitiveMatch ? 'g' : 'gi'\r\n          );\r\n          const newInputSubstr = inputSubstr.replace(regexp, candidateStr);\r\n          const newInput = currentInput.replace(inputSubstr, newInputSubstr);\r\n\r\n          const caretPositionDiff = newInputSubstr.length - inputSubstr.length;\r\n          let newCaretPosition = (initialCaretPosition || currentInput.length) + caretPositionDiff;\r\n\r\n          if (newCaretPosition < 0) newCaretPosition = 0;\r\n\r\n          this.setInput(newInput, this.options.inputName, true);\r\n          this.setCaretPosition(newCaretPosition);\r\n\r\n          /**\r\n           * Calling onKeyPress\r\n           * We pass in the composed candidate instead of the decomposed one\r\n           * To prevent confusion for users\r\n           */\r\n          if (enableLayoutCandidatesKeyPress && typeof this.options.onKeyPress === 'function') {\r\n            this.options.onKeyPress(selectedCandidate, e);\r\n          }\r\n\r\n          if (typeof this.options.onChange === 'function') {\r\n            this.options.onChange(this.getInput(this.options.inputName, true), e);\r\n          }\r\n\r\n          /**\r\n           * Calling onChangeAll\r\n           */\r\n          if (typeof this.options.onChangeAll === 'function') this.options.onChangeAll(this.getAllInputs(), e);\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles clicks made to keyboard buttons\r\n   * @param  {string} button The button's layout name.\r\n   */\r\n  handleButtonClicked(button: string, e?: KeyboardHandlerEvent): void {\r\n    const { inputName = this.defaultName } = this.options;\r\n    /**\r\n     * Ignoring placeholder buttons\r\n     */\r\n    if (button === '{//}') return;\r\n\r\n    /**\r\n     * Creating inputName if it doesn't exist\r\n     */\r\n    if (!this.input[inputName]) this.input[inputName] = '';\r\n\r\n    /**\r\n     * Perform an action before any input change\r\n     */\r\n    if (typeof this.options.beforeInputUpdate === 'function') {\r\n      this.options.beforeInputUpdate(this);\r\n    }\r\n\r\n    /**\r\n     * Calculating new input\r\n     */\r\n    const updatedInput = this.utilities.getUpdatedInput(\r\n      button,\r\n      this.input[inputName],\r\n      this.caretPosition,\r\n      this.caretPositionEnd\r\n    );\r\n\r\n    /**\r\n     * EDGE CASE: Check for whole input selection changes that will yield same updatedInput\r\n     */\r\n    if (this.utilities.isStandardButton(button) && this.activeInputElement) {\r\n      const isEntireInputSelection =\r\n        this.input[inputName] &&\r\n        this.input[inputName] === updatedInput &&\r\n        this.caretPosition === 0 &&\r\n        this.caretPositionEnd === updatedInput.length;\r\n\r\n      if (isEntireInputSelection) {\r\n        this.setInput('', this.options.inputName, true);\r\n        this.setCaretPosition(0);\r\n        this.activeInputElement.value = '';\r\n        this.activeInputElement.setSelectionRange(0, 0);\r\n        this.handleButtonClicked(button, e);\r\n        return;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Calling onKeyPress\r\n     */\r\n    if (typeof this.options.onKeyPress === 'function') this.options.onKeyPress(button, e);\r\n\r\n    if (\r\n      // If input will change as a result of this button press\r\n      this.input[inputName] !== updatedInput &&\r\n      // This pertains to the \"inputPattern\" option:\r\n      // If inputPattern isn't set\r\n      (!this.options.inputPattern ||\r\n        // Or, if it is set and if the pattern is valid - we proceed.\r\n        (this.options.inputPattern && this.inputPatternIsValid(updatedInput)))\r\n    ) {\r\n      /**\r\n       * If maxLength and handleMaxLength yield true, halting\r\n       */\r\n      if (this.options.maxLength && this.utilities.handleMaxLength(this.input, updatedInput)) {\r\n        return;\r\n      }\r\n\r\n      /**\r\n       * Updating input\r\n       */\r\n      const newInputValue = this.utilities.getUpdatedInput(\r\n        button,\r\n        this.input[inputName],\r\n        this.caretPosition,\r\n        this.caretPositionEnd,\r\n        true\r\n      );\r\n\r\n      this.setInput(newInputValue, this.options.inputName, true);\r\n\r\n      if (this.options.debug) console.log('Input changed:', this.getAllInputs());\r\n\r\n      if (this.options.debug) {\r\n        console.log(\r\n          'Caret at: ',\r\n          this.getCaretPosition(),\r\n          this.getCaretPositionEnd(),\r\n          `(${this.keyboardDOMClass})`,\r\n          e?.type\r\n        );\r\n      }\r\n\r\n      /**\r\n       * Enforce syncInstanceInputs, if set\r\n       */\r\n      if (this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n\r\n      /**\r\n       * Calling onChange\r\n       */\r\n      if (typeof this.options.onChange === 'function')\r\n        this.options.onChange(this.getInput(this.options.inputName, true), e);\r\n\r\n      /**\r\n       * Calling onChangeAll\r\n       */\r\n      if (typeof this.options.onChangeAll === 'function') this.options.onChangeAll(this.getAllInputs(), e);\r\n\r\n      /**\r\n       * Check if this new input has candidates (suggested words)\r\n       */\r\n      if (e?.target && this.options.enableLayoutCandidates) {\r\n        const { candidateKey, candidateValue } = this.getInputCandidates(updatedInput);\r\n\r\n        if (candidateKey && candidateValue) {\r\n          this.showCandidatesBox(candidateKey, candidateValue, this.keyboardDOM);\r\n        } else {\r\n          this.candidateBox?.destroy();\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * After a button is clicked the selection (if any) will disappear\r\n     * we should reflect this in our state, as applicable\r\n     */\r\n    if (this.caretPositionEnd && this.caretPosition !== this.caretPositionEnd) {\r\n      this.setCaretPosition(this.caretPositionEnd, this.caretPositionEnd);\r\n\r\n      if (this.activeInputElement) {\r\n        this.activeInputElement.setSelectionRange(this.caretPositionEnd, this.caretPositionEnd);\r\n      }\r\n\r\n      if (this.options.debug) {\r\n        console.log('Caret position aligned', this.caretPosition);\r\n      }\r\n    }\r\n\r\n    if (this.options.debug) {\r\n      console.log('Key pressed:', button);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get mouse hold state\r\n   */\r\n  getMouseHold() {\r\n    return this.isMouseHold;\r\n  }\r\n\r\n  /**\r\n   * Mark mouse hold state as set\r\n   */\r\n  setMouseHold(value: boolean) {\r\n    if (this.options.syncInstanceInputs) {\r\n      this.dispatch((instance: SimpleKeyboard) => {\r\n        instance.isMouseHold = value;\r\n      });\r\n    } else {\r\n      this.isMouseHold = value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles button mousedown\r\n   */\r\n  /* istanbul ignore next */\r\n  handleButtonMouseDown(button: string, e: KeyboardHandlerEvent): void {\r\n    if (e) {\r\n      /**\r\n       * Handle event options\r\n       */\r\n      if (this.options.preventMouseDownDefault) e.preventDefault();\r\n      if (this.options.stopMouseDownPropagation) e.stopPropagation();\r\n\r\n      /**\r\n       * Add active class\r\n       */\r\n      e.target.classList.add(this.activeButtonClass);\r\n    }\r\n\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n    if (this.holdTimeout) clearTimeout(this.holdTimeout);\r\n\r\n    /**\r\n     * @type {boolean} Whether the mouse is being held onKeyPress\r\n     */\r\n    this.setMouseHold(true);\r\n\r\n    /**\r\n     * @type {object} Time to wait until a key hold is detected\r\n     */\r\n    if (!this.options.disableButtonHold) {\r\n      this.holdTimeout = window.setTimeout(() => {\r\n        if (\r\n          (this.getMouseHold() &&\r\n            // TODO: This needs to be configurable through options\r\n            ((!button.includes('{') && !button.includes('}')) ||\r\n              button === '{delete}' ||\r\n              button === '{backspace}' ||\r\n              button === '{bksp}' ||\r\n              button === '{space}' ||\r\n              button === '{tab}')) ||\r\n          button === '{arrowright}' ||\r\n          button === '{arrowleft}' ||\r\n          button === '{arrowup}' ||\r\n          button === '{arrowdown}'\r\n        ) {\r\n          if (this.options.debug) console.log('Button held:', button);\r\n\r\n          this.handleButtonHold(button);\r\n        }\r\n        clearTimeout(this.holdTimeout);\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles button mouseup\r\n   */\r\n  handleButtonMouseUp(button?: string, e?: KeyboardHandlerEvent): void {\r\n    if (e) {\r\n      /**\r\n       * Handle event options\r\n       */\r\n      if (this.options.preventMouseUpDefault && e.preventDefault) e.preventDefault();\r\n      if (this.options.stopMouseUpPropagation && e.stopPropagation) e.stopPropagation();\r\n\r\n      /* istanbul ignore next */\r\n      const isKeyboard =\r\n        e.target === this.keyboardDOM ||\r\n        (e.target && this.keyboardDOM.contains(e.target)) ||\r\n        (this.candidateBox &&\r\n          this.candidateBox.candidateBoxElement &&\r\n          (e.target === this.candidateBox.candidateBoxElement ||\r\n            (e.target && this.candidateBox.candidateBoxElement.contains(e.target))));\r\n\r\n      /**\r\n       * On click outside, remove candidateBox\r\n       */\r\n      if (!isKeyboard && this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Remove active class\r\n     */\r\n    this.recurseButtons((buttonElement: Element) => {\r\n      buttonElement.classList.remove(this.activeButtonClass);\r\n    });\r\n\r\n    this.setMouseHold(false);\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n\r\n    /**\r\n     * Calling onKeyReleased\r\n     */\r\n    if (button && typeof this.options.onKeyReleased === 'function') this.options.onKeyReleased(button, e);\r\n  }\r\n\r\n  /**\r\n   * Handles container mousedown\r\n   */\r\n  handleKeyboardContainerMouseDown(e: KeyboardHandlerEvent): void {\r\n    /**\r\n     * Handle event options\r\n     */\r\n    if (this.options.preventMouseDownDefault) e.preventDefault();\r\n  }\r\n\r\n  /**\r\n   * Handles button hold\r\n   */\r\n  /* istanbul ignore next */\r\n  handleButtonHold(button: string): void {\r\n    if (this.holdInteractionTimeout) clearTimeout(this.holdInteractionTimeout);\r\n\r\n    /**\r\n     * @type {object} Timeout dictating the speed of key hold iterations\r\n     */\r\n    this.holdInteractionTimeout = window.setTimeout(() => {\r\n      if (this.getMouseHold()) {\r\n        this.handleButtonClicked(button);\r\n        this.handleButtonHold(button);\r\n      } else {\r\n        clearTimeout(this.holdInteractionTimeout);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Send a command to all simple-keyboard instances (if you have several instances).\r\n   */\r\n  syncInstanceInputs(): void {\r\n    this.dispatch((instance: SimpleKeyboard) => {\r\n      instance.replaceInput(this.input);\r\n      instance.setCaretPosition(this.caretPosition, this.caretPositionEnd);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear the keyboards input.\r\n   * @param {string} [inputName] optional - the internal input to select\r\n   */\r\n  clearInput(inputName: string = this.options.inputName || this.defaultName): void {\r\n    this.input[inputName] = '';\r\n\r\n    /**\r\n     * Reset caretPosition\r\n     */\r\n    this.setCaretPosition(0);\r\n\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n  }\r\n\r\n  /**\r\n   * Get the keyboards input (You can also get it from the onChange prop).\r\n   * @param  {string} [inputName] optional - the internal input to select\r\n   */\r\n  getInput(inputName: string = this.options.inputName || this.defaultName, skipSync = false): string {\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (this.options.syncInstanceInputs && !skipSync) this.syncInstanceInputs();\r\n\r\n    if (this.options.rtl) {\r\n      // Remove existing control chars\r\n      const inputWithoutRTLControl = this.input[inputName].replace('\\u202B', '').replace('\\u202C', '');\r\n\r\n      return '\\u202B' + inputWithoutRTLControl + '\\u202C';\r\n    } else {\r\n      return this.input[inputName];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all simple-keyboard inputs\r\n   */\r\n  getAllInputs(): KeyboardInput {\r\n    const output = {} as KeyboardInput;\r\n    const inputNames = Object.keys(this.input);\r\n\r\n    inputNames.forEach((inputName) => {\r\n      output[inputName] = this.getInput(inputName, true);\r\n    });\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * Set the keyboards input.\r\n   * @param  {string} input the input value\r\n   * @param  {string} inputName optional - the internal input to select\r\n   */\r\n  setInput(input: string, inputName: string = this.options.inputName || this.defaultName, skipSync?: boolean): void {\r\n    // Reserved channel for focus restoration\r\n    if (inputName === '_focusRestore') {\r\n      const prev = this.input['_focusRestore'];\r\n      this.input['_focusRestore'] = input;\r\n\r\n      const currentOptions = this.getOptions();\r\n\r\n      const mode = currentOptions.restoreFocusOnChange || 'content';\r\n\r\n      if (mode === 'never') return;\r\n\r\n      if (mode === 'content' && prev === input) {\r\n        return; // No content change\r\n      }\r\n\r\n      this.keyboardDOM?.focus();\r\n      return;\r\n    }\r\n\r\n    this.input[inputName] = input;\r\n\r\n    /**\r\n     * Enforce syncInstanceInputs, if set\r\n     */\r\n    if (!skipSync && this.options.syncInstanceInputs) this.syncInstanceInputs();\r\n  }\r\n\r\n  /**\r\n   * Replace the input object (`keyboard.input`)\r\n   * @param  {object} inputObj The input object\r\n   */\r\n  replaceInput(inputObj: KeyboardInput): void {\r\n    this.input = inputObj;\r\n  }\r\n\r\n  /**\r\n   * Set new option or modify existing ones after initialization.\r\n   * @param  {object} options The options to set\r\n   */\r\n  setOptions(options: Partial<KeyboardOptions> = {}): void {\r\n    const changedOptions = this.changedOptions(options);\r\n    this.options = Object.assign(this.options, options);\r\n\r\n    if (changedOptions.length) {\r\n      if (this.options.debug) {\r\n        console.log('changedOptions', changedOptions);\r\n      }\r\n\r\n      /**\r\n       * Some option changes require adjustments before re-render\r\n       */\r\n      this.onSetOptions(changedOptions);\r\n\r\n      /**\r\n       * Rendering\r\n       */\r\n      this.render();\r\n\r\n      /**\r\n       * Reset navEngaged when activeSurface is not keyboard\r\n       */\r\n      if (options.activeSurface && options.activeSurface !== 'keyboard') {\r\n        this.setNavEngaged(false);\r\n      }\r\n\r\n      /**\r\n       * Resume last roved key when switching back to VK\r\n       */\r\n      if (options.activeSurface === 'keyboard') {\r\n        let target: HTMLElement | null = null;\r\n\r\n        if (this._lastUsedKey) {\r\n          target = this.keyboardDOM?.querySelector(`[data-skbtnuid=\"${this._lastUsedKey}\"]`) as HTMLElement;\r\n        }\r\n\r\n        if (!target) {\r\n          const buttons = this.keyboardDOM?.querySelectorAll('.hg-button') || [];\r\n          target = buttons.length ? (buttons[0] as HTMLElement) : null;\r\n        }\r\n\r\n        if (target) {\r\n          // clear any existing aria-selected\r\n          this.keyboardDOM\r\n            ?.querySelectorAll(\"[aria-selected='true']\")\r\n            .forEach((btn) => btn.setAttribute('aria-selected', 'false'));\r\n\r\n          target.setAttribute('aria-selected', 'true');\r\n          this.keyboardDOM?.setAttribute('aria-activedescendant', target.id);\r\n\r\n          this.handleGetButtonAndAnnounce({\r\n            key: this._lastUsedKey || target.dataset.skbtnuid,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Original setOptions without extra logs\r\n  // setOptions(options = {}): void {\r\n  //   const changedOptions = this.changedOptions(options);\r\n  //   this.options = Object.assign(this.options, options);\r\n\r\n  //   if (changedOptions.length) {\r\n  //     if (this.options.debug) {\r\n  //       console.log('changedOptions', changedOptions);\r\n  //     }\r\n\r\n  //     /**\r\n  //      * Some option changes require adjustments before re-render\r\n  //      */\r\n  //     this.onSetOptions(changedOptions);\r\n\r\n  //     /**\r\n  //      * Rendering\r\n  //      */\r\n  //     this.render();\r\n  //   }\r\n  // }\r\n\r\n  /**\r\n   * Detecting changes to non-function options\r\n   * This allows us to ascertain whether a button re-render is needed\r\n   */\r\n  changedOptions(newOptions: Partial<KeyboardOptions>): string[] {\r\n    return Object.keys(newOptions).filter(\r\n      (optionName) => JSON.stringify(newOptions[optionName]) !== JSON.stringify(this.options[optionName])\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Executing actions depending on changed options\r\n   * @param  {object} options The options to set\r\n   */\r\n  onSetOptions(changedOptions: string[] = []): void {\r\n    /**\r\n     * Changed: layoutName\r\n     */\r\n    if (changedOptions.includes('layoutName')) {\r\n      /**\r\n       * Reset candidateBox\r\n       */\r\n      if (this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Changed: layoutCandidatesPageSize, layoutCandidates\r\n     */\r\n    if (changedOptions.includes('layoutCandidatesPageSize') || changedOptions.includes('layoutCandidates')) {\r\n      /**\r\n       * Reset and recreate candidateBox\r\n       */\r\n      if (this.candidateBox) {\r\n        this.candidateBox.destroy();\r\n        this.candidateBox = new CandidateBox({\r\n          utilities: this.utilities,\r\n          options: this.options,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all keyboard rows and reset keyboard values.\r\n   * Used internally between re-renders.\r\n   */\r\n  resetRows(): void {\r\n    if (this.keyboardRowsDOM) {\r\n      this.keyboardRowsDOM.remove();\r\n    }\r\n\r\n    this.keyboardDOM.className = this.keyboardDOMClass;\r\n    this.keyboardDOM.setAttribute('data-skInstance', this.currentInstanceName);\r\n    this.buttonElements = {};\r\n  }\r\n\r\n  /**\r\n   * Send a command to all simple-keyboard instances at once (if you have multiple instances).\r\n   * @param  {function(instance: object, key: string)} callback Function to run on every instance\r\n   */\r\n  // eslint-disable-next-line no-unused-vars\r\n  dispatch(callback: (instance: SimpleKeyboard, key?: string) => void): void {\r\n    if (!(window as SKWindow)['SimpleKeyboardInstances']) {\r\n      console.warn(`SimpleKeyboardInstances is not defined. Dispatch cannot be called.`);\r\n      throw new Error('INSTANCES_VAR_ERROR');\r\n    }\r\n\r\n    return Object.keys((window as SKWindow)['SimpleKeyboardInstances']).forEach((key) => {\r\n      callback((window as SKWindow)['SimpleKeyboardInstances'][key], key);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Adds/Modifies an entry to the `buttonTheme`. Basically a way to add a class to a button.\r\n   * @param  {string} buttons List of buttons to select (separated by a space).\r\n   * @param  {string} className Classes to give to the selected buttons (separated by space).\r\n   */\r\n  addButtonTheme(buttons: string, className: string): void {\r\n    if (!className || !buttons) return;\r\n\r\n    buttons.split(' ').forEach((button) => {\r\n      className.split(' ').forEach((classNameItem) => {\r\n        if (!this.options.buttonTheme) this.options.buttonTheme = [];\r\n\r\n        let classNameFound = false;\r\n\r\n        /**\r\n         * If class is already defined, we add button to class definition\r\n         */\r\n        this.options.buttonTheme.map((buttonTheme) => {\r\n          if (buttonTheme?.class.split(' ').includes(classNameItem)) {\r\n            classNameFound = true;\r\n\r\n            const buttonThemeArray = buttonTheme.buttons.split(' ');\r\n            if (!buttonThemeArray.includes(button)) {\r\n              classNameFound = true;\r\n              buttonThemeArray.push(button);\r\n              buttonTheme.buttons = buttonThemeArray.join(' ');\r\n            }\r\n          }\r\n          return buttonTheme;\r\n        });\r\n\r\n        /**\r\n         * If class is not defined, we create a new entry\r\n         */\r\n        if (!classNameFound) {\r\n          this.options.buttonTheme.push({\r\n            class: classNameItem,\r\n            buttons: buttons,\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Removes/Amends an entry to the `buttonTheme`. Basically a way to remove a class previously added to a button through buttonTheme or addButtonTheme.\r\n   * @param  {string} buttons List of buttons to select (separated by a space).\r\n   * @param  {string} className Classes to give to the selected buttons (separated by space).\r\n   */\r\n  removeButtonTheme(buttons: string, className: string): void {\r\n    /**\r\n     * When called with empty parameters, remove all button themes\r\n     */\r\n    if (!buttons && !className) {\r\n      this.options.buttonTheme = [];\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * If buttons are passed and buttonTheme has items\r\n     */\r\n    if (buttons && Array.isArray(this.options.buttonTheme) && this.options.buttonTheme.length) {\r\n      const buttonArray = buttons.split(' ');\r\n      buttonArray.forEach((button) => {\r\n        this.options?.buttonTheme?.map((buttonTheme, index) => {\r\n          /**\r\n           * If className is set, we affect the buttons only for that class\r\n           * Otherwise, we afect all classes\r\n           */\r\n          if ((buttonTheme && className && className.includes(buttonTheme.class)) || !className) {\r\n            const filteredButtonArray = buttonTheme?.buttons.split(' ').filter((item) => item !== button);\r\n\r\n            /**\r\n             * If buttons left, return them, otherwise, remove button Theme\r\n             */\r\n            if (buttonTheme && filteredButtonArray?.length) {\r\n              buttonTheme.buttons = filteredButtonArray.join(' ');\r\n            } else {\r\n              this.options.buttonTheme?.splice(index, 1);\r\n              buttonTheme = null;\r\n            }\r\n          }\r\n\r\n          return buttonTheme;\r\n        });\r\n      });\r\n\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the DOM Element of a button. If there are several buttons with the same name, an array of the DOM Elements is returned.\r\n   * @param  {string} button The button layout name to select\r\n   */\r\n  getButtonElement(button: string): KeyboardElement | KeyboardElement[] | undefined {\r\n    let output;\r\n\r\n    const buttonArr = this.buttonElements[button];\r\n    if (buttonArr) {\r\n      if (buttonArr.length > 1) {\r\n        output = buttonArr;\r\n      } else {\r\n        output = buttonArr[0];\r\n      }\r\n    }\r\n\r\n    return output;\r\n  }\r\n\r\n  /**\r\n   * This handles the \"inputPattern\" option\r\n   * by checking if the provided inputPattern passes\r\n   */\r\n  inputPatternIsValid(inputVal: string): boolean {\r\n    const inputPatternRaw = this.options.inputPattern;\r\n    let inputPattern;\r\n\r\n    /**\r\n     * Check if input pattern is global or targeted to individual inputs\r\n     */\r\n    if (inputPatternRaw instanceof RegExp) {\r\n      inputPattern = inputPatternRaw;\r\n    } else {\r\n      inputPattern = inputPatternRaw[this.options.inputName || this.defaultName];\r\n    }\r\n\r\n    if (inputPattern && inputVal) {\r\n      const didInputMatch = inputPattern.test(inputVal);\r\n\r\n      if (this.options.debug) {\r\n        console.log(`inputPattern (\"${inputPattern}\"): ${didInputMatch ? 'passed' : 'did not pass!'}`);\r\n      }\r\n\r\n      return didInputMatch;\r\n    } else {\r\n      /**\r\n       * inputPattern doesn't seem to be set for the current input, or input is empty. Pass.\r\n       */\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles the removal of event listers before initializing new ones\r\n   * This is useful when changing options that require a fresh set of event listeners\r\n   */\r\n\r\n  removeEventListeners(): void {\r\n    document.removeEventListener('keydown', this.handleUnifiedKeyDownBound);\r\n    document.removeEventListener('keyup', this.handleKeyUpBound);\r\n    document.removeEventListener('mouseup', this.handleMouseUpBound);\r\n    document.removeEventListener('touchend', this.handleTouchEndBound);\r\n    document.removeEventListener('select', this.handleSelectBound);\r\n\r\n    if (this.options.updateCaretOnSelectionChange) {\r\n      document.removeEventListener('selectionchange', this.handleSelectionChangeBound);\r\n    }\r\n\r\n    this.listenersAdded = false; // Allow re-adding if necessary\r\n  }\r\n  /**\r\n   * Handles simple-keyboard event listeners\r\n   */\r\n  setEventListeners(): void {\r\n    /**\r\n     * Only first instance should set the event listeners\r\n     */\r\n    if (this.isFirstKeyboardInstance || !this.allKeyboardInstances) {\r\n      if (this.options.debug) {\r\n        console.log(`Caret handling started (${this.keyboardDOMClass})`);\r\n      }\r\n\r\n      // LPJr: Prevent duplicate listeners\r\n      if (this.listenersAdded) {\r\n        return;\r\n      }\r\n\r\n      // Ensure existing listeners are removed before adding new ones\r\n      this.removeEventListeners();\r\n\r\n      // LPJr: added named event handlers instead of anonymous functions\r\n\r\n      this.handleUnifiedKeyDownBound = this.handleUnifiedKeyDown.bind(this);\r\n      this.handleKeyUpBound = this.handleKeyUp.bind(this);\r\n      this.handleMouseUpBound = this.handleMouseUp.bind(this);\r\n      this.handleTouchEndBound = () => this.handleTouchEnd(this);\r\n      this.handleSelectBound = () => this.handleSelect(this);\r\n      this.handleSelectionChangeBound = this.handleSelectionChange.bind(this);\r\n\r\n      document.addEventListener('keydown', this.handleUnifiedKeyDownBound as EventListener);\r\n      document.addEventListener('keyup', this.handleKeyUpBound);\r\n      document.addEventListener('mouseup', this.handleMouseUpBound);\r\n      document.addEventListener('touchend', this.handleTouchEndBound);\r\n\r\n      if (this.options.updateCaretOnSelectionChange) {\r\n        document.addEventListener('selectionchange', this.handleSelectionChangeBound);\r\n      }\r\n\r\n      document.addEventListener('select', this.handleSelectBound);\r\n\r\n      // Mark listeners as added to prevent duplicates\r\n      this.listenersAdded = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unified KeyDown Handler for Keyboard and Internal Navigation\r\n   */\r\n  handleUnifiedKeyDown(event: KeyboardHandlerEvent): void {\r\n    // Always handle navigation keys for roving\r\n    this.handleInternalKeyNav(event);\r\n\r\n    // Then standard key handling\r\n    this.handleKeyDown(event);\r\n  }\r\n\r\n  /**\r\n   * Event Debug Logger\r\n   */\r\n  logEventType(tag: string, event: Event) {\r\n    const currentOptions = this.getOptions();\r\n\r\n    if (!currentOptions.debug) return;\r\n    console.log(`[${tag}] Event type:`, event.type, '', event.constructor.name);\r\n  }\r\n\r\n  isSupportedEvent(event: Event): boolean {\r\n    return (\r\n      event instanceof KeyboardEvent ||\r\n      event instanceof MouseEvent ||\r\n      (typeof TouchEvent !== 'undefined' && event instanceof TouchEvent) ||\r\n      event instanceof PointerEvent\r\n    );\r\n  }\r\n\r\n  handleGetButtonAndAnnounce(event: KeyboardHandlerEvent): void {\r\n    if (!this.isSupportedEvent(event)) return;\r\n    this.getButtonAndAnnounce(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: KeyUp\r\n   */\r\n  handleKeyUp(event: KeyboardHandlerEvent): void {\r\n    // 1. CandidateBox owns key handling if open\r\n    if (CandidateBox.isOpen) {\r\n      return;\r\n    }\r\n\r\n    // 2. Normalize key\r\n    const key = event.key;\r\n\r\n    // 3. Prevent default only for printable chars when configured\r\n    const bypassKeys = new Set([\r\n      'Tab',\r\n      'ArrowUp',\r\n      'ArrowDown',\r\n      'ArrowLeft',\r\n      'ArrowRight',\r\n      'Enter',\r\n      'Escape',\r\n      ' ',\r\n      'Spacebar',\r\n    ]);\r\n\r\n    if (this.options.physicalKeyboardHighlightPreventDefault && event instanceof KeyboardEvent) {\r\n      const isPrintable = key.length === 1;\r\n      if (!bypassKeys.has(key) && isPrintable) {\r\n        event.preventDefault();\r\n      }\r\n    }\r\n\r\n    // 4. Caret handling\r\n    this.caretEventHandler(event);\r\n\r\n    // 5. Release physical highlight\r\n    if (this.options.physicalKeyboardHighlight) {\r\n      this.physicalKeyboard.handleHighlightKeyUp(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resolve the actual key to announce/handle based on roving state\r\n   */\r\n  private resolveKey(key: string, navEngaged: boolean): string | null {\r\n    const active = this.keyboardDOM.querySelector('.hg-button[aria-selected=\"true\"]') as HTMLElement | null;\r\n    const rovedKey = active?.getAttribute('data-skbtn');\r\n\r\n    // If no roved element, fall back\r\n    if (!rovedKey) return key;\r\n\r\n    // No roving yet  Enter/Space act literally\r\n    if (!navEngaged && (key === 'Enter' || key === ' ' || key === 'Spacebar')) {\r\n      return key === 'Enter' ? '{enter}' : '{space}';\r\n    }\r\n\r\n    // Roving engaged  Enter/Space resolve to selected key\r\n    if (key === 'Enter' || key === ' ' || key === 'Spacebar') {\r\n      return rovedKey;\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  /**\r\n   * Event Handler: KeyDown\r\n   */\r\n  handleKeyDown(event: KeyboardHandlerEvent): void {\r\n    // // 1. CandidateBox takes over completely when open\r\n    // if (CandidateBox.isOpen) {\r\n    //   return;\r\n    // }\r\n\r\n    // Get current options (for dynamic option changes)\r\n    const currentOptions = this.getOptions();\r\n\r\n    // 2. Normalize key values (Spacebar  ' ')\r\n    const key = event.key === 'Spacebar' ? ' ' : event.key;\r\n\r\n    // 3. Prevent browser defaults for printable keys if highlightPreventDefault is enabled\r\n    const bypassKeys = new Set([\r\n      'Tab',\r\n      'ArrowUp',\r\n      'ArrowDown',\r\n      'ArrowLeft',\r\n      'ArrowRight',\r\n      'Enter',\r\n      'Escape',\r\n      ' ',\r\n      'Spacebar',\r\n    ]);\r\n\r\n    if (this.options.physicalKeyboardHighlightPreventDefault && event instanceof KeyboardEvent) {\r\n      const isPrintable = key.length === 1; // single character like a, 1, !\r\n      if (!bypassKeys.has(key) && isPrintable) {\r\n        event.preventDefault();\r\n      }\r\n    }\r\n\r\n    // 4. Activation keys (Enter, Space) -> Always handled by the VK\r\n    if (event instanceof KeyboardEvent && (key === 'Enter' || key === ' ' || key === 'Spacebar')) {\r\n      // built boolean to track if nav is engaged and activeSurface is the keyboard and roving is allowed\r\n      const navEngaged = this.isRovingActive();\r\n\r\n      if (navEngaged) {\r\n        event.preventDefault(); // prevent form submit or scroll\r\n        event.stopPropagation();\r\n        event.stopImmediatePropagation();\r\n\r\n        const resolved = this.resolveKey(key, navEngaged);\r\n        console.log('Resolved key for activation:', resolved);\r\n        if (resolved) {\r\n          this.handleButtonClicked(resolved, event);\r\n          const target = this.keyboardDOM?.querySelector('.hg-button[aria-selected=\"true\"]') as HTMLElement | null;\r\n          const keyLabel = target?.getAttribute('data-skbtn');\r\n          if (keyLabel) {\r\n            this.getButtonAndAnnounce({ key: keyLabel });\r\n          }\r\n        }\r\n\r\n        return; // Skip further processing for activation keys\r\n      }\r\n    }\r\n\r\n    // 5. Log the event\r\n    this.logEventType('Keyboard', event);\r\n\r\n    // 6. Sync physical highlight\r\n    if (this.options.physicalKeyboardHighlight) {\r\n      this.physicalKeyboard.handleHighlightKeyDown(event);\r\n    }\r\n\r\n    // 7. Announce keys to assistive tech\r\n    this.handleGetButtonAndAnnounce(event);\r\n  }\r\n\r\n  /**\r\n   * Check if the physical key pressed matches the button that would be triggered\r\n   * by the physical keyboard system. This prevents double triggering.\r\n   */\r\n  isPhysicalKeyMatchingButton(event: KeyboardEvent, buttonLabel: string): boolean {\r\n    // For space keys, only match if we're on the spacebar button\r\n    if (event.key === ' ' || event.key === 'Spacebar') {\r\n      return buttonLabel === '{space}' || buttonLabel.toLowerCase().includes('space');\r\n    }\r\n\r\n    // For other keys, we need to check if the physical key would trigger this exact button\r\n    // This is a simplified check - in reality, the PhysicalKeyboard service has complex mapping logic\r\n    // But for our use case, we mainly care about preventing space key double-triggering\r\n\r\n    // For standard alphanumeric characters\r\n    if (event.key.length === 1) {\r\n      return buttonLabel === event.key.toLowerCase() || buttonLabel === event.key.toUpperCase();\r\n    }\r\n\r\n    // For special keys like Enter\r\n    if (event.key === 'Enter') {\r\n      return buttonLabel === '{enter}' || buttonLabel.toLowerCase().includes('enter');\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getAnnounceLabel(pressedKey: string): string | null {\r\n    const isNamedKey = this.NAMED_KEYS_TO_ANNOUNCE.has(pressedKey);\r\n    const isPrintable = pressedKey.length === 1;\r\n\r\n    const focused = document.activeElement as HTMLElement;\r\n    const focusedLabel =\r\n      focused?.getAttribute('aria-label') || focused?.textContent?.trim() || focused?.getAttribute('data-skbtn');\r\n\r\n    if (isNamedKey && focusedLabel && focusedLabel !== pressedKey) {\r\n      return focusedLabel;\r\n    }\r\n\r\n    if (!isPrintable && !isNamedKey) return null;\r\n\r\n    return this.NAMED_READABLE[pressedKey] || pressedKey;\r\n  }\r\n\r\n  /**\r\n   * Determine if announcements should be suppressed based on current context\r\n   */\r\n  shouldSuppressAnnouncements(): boolean {\r\n    // Always respect the useLiveRegion setting\r\n    if (!this.options.useLiveRegion) return true;\r\n\r\n    // Respect announcement mode\r\n    const announceMode = this.options.liveRegionAnnounceMode || 'actions';\r\n    if (announceMode === 'none') return true;\r\n\r\n    // Check if we should suppress when input is focused\r\n    if (this.options.suppressAnnouncementsOnInputFocus) {\r\n      const activeElement = document.activeElement;\r\n      if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Get the content result for a button press (for content-mode announcements)\r\n   */\r\n  getContentForButton(buttonLabel: string): string | null {\r\n    // Handle special buttons\r\n    if (buttonLabel === '{space}') return 'space';\r\n    if (buttonLabel === '{enter}') return 'new line';\r\n    if (buttonLabel === '{bksp}' || buttonLabel === '{backspace}') return 'deleted';\r\n    if (buttonLabel === '{tab}') return 'tab';\r\n    if (buttonLabel === '{delete}') return 'deleted';\r\n\r\n    // For regular character buttons, return the character itself\r\n    if (buttonLabel.length === 1) {\r\n      return buttonLabel;\r\n    }\r\n\r\n    // For other special buttons, try to get display name\r\n    const displayName = this.utilities.getButtonDisplayName(\r\n      buttonLabel,\r\n      this.options.display,\r\n      this.options.mergeDisplay\r\n    );\r\n\r\n    return displayName !== buttonLabel ? displayName : null;\r\n  }\r\n\r\n  /**\r\n   * Get the Button Element for Live Region announcements\r\n   * Backward-compatible entry point; now internally gated.\r\n   */\r\n  getButtonAndAnnounce(event: Event | { key: string }): void {\r\n    // Check if announcements should be suppressed\r\n    if (this.shouldSuppressAnnouncements()) return;\r\n\r\n    let pressedKey: string | null = null;\r\n    let buttonLabel: string | null = null;\r\n\r\n    // 1. Synthetic key object path\r\n    if ((event as any)?.key && !(event instanceof KeyboardEvent)) {\r\n      pressedKey = (event as any).key;\r\n    }\r\n\r\n    // 1. KeyboardEvent path\r\n    if (event instanceof KeyboardEvent) {\r\n      if (event.isComposing || event.repeat) return;\r\n      pressedKey = event.key;\r\n    }\r\n\r\n    // 2. Pointer/touch path\r\n    if (\r\n      event instanceof MouseEvent ||\r\n      event instanceof PointerEvent ||\r\n      (typeof TouchEvent !== 'undefined' && event instanceof TouchEvent)\r\n    ) {\r\n      const target = (event.target as HTMLElement)?.closest?.('[data-skbtn]');\r\n      if (!target || !this.keyboardDOM.contains(target)) return;\r\n\r\n      buttonLabel = target.getAttribute('data-skbtn');\r\n      pressedKey = target.getAttribute('aria-label') || target.textContent?.trim() || buttonLabel;\r\n    }\r\n\r\n    if (!pressedKey) return;\r\n\r\n    const announceMode = this.options.liveRegionAnnounceMode || 'actions';\r\n\r\n    if (announceMode === 'none') return;\r\n\r\n    // Announce button action\r\n    if (announceMode === 'actions' || announceMode === 'both') {\r\n      const actionLabel = this.getAnnounceLabel(pressedKey);\r\n      if (actionLabel) {\r\n        this.announceLiveRegion(actionLabel, 'pressed');\r\n      }\r\n    }\r\n\r\n    // Announce content result\r\n    if ((announceMode === 'content' || announceMode === 'both') && buttonLabel) {\r\n      const contentResult = this.getContentForButton(buttonLabel);\r\n      if (contentResult) {\r\n        // Small delay to avoid conflicts with action announcement\r\n        setTimeout(\r\n          () => {\r\n            this.announceLiveRegion(contentResult, '');\r\n          },\r\n          announceMode === 'both' ? 200 : 0\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * WCAG 2.1 Live Region for announcing key focus changes\r\n   * This is used to announce key focus changes for screen readers\r\n   */\r\n\r\n  announceLiveRegion(keyLabel: string, context = 'pressed'): void {\r\n    if (!this.options.useLiveRegion || !this._announcerEl) return;\r\n\r\n    if (this.ariaLiveTimer) clearTimeout(this.ariaLiveTimer);\r\n\r\n    this.ariaLiveTimer = setTimeout(() => {\r\n      if (this._announcerEl) {\r\n        this._announcerEl.textContent = '';\r\n        requestAnimationFrame(() => {\r\n          if (this._announcerEl) {\r\n            this._announcerEl.textContent = `Key ${keyLabel} ${context}`;\r\n          }\r\n        });\r\n      }\r\n    }, 100);\r\n  }\r\n  /**\r\n   * Event Handler: Internal Key Navigation\r\n   */\r\n  handleInternalKeyNav(event: KeyboardEvent): void {\r\n    if (!(event instanceof KeyboardEvent)) return;\r\n    if (!this.keyboardDOM?.offsetParent) return;\r\n    if (CandidateBox.isOpen) return;\r\n\r\n    this.setNavEngaged(true);\r\n\r\n    const currentOptions = this.getOptions();\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('[handleInternalKeyNav] Current Options:', currentOptions);\r\n    }\r\n\r\n    if (currentOptions.debug) {\r\n      console.log(\r\n        '[handleInternalKeyNav] Internal Key Nav:',\r\n        event.key,\r\n        'Active Surface:',\r\n        currentOptions.activeSurface\r\n      );\r\n      console.log('[handleInternalKeyNav] Nav Engaged:', this.navEngaged);\r\n      console.log('[handleInternalKeyNav] Is Roving Active:', this.isRovingActive());\r\n    }\r\n    if (!this.isRovingActive()) return; // Roving not active or locked\r\n\r\n    // Gate arrow key handling to when keyboard is not active surface\r\n    if (currentOptions.activeSurface !== 'keyboard') return;\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('[handleInternalKeyNav] Handling Internal Key Nav:', event.key);\r\n    }\r\n\r\n    const { key } = event;\r\n\r\n    if (!['ArrowRight', 'ArrowLeft', 'ArrowDown', 'ArrowUp'].includes(key)) return;\r\n\r\n    if (currentOptions.debug) {\r\n      console.log('[handleInternalKeyNav] Arrow key pressed:', key);\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    const focused = this.keyboardDOM.querySelector('[aria-selected=\"true\"]') as HTMLElement;\r\n\r\n    // Find the currently focused button\r\n    if (!focused || !focused.hasAttribute('data-skbtnuid')) return;\r\n\r\n    // Implement directional logic\r\n    let nextButton: HTMLElement | null = null;\r\n\r\n    switch (key) {\r\n      case 'ArrowRight':\r\n        nextButton = this.findNextButton(focused);\r\n        break;\r\n      case 'ArrowLeft':\r\n        nextButton = this.findPreviousButton(focused);\r\n        break;\r\n      case 'ArrowDown':\r\n        nextButton = this.findVerticalButton(focused, 'down');\r\n        break;\r\n      case 'ArrowUp':\r\n        nextButton = this.findVerticalButton(focused, 'up');\r\n        break;\r\n    }\r\n\r\n    if (nextButton) {\r\n      focused.setAttribute('aria-selected', 'false');\r\n      this._lastUsedKey = nextButton.getAttribute('data-skbtnuid') || null;\r\n      nextButton.setAttribute('aria-selected', 'true');\r\n      this.keyboardDOM.setAttribute('aria-activedescendant', nextButton.id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find the next button in the keyboard layout\r\n   */\r\n  findNextButton(current: HTMLElement): HTMLElement | null {\r\n    const allButtons = Array.from(this.keyboardDOM.querySelectorAll('[data-skBtn]')) as HTMLElement[];\r\n\r\n    const idx = allButtons.indexOf(current);\r\n    return allButtons[idx + 1] || null;\r\n  }\r\n\r\n  /**\r\n   * Find the previous button in the keyboard layout\r\n   */\r\n  findPreviousButton(current: HTMLElement): HTMLElement | null {\r\n    const allButtons = Array.from(this.keyboardDOM.querySelectorAll('[data-skBtn]')) as HTMLElement[];\r\n\r\n    const idx = allButtons.indexOf(current);\r\n    return allButtons[idx - 1] || null;\r\n  }\r\n\r\n  /**\r\n   * Find the vertically closest button above or below the current one.\r\n   */\r\n  findVerticalButton(current: HTMLElement, direction: 'up' | 'down'): HTMLElement | null {\r\n    const rows = Array.from(this.keyboardDOM.querySelectorAll('.hg-row')) as HTMLElement[];\r\n    const currentRow = current.closest('.hg-row') as HTMLElement | null;\r\n    if (!currentRow) return null;\r\n\r\n    const rowIndex = rows.indexOf(currentRow);\r\n    const targetIndex = direction === 'up' ? rowIndex - 1 : rowIndex + 1;\r\n    const targetRow = rows[targetIndex];\r\n    if (!targetRow) return null; // already at top or bottom\r\n\r\n    const currentRect = current.getBoundingClientRect();\r\n    const currentCenterX = currentRect.left + currentRect.width / 2;\r\n\r\n    const candidates = Array.from(targetRow.querySelectorAll<HTMLElement>('[data-skBtn]'));\r\n    if (!candidates.length) return null;\r\n\r\n    // Find the key in target row closest in X to the current key\r\n    let closest = candidates[0];\r\n    let minDelta = Number.POSITIVE_INFINITY;\r\n\r\n    for (const el of candidates) {\r\n      const rect = el.getBoundingClientRect();\r\n      const centerX = rect.left + rect.width / 2;\r\n      const delta = Math.abs(centerX - currentCenterX);\r\n      if (delta < minDelta) {\r\n        minDelta = delta;\r\n        closest = el;\r\n      }\r\n    }\r\n\r\n    return closest;\r\n  }\r\n\r\n  /**\r\n   * Event Handler: MouseUp\r\n   */\r\n  handleMouseUp(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n\r\n    this.logEventType('Mouse', event);\r\n\r\n    this.handleGetButtonAndAnnounce(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: TouchEnd\r\n   */\r\n  /* istanbul ignore next */\r\n  handleTouchEnd(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n\r\n    this.logEventType('Touch', event);\r\n\r\n    this.handleGetButtonAndAnnounce(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: Select\r\n   */\r\n  /* istanbul ignore next */\r\n  handleSelect(event: KeyboardHandlerEvent): void {\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Event Handler: SelectionChange\r\n   */\r\n  /* istanbul ignore next */\r\n  handleSelectionChange(event: KeyboardHandlerEvent): void {\r\n    /**\r\n     * Firefox is not reporting the correct caret position through this event\r\n     * https://github.com/hodgef/simple-keyboard/issues/1839\r\n     */\r\n    if (navigator.userAgent.includes('Firefox')) {\r\n      return;\r\n    }\r\n    this.caretEventHandler(event);\r\n  }\r\n\r\n  /**\r\n   * Called by {@link setEventListeners} when an event that warrants a cursor position update is triggered\r\n   */\r\n  caretEventHandler(event: KeyboardHandlerEvent): void {\r\n    const target = event?.target as HTMLElement | null;\r\n\r\n    let targetTagName = '';\r\n    if (target?.tagName) {\r\n      targetTagName = target.tagName.toLowerCase();\r\n    }\r\n    this.dispatch((instance) => {\r\n      let isKeyboard =\r\n        event.target === instance.keyboardDOM || (event.target && instance.keyboardDOM.contains(event.target));\r\n\r\n      /**\r\n       * If syncInstanceInputs option is enabled, make isKeyboard match any instance\r\n       * not just the current one\r\n       */\r\n      if (this.options.syncInstanceInputs && Array.isArray(event.path)) {\r\n        isKeyboard = event.path.some((item: HTMLElement) => item?.hasAttribute?.('data-skInstance'));\r\n      }\r\n\r\n      if (\r\n        (targetTagName === 'textarea' ||\r\n          (targetTagName === 'input' && ['text', 'search', 'url', 'tel', 'password'].includes(event.target.type))) &&\r\n        !instance.options.disableCaretPositioning\r\n      ) {\r\n        /**\r\n         * Tracks current cursor position\r\n         * As keys are pressed, text will be added/removed at that position within the input.\r\n         */\r\n        let selectionStart = event.target.selectionStart;\r\n        let selectionEnd = event.target.selectionEnd;\r\n\r\n        if (instance.options.rtl) {\r\n          selectionStart = instance.utilities.getRtlOffset(selectionStart, instance.getInput());\r\n          selectionEnd = instance.utilities.getRtlOffset(selectionEnd, instance.getInput());\r\n        }\r\n\r\n        instance.setCaretPosition(selectionStart, selectionEnd);\r\n\r\n        /**\r\n         * Tracking current input in order to handle caret positioning edge cases\r\n         */\r\n        instance.activeInputElement = event.target;\r\n\r\n        if (instance.options.debug) {\r\n          console.log(\r\n            'Caret at: ',\r\n            instance.getCaretPosition(),\r\n            instance.getCaretPositionEnd(),\r\n            event && event.target.tagName.toLowerCase(),\r\n            `(${instance.keyboardDOMClass})`,\r\n            event?.type\r\n          );\r\n        }\r\n      } else if ((instance.options.disableCaretPositioning || !isKeyboard) && event?.type !== 'selectionchange') {\r\n        /**\r\n         * If we toggled off disableCaretPositioning, we must ensure caretPosition doesn't persist once reactivated.\r\n         */\r\n        instance.setCaretPosition(null);\r\n\r\n        /**\r\n         * Resetting activeInputElement\r\n         */\r\n        instance.activeInputElement = null;\r\n\r\n        if (instance.options.debug) {\r\n          console.log(`Caret position reset due to \"${event?.type}\" event`, event);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Execute an operation on each button\r\n   */\r\n  recurseButtons(fn: any): void {\r\n    if (!fn) return;\r\n\r\n    Object.keys(this.buttonElements).forEach((buttonName) => this.buttonElements[buttonName].forEach(fn));\r\n  }\r\n\r\n  /**\r\n   * Destroy keyboard listeners and DOM elements\r\n   */\r\n  destroy(): void {\r\n    if (this.options.debug) console.log(`Destroying simple-keyboard instance: ${this.currentInstanceName}`);\r\n\r\n    // const { physicalKeyboardHighlightPreventDefault = false } = this.options;\r\n\r\n    /**\r\n     * Remove document listeners\r\n     */\r\n    // document.removeEventListener('keyup', this.handleKeyUpBound);\r\n    // document.removeEventListener('mouseup', this.handleMouseUpBound);\r\n    // document.removeEventListener('touchend', this.handleTouchEndBound);\r\n    // document.removeEventListener('select', this.handleSelectBound);\r\n    this.removeEventListeners();\r\n\r\n    // // selectionchange is causing caret update issues on Chrome\r\n    // // https://github.com/hodgef/simple-keyboard/issues/2346\r\n    // if (this.options.updateCaretOnSelectionChange) {\r\n    //   document.removeEventListener('selectionchange', this.handleSelectionChangeBound);\r\n    // }\r\n\r\n    document.onpointerup = null;\r\n    document.ontouchend = null;\r\n    document.ontouchcancel = null;\r\n    document.onmouseup = null;\r\n\r\n    /**\r\n     * Remove buttons\r\n     */\r\n    const deleteButton = (buttonElement: KeyboardElement | null) => {\r\n      if (buttonElement) {\r\n        buttonElement.onpointerdown = null;\r\n        buttonElement.onpointerup = null;\r\n        buttonElement.onpointercancel = null;\r\n        buttonElement.ontouchstart = null;\r\n        buttonElement.ontouchend = null;\r\n        buttonElement.ontouchcancel = null;\r\n        buttonElement.onclick = null;\r\n        buttonElement.onmousedown = null;\r\n        buttonElement.onmouseup = null;\r\n\r\n        buttonElement.remove();\r\n        buttonElement = null;\r\n      }\r\n    };\r\n\r\n    this.recurseButtons(deleteButton);\r\n\r\n    /**\r\n     * Remove wrapper events\r\n     */\r\n    this.keyboardDOM.onpointerdown = null;\r\n    this.keyboardDOM.ontouchstart = null;\r\n    this.keyboardDOM.onmousedown = null;\r\n\r\n    /**\r\n     * Clearing keyboard rows\r\n     */\r\n    this.resetRows();\r\n\r\n    /**\r\n     * Candidate box\r\n     */\r\n    if (this.candidateBox) {\r\n      this.candidateBox.destroy();\r\n      this.candidateBox = null;\r\n    }\r\n\r\n    /**\r\n     * Clearing activeInputElement\r\n     */\r\n    this.activeInputElement = null;\r\n\r\n    /**\r\n     * Removing instance attribute\r\n     */\r\n    this.keyboardDOM.removeAttribute('data-skInstance');\r\n\r\n    /**\r\n     * Clearing keyboardDOM\r\n     */\r\n    this.keyboardDOM.innerHTML = '';\r\n\r\n    /**\r\n     * Remove instance\r\n     */\r\n    (window as SKWindow)['SimpleKeyboardInstances'][this.currentInstanceName] = null;\r\n    delete (window as SKWindow)['SimpleKeyboardInstances'][this.currentInstanceName];\r\n\r\n    /**\r\n     * Reset initialized flag\r\n     */\r\n    this.initialized = false;\r\n\r\n    /**\r\n     * Reset navEngaged flag\r\n     */\r\n    this.setNavEngaged(false);\r\n  }\r\n\r\n  /**\r\n   * Process buttonTheme option\r\n   */\r\n  getButtonThemeClasses(button: string): string[] {\r\n    const buttonTheme = this.options.buttonTheme;\r\n    let buttonClasses: string[] = [];\r\n\r\n    if (Array.isArray(buttonTheme)) {\r\n      buttonTheme.forEach((themeObj) => {\r\n        if (\r\n          themeObj &&\r\n          themeObj.class &&\r\n          typeof themeObj.class === 'string' &&\r\n          themeObj.buttons &&\r\n          typeof themeObj.buttons === 'string'\r\n        ) {\r\n          const themeObjClasses = themeObj.class.split(' ');\r\n          const themeObjButtons = themeObj.buttons.split(' ');\r\n\r\n          if (themeObjButtons.includes(button)) {\r\n            buttonClasses = [...buttonClasses, ...themeObjClasses];\r\n          }\r\n        } else {\r\n          console.warn(`Incorrect \"buttonTheme\". Please check the documentation.`, themeObj);\r\n        }\r\n      });\r\n    }\r\n\r\n    return buttonClasses;\r\n  }\r\n\r\n  /**\r\n   * Process buttonAttributes option\r\n   */\r\n  setDOMButtonAttributes(button: string, callback: any): void {\r\n    const buttonAttributes = this.options.buttonAttributes;\r\n\r\n    if (Array.isArray(buttonAttributes)) {\r\n      buttonAttributes.forEach((attrObj) => {\r\n        if (\r\n          attrObj.attribute &&\r\n          typeof attrObj.attribute === 'string' &&\r\n          attrObj.value &&\r\n          typeof attrObj.value === 'string' &&\r\n          attrObj.buttons &&\r\n          typeof attrObj.buttons === 'string'\r\n        ) {\r\n          const attrObjButtons = attrObj.buttons.split(' ');\r\n\r\n          if (attrObjButtons.includes(button)) {\r\n            callback(attrObj.attribute, attrObj.value);\r\n          }\r\n        } else {\r\n          console.warn(`Incorrect \"buttonAttributes\". Please check the documentation.`, attrObj);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  onTouchDeviceDetected() {\r\n    /**\r\n     * Processing autoTouchEvents\r\n     */\r\n    this.processAutoTouchEvents();\r\n\r\n    /**\r\n     * Disabling contextual window on touch devices\r\n     */\r\n    this.disableContextualWindow();\r\n  }\r\n\r\n  /**\r\n   * Disabling contextual window for hg-button\r\n   */\r\n  /* istanbul ignore next */\r\n  disableContextualWindow() {\r\n    window.oncontextmenu = (event: KeyboardHandlerEvent) => {\r\n      if (event.target.classList.contains('hg-button')) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return false;\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Process autoTouchEvents option\r\n   */\r\n  processAutoTouchEvents() {\r\n    if (this.options.autoUseTouchEvents) {\r\n      this.options.useTouchEvents = true;\r\n\r\n      if (this.options.debug) {\r\n        console.log(`autoUseTouchEvents: Touch device detected, useTouchEvents enabled.`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function once simple-keyboard is rendered for the first time (on initialization).\r\n   */\r\n  onInit() {\r\n    if (this.options.debug) {\r\n      console.log(`${this.keyboardDOMClass} Initialized`);\r\n    }\r\n\r\n    //Initialize Announcer\r\n    this._announcerEl = this.ensureAnnouncer(this.keyboardDOM);\r\n\r\n    /**\r\n     * setEventListeners\r\n     */\r\n    this.setEventListeners();\r\n\r\n    // Handle autoFocus after full initialization - ensures DOM is complete and painted\r\n    if (this.options.autoFocus) {\r\n      this.handleAutoFocus();\r\n    }\r\n\r\n    if (typeof this.options.onInit === 'function') this.options.onInit(this);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function before a simple-keyboard render.\r\n   */\r\n  beforeFirstRender() {\r\n    /**\r\n     * Performing actions when touch device detected\r\n     */\r\n    if (this.utilities.isTouchDevice()) {\r\n      this.onTouchDeviceDetected();\r\n    }\r\n\r\n    if (typeof this.options.beforeFirstRender === 'function') this.options.beforeFirstRender(this);\r\n\r\n    /**\r\n     * Notify about PointerEvents usage\r\n     */\r\n    if (\r\n      this.isFirstKeyboardInstance &&\r\n      this.utilities.pointerEventsSupported() &&\r\n      !this.options.useTouchEvents &&\r\n      !this.options.useMouseEvents\r\n    ) {\r\n      if (this.options.debug) {\r\n        console.log('Using PointerEvents as it is supported by this browser');\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Notify about touch events usage\r\n     */\r\n    if (this.options.useTouchEvents) {\r\n      if (this.options.debug) {\r\n        console.log('useTouchEvents has been enabled. Only touch events will be used.');\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function before a simple-keyboard render.\r\n   */\r\n  beforeRender() {\r\n    if (typeof this.options.beforeRender === 'function') this.options.beforeRender(this);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function every time simple-keyboard is rendered (e.g: when you change layouts).\r\n   */\r\n  onRender() {\r\n    if (typeof this.options.onRender === 'function') this.options.onRender(this);\r\n\r\n    this._announcerEl = this.ensureAnnouncer(this.keyboardDOM);\r\n  }\r\n\r\n  /**\r\n   * Handles automatic focus to the first key when autoFocus option is enabled\r\n   * Called from onInit to ensure DOM is fully complete and painted\r\n   */\r\n  handleAutoFocus(): void {\r\n    setTimeout(() => {\r\n      requestAnimationFrame(() => {\r\n        const firstActive = this.keyboardDOM.querySelector('[data-skBtn][aria-selected=\"true\"]') as HTMLElement;\r\n\r\n        if (firstActive) {\r\n          if (this.options.debug) {\r\n            console.log('AutoFocus: First keyboard button already active');\r\n          }\r\n        } else {\r\n          // Fallback: just grab the first button\r\n          const fallbackButton = this.keyboardDOM.querySelector('[data-skBtn]') as HTMLElement;\r\n\r\n          if (fallbackButton) {\r\n            fallbackButton.setAttribute('aria-selected', 'true');\r\n            if (this.options.debug) {\r\n              console.log('AutoFocus: Activated fallback keyboard button');\r\n            }\r\n          } else if (this.options.debug) {\r\n            console.warn('AutoFocus: No keyboard buttons found to activate!');\r\n          }\r\n        }\r\n      });\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Executes the callback function once all modules have been loaded\r\n   */\r\n  onModulesLoaded() {\r\n    if (typeof this.options.onModulesLoaded === 'function') this.options.onModulesLoaded(this);\r\n  }\r\n\r\n  /**\r\n   * Register module\r\n   */\r\n  registerModule = (name: string, initCallback: any) => {\r\n    if (!this.modules[name]) this.modules[name] = {};\r\n\r\n    initCallback(this.modules[name]);\r\n  };\r\n\r\n  /**\r\n   * Load modules\r\n   */\r\n  loadModules() {\r\n    if (Array.isArray(this.options.modules)) {\r\n      this.options.modules.forEach((KeyboardModule) => {\r\n        const keyboardModule = this.utilities.isConstructor(KeyboardModule)\r\n          ? new KeyboardModule(this)\r\n          : KeyboardModule(this);\r\n\r\n        keyboardModule.init && keyboardModule.init(this);\r\n      });\r\n\r\n      this.keyboardPluginClasses = 'modules-loaded';\r\n\r\n      this.render();\r\n      this.onModulesLoaded();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get module prop\r\n   */\r\n  getModuleProp(name: string, prop: string) {\r\n    if (!this.modules[name]) return false;\r\n\r\n    return this.modules[name][prop];\r\n  }\r\n\r\n  /**\r\n   * getModulesList\r\n   */\r\n  getModulesList() {\r\n    return Object.keys(this.modules);\r\n  }\r\n\r\n  /**\r\n   * Parse Row DOM containers\r\n   */\r\n  parseRowDOMContainers(\r\n    rowDOM: HTMLDivElement,\r\n    rowIndex: number,\r\n    containerStartIndexes: number[],\r\n    containerEndIndexes: number[]\r\n  ) {\r\n    const rowDOMArray = Array.from(rowDOM.children);\r\n    let removedElements = 0;\r\n\r\n    if (rowDOMArray.length) {\r\n      containerStartIndexes.forEach((startIndex, arrIndex) => {\r\n        const endIndex = containerEndIndexes[arrIndex];\r\n\r\n        /**\r\n         * If there exists a respective end index\r\n         * if end index comes after start index\r\n         */\r\n        if (!endIndex || !(endIndex > startIndex)) {\r\n          return false;\r\n        }\r\n\r\n        /**\r\n         * Updated startIndex, endIndex\r\n         * This is since the removal of buttons to place a single button container\r\n         * results in a modified array size\r\n         */\r\n        const updated_startIndex = startIndex - removedElements;\r\n        const updated_endIndex = endIndex - removedElements;\r\n\r\n        /**\r\n         * Create button container\r\n         */\r\n        const containerDOM = document.createElement('div');\r\n        containerDOM.className += 'hg-button-container';\r\n        const containerUID = `${this.options.layoutName}-r${rowIndex}c${arrIndex}`;\r\n        containerDOM.setAttribute('data-skUID', containerUID);\r\n\r\n        /**\r\n         * Taking elements due to be inserted into container\r\n         */\r\n        const containedElements = rowDOMArray.splice(updated_startIndex, updated_endIndex - updated_startIndex + 1);\r\n        removedElements += updated_endIndex - updated_startIndex;\r\n\r\n        /**\r\n         * Inserting elements to container\r\n         */\r\n        containedElements.forEach((element) => containerDOM.appendChild(element));\r\n\r\n        /**\r\n         * Adding container at correct position within rowDOMArray\r\n         */\r\n        rowDOMArray.splice(updated_startIndex, 0, containerDOM);\r\n\r\n        /**\r\n         * Clearing old rowDOM children structure\r\n         */\r\n        rowDOM.innerHTML = '';\r\n\r\n        /**\r\n         * Appending rowDOM new children list\r\n         */\r\n        rowDOMArray.forEach((element) => rowDOM.appendChild(element));\r\n\r\n        if (this.options.debug) {\r\n          console.log('rowDOMContainer', containedElements, updated_startIndex, updated_endIndex, removedElements + 1);\r\n        }\r\n      });\r\n    }\r\n\r\n    return rowDOM;\r\n  }\r\n\r\n  /**\r\n   * getKeyboardClassString\r\n   */\r\n  getKeyboardClassString = (...baseDOMClasses: any[]) => {\r\n    const keyboardClasses = [this.keyboardDOMClass, ...baseDOMClasses].filter((DOMClass) => !!DOMClass);\r\n\r\n    return keyboardClasses.join(' ');\r\n  };\r\n\r\n  restoreRovingSelection() {\r\n    if (!this.keyboardDOM) return;\r\n    let btnUid = null;\r\n\r\n    if (this._lastUsedKey) {\r\n      btnUid = this._lastUsedKey.split('-')[1];\r\n    }\r\n\r\n    let targetButton = this.keyboardDOM.querySelector(`[data-skbtnuid$=\"${btnUid}\"]`) as HTMLElement;\r\n    if (!targetButton) {\r\n      targetButton = this.keyboardDOM.querySelector('.hg-button') as HTMLElement;\r\n    }\r\n\r\n    if (targetButton) {\r\n      this.keyboardDOM.querySelectorAll('.hg-button').forEach((btn) => btn.setAttribute('aria-selected', 'false'));\r\n      targetButton.setAttribute('aria-selected', 'true');\r\n      this.keyboardDOM.setAttribute('aria-activedescendant', targetButton.id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Renders rows and buttons as per options\r\n   */\r\n  render() {\r\n    /**\r\n     * Clear keyboard\r\n     */\r\n    this.resetRows();\r\n\r\n    /**\r\n     * Calling beforeFirstRender\r\n     */\r\n    if (!this.initialized) {\r\n      this.beforeFirstRender();\r\n    }\r\n\r\n    /**\r\n     * Calling beforeRender\r\n     */\r\n    this.beforeRender();\r\n\r\n    const layoutClass = `hg-layout-${this.options.layoutName}`;\r\n    const layout = this.options.layout || getDefaultLayout();\r\n    const useTouchEvents = this.options.useTouchEvents || false;\r\n    const useTouchEventsClass = useTouchEvents ? 'hg-touch-events' : '';\r\n    const useMouseEvents = this.options.useMouseEvents || false;\r\n    const disableRowButtonContainers = this.options.disableRowButtonContainers;\r\n\r\n    /**\r\n     * Adding themeClass, layoutClass to keyboardDOM\r\n     */\r\n    this.keyboardDOM.className = this.getKeyboardClassString(\r\n      this.options.theme,\r\n      layoutClass,\r\n      this.keyboardPluginClasses,\r\n      useTouchEventsClass\r\n    );\r\n\r\n    /**\r\n     * Adding keyboard identifier\r\n     */\r\n    this.keyboardDOM.setAttribute('data-skInstance', this.currentInstanceName);\r\n\r\n    /**\r\n     * Add WCAG 2.1 compliance attributes - LPJr\r\n     * https://www.w3.org/WAI/WCAG21/Understanding/keyboard.html\r\n     */\r\n\r\n    /**\r\n     * WCAG 2.1 / Section 508a Accessibility Compliance - LPJr\r\n     *\r\n     * This virtual keyboard component follows best-effort WCAG 2.1 Level AA and 508a compliance practices:\r\n     *\r\n     * Keyboard Navigability (2.1.1)\r\n     *    - All keys are operable via arrow keys and focus management\r\n     *    - `Tab` and `Shift+Tab` allow exiting and re-entering the keyboard area\r\n     *\r\n     * Focus Visibility (2.4.7)\r\n     *    - Each key uses `tabIndex` and is visibly highlighted when focused\r\n     *\r\n     * Name, Role, Value (4.1.2)\r\n     *    - Each key has `role=\"button\"` (if not native <button>)\r\n     *    - Each key has an `aria-label` and visible text\r\n     *    - Keyboard container has `role=\"application\"` and a programmatic label\r\n     *\r\n     * Live Region Announcements\r\n     *    - Not implemented to avoid screen reader overload\r\n     *    - Optional feature per WCAG; not required for conformance\r\n     *    - Output is assumed to be visually accessible or programmatically exposed elsewhere\r\n     *\r\n     * Customization\r\n     *    - `aria-label` for the keyboard can be overridden via `options.ariaLabel`\r\n     *    - Accessible layout is language-agnostic and screen reader-friendly\r\n     */\r\n\r\n    this.options.useLiveRegion ??= true;\r\n    this.options.liveRegionMode ??= 'polite';\r\n    this.options.liveRegionDelay ??= 100;\r\n    this.options.ariaLabel ??= 'Virtual Keyboard';\r\n\r\n    this.keyboardDOM.setAttribute('role', 'application');\r\n    this.keyboardDOM.setAttribute('aria-label', this.options.ariaLabel || 'Virtual Keyboard');\r\n    this.keyboardDOM.setAttribute('tabindex', '-1');\r\n\r\n    this.instructions =\r\n      this.options.instructions || 'Arrow keys navigate. Enter to select. Tab to exit keyboard, Shift+Tab to return.';\r\n\r\n    // Add layout header for context\r\n    const header = this.keyboardDOM.querySelector('#hg-virtual-keyboard-header');\r\n    if (!header) {\r\n      this.keyboardHeader = document.createElement('h2');\r\n      this.keyboardHeader.classList.add('hg-header', 'sr-only');\r\n      this.keyboardHeader.id = 'hg-virtual-keyboard-header';\r\n      this.keyboardHeader.textContent = 'QWERTY Virtual Keyboard';\r\n      this.keyboardDOM.appendChild(this.keyboardHeader);\r\n      // Update ARIA attributes to reference both header and instructions\r\n      this.keyboardDOM.setAttribute('aria-labelledby', this.keyboardHeader.id);\r\n    }\r\n\r\n    const instructions = this.keyboardDOM.querySelector('#hg-virtual-keyboard-instructions');\r\n    if (!instructions) {\r\n      this.keyboardInstructions = document.createElement('p');\r\n      this.keyboardInstructions.classList.add('hg-instructions', 'sr-only');\r\n      this.keyboardInstructions.id = 'hg-virtual-keyboard-instructions';\r\n      this.keyboardInstructions.setAttribute('role', 'note');\r\n      this.keyboardInstructions.textContent = this.instructions;\r\n      this.keyboardDOM.appendChild(this.keyboardInstructions);\r\n      // Update ARIA attributes to reference both header and instructions\r\n      this.keyboardDOM.setAttribute('aria-describedby', this.keyboardInstructions.id);\r\n    }\r\n\r\n    /**\r\n     * Create row wrapper\r\n     */\r\n    this.keyboardRowsDOM = document.createElement('div');\r\n    this.keyboardRowsDOM.className = 'hg-rows';\r\n\r\n    /**\r\n     * Iterating through each row\r\n     */\r\n    layout[this.options.layoutName || this.defaultName].forEach((row: string, rIndex: number) => {\r\n      let rowArray = row.split(' ');\r\n\r\n      /**\r\n       * Enforce excludeFromLayout\r\n       */\r\n      if (\r\n        this.options.excludeFromLayout &&\r\n        this.options.excludeFromLayout[this.options.layoutName || this.defaultName]\r\n      ) {\r\n        rowArray = rowArray.filter(\r\n          (buttonName) =>\r\n            this.options.excludeFromLayout &&\r\n            !this.options.excludeFromLayout[this.options.layoutName || this.defaultName].includes(buttonName)\r\n        );\r\n      }\r\n\r\n      /**\r\n       * Creating empty row\r\n       */\r\n      let rowDOM = document.createElement('div');\r\n      rowDOM.className += 'hg-row';\r\n\r\n      /**\r\n       * Tracking container indicators in rows\r\n       */\r\n      const containerStartIndexes: number[] = [];\r\n      const containerEndIndexes: number[] = [];\r\n\r\n      /**\r\n       * Iterating through each button in row\r\n       */\r\n      rowArray.forEach((button, bIndex) => {\r\n        /**\r\n         * Check if button has a container indicator\r\n         */\r\n        const buttonHasContainerStart =\r\n          !disableRowButtonContainers && typeof button === 'string' && button.length > 1 && button.indexOf('[') === 0;\r\n\r\n        const buttonHasContainerEnd =\r\n          !disableRowButtonContainers &&\r\n          typeof button === 'string' &&\r\n          button.length > 1 &&\r\n          button.indexOf(']') === button.length - 1;\r\n\r\n        /**\r\n         * Save container start index, if applicable\r\n         */\r\n        if (buttonHasContainerStart) {\r\n          containerStartIndexes.push(bIndex);\r\n\r\n          /**\r\n           * Removing indicator\r\n           */\r\n          button = button.replace(/\\[/g, '');\r\n        }\r\n\r\n        if (buttonHasContainerEnd) {\r\n          containerEndIndexes.push(bIndex);\r\n\r\n          /**\r\n           * Removing indicator\r\n           */\r\n          button = button.replace(/\\]/g, '');\r\n        }\r\n\r\n        /**\r\n         * Processing button options\r\n         */\r\n        const fctBtnClass = this.utilities.getButtonClass(button);\r\n        const buttonDisplayName = this.utilities.getButtonDisplayName(\r\n          button,\r\n          this.options.display,\r\n          this.options.mergeDisplay\r\n        );\r\n\r\n        /**\r\n         * Creating button\r\n         */\r\n        const buttonType = this.options.useButtonTag ? 'button' : 'div';\r\n        const buttonDOM = document.createElement(buttonType);\r\n        buttonDOM.className += `hg-button ${fctBtnClass}`;\r\n\r\n        /**\r\n         * Adding buttonTheme\r\n         */\r\n        buttonDOM.classList.add(...this.getButtonThemeClasses(button));\r\n\r\n        /**\r\n         * Adding buttonAttributes\r\n         */\r\n        this.setDOMButtonAttributes(button, (attribute: string, value: string) => {\r\n          buttonDOM.setAttribute(attribute, value);\r\n        });\r\n\r\n        this.activeButtonClass = 'hg-activeButton';\r\n\r\n        /**\r\n         * Handle button click event\r\n         */\r\n        /* istanbul ignore next */\r\n        if (this.utilities.pointerEventsSupported() && !useTouchEvents && !useMouseEvents) {\r\n          /**\r\n           * Handle PointerEvents\r\n           */\r\n          buttonDOM.onpointerdown = (e: KeyboardHandlerEvent) => {\r\n            this.handleButtonClicked(button, e);\r\n            this.handleButtonMouseDown(button, e);\r\n          };\r\n          buttonDOM.onpointerup = (e: KeyboardHandlerEvent) => {\r\n            this.handleButtonMouseUp(button, e);\r\n          };\r\n          buttonDOM.onpointercancel = (e: KeyboardHandlerEvent) => {\r\n            this.handleButtonMouseUp(button, e);\r\n          };\r\n        } else {\r\n          /**\r\n           * Fallback for browsers not supporting PointerEvents\r\n           */\r\n          if (useTouchEvents) {\r\n            /**\r\n             * Handle touch events\r\n             */\r\n            buttonDOM.ontouchstart = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonClicked(button, e);\r\n              this.handleButtonMouseDown(button, e);\r\n            };\r\n            buttonDOM.ontouchend = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonMouseUp(button, e);\r\n            };\r\n            buttonDOM.ontouchcancel = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonMouseUp(button, e);\r\n            };\r\n          } else {\r\n            /**\r\n             * Handle mouse events\r\n             */\r\n            buttonDOM.onclick = (e: KeyboardHandlerEvent) => {\r\n              this.setMouseHold(false);\r\n              /**\r\n               * Fire button handler in onclick for compatibility reasons\r\n               * This fires handler before onKeyReleased, therefore when that option is set we will fire the handler\r\n               * in onmousedown instead\r\n               */\r\n              if (\r\n                typeof this.options.onKeyReleased !== 'function' &&\r\n                !(this.options.useMouseEvents && this.options.clickOnMouseDown)\r\n              ) {\r\n                this.handleButtonClicked(button, e);\r\n              }\r\n            };\r\n            buttonDOM.onmousedown = (e: KeyboardHandlerEvent) => {\r\n              /**\r\n               * Fire button handler for onKeyReleased use-case\r\n               */\r\n              if (\r\n                (typeof this.options.onKeyReleased === 'function' ||\r\n                  (this.options.useMouseEvents && this.options.clickOnMouseDown)) &&\r\n                !this.isMouseHold\r\n              ) {\r\n                this.handleButtonClicked(button, e);\r\n              }\r\n              this.handleButtonMouseDown(button, e);\r\n            };\r\n            buttonDOM.onmouseup = (e: KeyboardHandlerEvent) => {\r\n              this.handleButtonMouseUp(button, e);\r\n            };\r\n          }\r\n        }\r\n\r\n        /**\r\n         * Adding identifier\r\n         */\r\n        buttonDOM.setAttribute('data-skBtn', button);\r\n\r\n        /**\r\n         * Adding unique id\r\n         * Since there's no limit on spawning same buttons, the unique id ensures you can style every button\r\n         */\r\n        const buttonUID = `${this.options.layoutName}-r${rIndex}b${bIndex}`;\r\n        buttonDOM.setAttribute('data-skBtnUID', buttonUID);\r\n\r\n        /**\r\n         * Adding WCAG 2.1 compliance attributes - LPjr\r\n         */\r\n        // Accessibility: Set role and focus management\r\n        if (buttonType === 'div') {\r\n          buttonDOM.setAttribute('role', 'button');\r\n        }\r\n\r\n        buttonDOM.setAttribute('aria-selected', 'false'); // Only one key should be tabbable at a time\r\n        buttonDOM.setAttribute('tabindex', '-1'); // Managed manually for arrow key navigation\r\n\r\n        // Accessibility: Aria-label for screen readers\r\n        // If the buttonDisplayName is a symbol or icon, consider customizing the aria-label via options.display\r\n        buttonDOM.setAttribute('aria-label', buttonDisplayName);\r\n\r\n        // Optional: Title attribute for screen readers\r\n        buttonDOM.setAttribute('title', buttonDisplayName);\r\n\r\n        // stable id for key\r\n        buttonDOM.id = `key-${rIndex}-${bIndex}-${button.replace(/\\s+/g, '-')}`;\r\n\r\n        // // Example: If this is the first key, make it focusable\r\n        // if (rIndex === 0 && bIndex === 0) {\r\n        //   buttonDOM.setAttribute('aria-selected', 'true');\r\n        // }\r\n\r\n        /**\r\n         * Adding button label to button\r\n         */\r\n        const buttonSpanDOM = document.createElement('span');\r\n        buttonSpanDOM.innerHTML = buttonDisplayName;\r\n        buttonDOM.appendChild(buttonSpanDOM);\r\n\r\n        /**\r\n         * Adding to buttonElements\r\n         */\r\n        if (!this.buttonElements[button]) this.buttonElements[button] = [];\r\n\r\n        this.buttonElements[button].push(buttonDOM);\r\n\r\n        /**\r\n         * Appending button to row\r\n         */\r\n        rowDOM.appendChild(buttonDOM);\r\n      });\r\n\r\n      /**\r\n       * Parse containers in row\r\n       */\r\n      rowDOM = this.parseRowDOMContainers(rowDOM, rIndex, containerStartIndexes, containerEndIndexes);\r\n\r\n      /**\r\n       * Appending row to hg-rows\r\n       */\r\n      this.keyboardRowsDOM.appendChild(rowDOM);\r\n    });\r\n\r\n    /**\r\n     * Appending row to keyboard\r\n     */\r\n    this.keyboardDOM.appendChild(this.keyboardRowsDOM);\r\n\r\n    /**\r\n     * Restore roving selection before onRender\r\n     */\r\n    this.restoreRovingSelection();\r\n\r\n    /**\r\n     * Calling onRender\r\n     */\r\n    this.onRender();\r\n\r\n    if (!this.initialized) {\r\n      /**\r\n       * Ensures that onInit and beforeFirstRender are only called once per instantiation\r\n       */\r\n      this.initialized = true;\r\n\r\n      /**\r\n       * Handling parent events\r\n       */\r\n      /* istanbul ignore next */\r\n      if (this.utilities.pointerEventsSupported() && !useTouchEvents && !useMouseEvents) {\r\n        document.onpointerup = (e: KeyboardHandlerEvent) => this.handleButtonMouseUp(undefined, e);\r\n        this.keyboardDOM.onpointerdown = (e: KeyboardHandlerEvent) => this.handleKeyboardContainerMouseDown(e);\r\n      } else if (useTouchEvents) {\r\n        /**\r\n         * Handling ontouchend, ontouchcancel\r\n         */\r\n        document.ontouchend = (e: KeyboardHandlerEvent) => this.handleButtonMouseUp(undefined, e);\r\n        document.ontouchcancel = (e: KeyboardHandlerEvent) => this.handleButtonMouseUp(undefined, e);\r\n\r\n        this.keyboardDOM.ontouchstart = (e: KeyboardHandlerEvent) => this.handleKeyboardContainerMouseDown(e);\r\n      } else if (!useTouchEvents) {\r\n        /**\r\n         * Handling mouseup\r\n         */\r\n        document.onmouseup = (e: KeyboardHandlerEvent) => this.handleButtonMouseUp(undefined, e);\r\n        this.keyboardDOM.onmousedown = (e: KeyboardHandlerEvent) => this.handleKeyboardContainerMouseDown(e);\r\n      }\r\n\r\n      /**\r\n       * Calling onInit\r\n       */\r\n      this.onInit();\r\n    }\r\n  }\r\n}\r\n\r\nexport default SimpleKeyboard;\r\n","import SimpleKeyboard from \"./components/Keyboard\";\r\nexport { SimpleKeyboard };\r\nexport default SimpleKeyboard;\r\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Utilities","_ref","getOptions","getCaretPosition","getCaretPositionEnd","dispatch","_classCallCheck","_defineProperty","button","length","bindMethods","includes","buttonTypeClass","getButtonType","buttonWithoutBraces","replace","buttonNormalized","concat","display","arguments","undefined","assign","getDefaultDisplay","input","caretPos","caretPosEnd","moveCaret","options","commonParams","output","removeAt","apply","removeForwardsAt","addStringAt","tabCharOnTab","newLineOnEnter","Number","isInteger","debug","console","log","minus","newCaretPos","updateCaretPosAction","instance","setCaretPosition","caretPosition","source","str","position","positionEnd","slice","join","isMaxLengthReached","updateCaretPos","emojiMatchedReg","substring","match","substr","inputObj","updatedInput","maxLength","currentInput","inputName","condition","maxLengthReached","_typeof","Boolean","window","navigator","maxTouchPoints","PointerEvent","toLowerCase","trim","split","reduce","word","toUpperCase","arr","size","_toConsumableArray","Array","Math","ceil","map","_","i","index","newIndex","startMarkerIndex","indexOf","f","Reflect","construct","String","e","myClass","_step","_iterator","_createForOfIteratorHelper","getOwnPropertyNames","s","n","done","myMethod","bind","err","PhysicalKeyboard","_this","getNavEngaged","Set","altKey","ctrlKey","shiftKey","code","keyCodeToKey","keyCode","layout","_this$getOptions","lastLayout","layoutJSON","mapLayoutToEventCodes","extractAndPadLayout","default","shift","_this2","shiftActive","capslockActive","activeSurface","preventDefault","stopImmediatePropagation","buttonPressed","getSimpleKeyboardLayoutKey","buttonDOM","buttonName","standardButtonPressed","getButtonElement","functionButtonPressed","_buttonDOM$","_buttonDOM$$onpointer","_buttonDOM","_buttonDOM$onpointerd","applyButtonStyle","buttonElement","style","background","physicalKeyboardHighlightBgColor","color","physicalKeyboardHighlightTextColor","activeKeys","add","isArray","forEach","physicalKeyboardHighlightPress","physicalKeyboardHighlightPressUsePointerEvents","onpointerdown","physicalKeyboardHighlightPressUseClick","_buttonDOM$2","click","handleButtonClicked","_this3","_buttonDOM$3","_buttonDOM$3$onpointe","_buttonDOM$onpointeru","removeAttribute","onpointerup","requestAnimationFrame","clear","STANDARD_CODES","has","upper","rawKey","shiftleft","shiftright","controlleft","controlright","altleft","altright","metaleft","metaright","backspace","capslock","enter","tab","_options$layout$defau","_options$layout","currentLayout","_options$layout2","eCode","normalizeToStandardCode","layoutEntry","toString","normal","normalizeOutput","fallbackKeys","qwertyRowLengths","processedLayout","_i","_arr","type","rows","row","push","mappedLayout","qwertyRows","rowIndex","colIndex","_layout$default$rowIn","_layout$shift$rowInde","eventCode","normalKey","CandidateBox","utilities","document","querySelector","pageSize","layoutCandidatesPageSize","handleActiveIndexBound","handleActiveIndex","firstLastNavBound","firstLastNav","listenersAttached","addEventListener","capture","removeEventListener","detachDocListeners","candidateBoxElement","setTimeout","remove","isOpen","activeIndex","candidateOptions","oldListbox","replaceWith","cloneNode","pageIndex","_ref2","candidateValue","targetElement","onSelect","candidateListPages","chunkArray","renderPage","nbPages","onItemSelected","selectedCandidate","destroy","_this$candidateBoxEle","focusable","querySelectorAll","first","last","setAttribute","_ref3","_this$candidateBoxEle2","attachDocListeners","createElement","className","instructionsElement","id","classList","innerHTML","appendChild","candidateListULElement","candidateListItem","_this3$options$displa","candidateListLIElement","getMouseEvent","mouseEvent","useTouchEvents","TouchEvent","MouseEvent","onclick","globalLiveRegionElement","_candidateListLIEleme","label","textContent","ontouchstart","_candidateListLIEleme2","isPrevBtnElementActive","prevBtnElement","isNextBtnElementActive","nextBtnElement","prepend","setupKeyboardNav","updateActiveIndex","activateSelectedOption","listbox","from","option","setActiveOption","prev","next","scrollIntoView","block","_next$textContent","total","activeOption","_activeOption$textCon","SimpleKeyboard","selectorOrOptions","keyboardOptions","Spacebar","keyboardDOMClass","keyboardDOM","HTMLDivElement","warn","Error","caretPositionEnd","name","initCallback","modules","_len","baseDOMClasses","_key","filter","DOMClass","_this$handleParams","handleParams","_this$handleParams$op","_announcerEl","ensureAnnouncer","_objectSpread","layoutName","theme","preventMouseDownDefault","enableLayoutCandidates","excludeFromLayout","keyboardPluginClasses","_this$options$inputNa","defaultName","buttonElements","currentInstanceName","camelCase","allKeyboardInstances","keyboardInstanceNames","keys","isFirstKeyboardInstance","physicalKeyboard","_navEngaged","candidateBox","render","loadModules","onRovingToggle","keyboardEl","parentEl","parentElement","announcerEl","insertAdjacentElement","rowsEl","nextSibling","insertBefore","_rovingLocked","result","currentOptions","navEngaged","endPosition","_this$options","layoutCandidatesObj","layoutCandidates","layoutCandidatesCaseSensitiveMatch","layoutCandidate","inputSubstr","regexp","RegExp","escapeRegex","matchAll","candidateKey","sort","a","b","show","_this3$options","disableCandidateNormalization","enableLayoutCandidatesKeyPress","candidateStr","normalize","beforeInputUpdate","getInput","initialCaretPosition","newInputSubstr","newInput","caretPositionDiff","newCaretPosition","setInput","onKeyPress","onChange","onChangeAll","getAllInputs","_this$options$inputNa2","getUpdatedInput","isStandardButton","activeInputElement","setSelectionRange","inputPattern","inputPatternIsValid","handleMaxLength","newInputValue","syncInstanceInputs","target","_this$candidateBox","_this$getInputCandida","getInputCandidates","showCandidatesBox","isMouseHold","_this4","stopMouseDownPropagation","stopPropagation","activeButtonClass","holdInteractionTimeout","clearTimeout","holdTimeout","setMouseHold","disableButtonHold","getMouseHold","handleButtonHold","_this5","preventMouseUpDefault","stopMouseUpPropagation","contains","recurseButtons","onKeyReleased","_this6","_this7","replaceInput","skipSync","rtl","_this8","_this$keyboardDOM","mode","restoreFocusOnChange","focus","changedOptions","onSetOptions","setNavEngaged","_this$keyboardDOM2","_this$keyboardDOM4","_this$keyboardDOM5","_lastUsedKey","_this$keyboardDOM3","buttons","btn","handleGetButtonAndAnnounce","dataset","skbtnuid","newOptions","_this9","optionName","JSON","stringify","keyboardRowsDOM","callback","_this0","classNameItem","buttonTheme","classNameFound","buttonThemeArray","class","_this1","_this1$options","_buttonTheme","_this1$options$button","filteredButtonArray","item","splice","buttonArr","inputVal","inputPatternRaw","didInputMatch","test","handleUnifiedKeyDownBound","handleKeyUpBound","handleMouseUpBound","handleTouchEndBound","handleSelectBound","updateCaretOnSelectionChange","handleSelectionChangeBound","listenersAdded","_this10","removeEventListeners","handleUnifiedKeyDown","handleKeyUp","handleMouseUp","handleTouchEnd","handleSelect","handleSelectionChange","event","handleInternalKeyNav","handleKeyDown","tag","constructor","KeyboardEvent","isSupportedEvent","getButtonAndAnnounce","bypassKeys","physicalKeyboardHighlightPreventDefault","isPrintable","caretEventHandler","physicalKeyboardHighlight","handleHighlightKeyUp","active","rovedKey","getAttribute","isRovingActive","resolved","resolveKey","_this$keyboardDOM6","keyLabel","logEventType","handleHighlightKeyDown","buttonLabel","pressedKey","_focused$textContent","isNamedKey","NAMED_KEYS_TO_ANNOUNCE","focused","activeElement","focusedLabel","NAMED_READABLE","useLiveRegion","liveRegionAnnounceMode","suppressAnnouncementsOnInputFocus","tagName","displayName","getButtonDisplayName","mergeDisplay","_this11","shouldSuppressAnnouncements","isComposing","repeat","_event$target","_event$target$closest","_target$textContent","closest","announceMode","actionLabel","getAnnounceLabel","announceLiveRegion","contentResult","getContentForButton","_this12","context","ariaLiveTimer","_this$keyboardDOM7","offsetParent","hasAttribute","nextButton","findNextButton","findPreviousButton","findVerticalButton","current","allButtons","idx","direction","currentRow","targetRow","currentRect","getBoundingClientRect","currentCenterX","left","width","candidates","minDelta","POSITIVE_INFINITY","_candidates","el","rect","centerX","delta","abs","userAgent","_this13","targetTagName","isKeyboard","path","some","_item$hasAttribute","disableCaretPositioning","selectionStart","selectionEnd","getRtlOffset","fn","_this14","ontouchend","ontouchcancel","onmouseup","onpointercancel","onmousedown","resetRows","initialized","buttonClasses","themeObj","themeObjClasses","buttonAttributes","attrObj","attribute","processAutoTouchEvents","disableContextualWindow","oncontextmenu","autoUseTouchEvents","setEventListeners","autoFocus","handleAutoFocus","onInit","isTouchDevice","onTouchDeviceDetected","beforeFirstRender","pointerEventsSupported","useMouseEvents","beforeRender","onRender","_this15","fallbackButton","onModulesLoaded","_this16","KeyboardModule","keyboardModule","isConstructor","init","rowDOM","containerStartIndexes","containerEndIndexes","_this17","rowDOMArray","children","removedElements","startIndex","arrIndex","endIndex","updated_startIndex","updated_endIndex","containerDOM","containerUID","containedElements","element","btnUid","targetButton","_this$options2","_this$options2$useLiv","_this$options3","_this$options3$liveRe","_this$options4","_this$options4$liveRe","_this$options5","_this$options5$ariaLa","_this18","layoutClass","useTouchEventsClass","disableRowButtonContainers","getKeyboardClassString","liveRegionMode","liveRegionDelay","ariaLabel","instructions","keyboardHeader","keyboardInstructions","rIndex","rowArray","bIndex","_buttonDOM$classList","buttonHasContainerStart","buttonHasContainerEnd","fctBtnClass","getButtonClass","buttonDisplayName","buttonType","useButtonTag","getButtonThemeClasses","setDOMButtonAttributes","handleButtonMouseDown","handleButtonMouseUp","clickOnMouseDown","buttonUID","buttonSpanDOM","parseRowDOMContainers","restoreRovingSelection","handleKeyboardContainerMouseDown"],"sourceRoot":""}